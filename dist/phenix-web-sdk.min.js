/**
 * Copyright 2017 PhenixP2P Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b(require("phenix-rtc"),require("protobuf"),require("ByteBuffer"));else if("function"==typeof define&&define.amd)define(["phenix-rtc","protobuf","ByteBuffer"],b);else{var c="object"==typeof exports?b(require("phenix-rtc"),require("protobuf"),require("ByteBuffer")):b(a["phenix-rtc"],a.protobuf,a.ByteBuffer);for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(this,function(a,b,c){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d,e;d=[c(1),c(2),c(18),c(32),c(36),c(4)],e=function(a,b,c,d,e,f){return window.PhenixPCast=b,{PCast:b,RoomService:c,AudioSpeakerDetector:d,BandwidthMonitor:e,Logger:f,RTC:a}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(b,c){b.exports=a},function(a,b,c){var d,e;d=[c(3),c(4),c(5),c(13),c(16),c(17),c(1)],e=function(a,b,c,d,e,f,g){"use strict";function h(a){a=a||{},this._logger=a.logger||new b,this._baseUri=a.uri||d.DefaultPCastUri,this._deviceId=a.deviceId||"",this._version=N,this._endPoint=new d(this._version,this._baseUri,this._logger),this._screenSharingExtensionId=a.screenSharingExtensionId||O,this._screenSharingAddOn=a.screenSharingAddOn||P,this._screenSharingEnabled=!1,this._shaka=a.shaka||window.shaka,this._videojs=a.videojs||window.videojs,this._status="offline","Chrome"===g.browser&&this._screenSharingExtensionId&&k.call(this),g.addEventListener(window,"unload",function(a){return function(){a.stop()}}(this))}function i(a){var b=this;if("Chrome"===g.browser&&b._screenSharingExtensionId)try{chrome.runtime.sendMessage(b._screenSharingExtensionId,{type:"version"},function(c){c&&"ok"===c.status?(b._logger.info("Screen sharing enabled using version [%s]",c.version),a(!0)):(b._logger.info("Screen sharing NOT available"),a(!1))})}catch(c){c.message&&b._logger.warn(c.message,c),a(!1)}else a("Firefox"===g.browser&&"object"==typeof window.PCastScreenSharing?!0:!1)}function j(){return"https://chrome.google.com/webstore/detail/"+this._screenSharingExtensionId}function k(){for(var a=j.call(this),b=document.getElementsByTagName("link"),c=0;c<b.length;c++)if(b[c].href===a)return;this._logger.debug("Adding Chrome Web Store link [%s]",a);var d=document.createElement("link");d.rel="chrome-webstore-item",d.href=a,document.getElementsByTagName("head")[0].appendChild(d)}function l(a){var b=this,c=j.call(this);try{chrome.webstore.install(c,function(){return a("ok")},function(c){if(c){if(c.match(/cancelled/gi))return b._logger.info("User cancelled screen sharing"),a("cancelled",new Error(c));b._logger.warn(c)}return a("failed",new Error(c||"failed"))})}catch(d){d.message&&b._logger.warn(d.message),a("failed",d)}}function m(a){try{var b,c={"PCast Screen Sharing":{URL:this._screenSharingAddOn.url,IconURL:this._screenSharingAddOn.iconUrl,Hash:this._screenSharingAddOn.hash,toString:function(){return this.URL}}},d=R,e=function(){b&&clearInterval(b),a("ok")},f=function(){b&&clearInterval(b),a("failed",new Error("failed"))};b=setInterval(function(){return"object"==typeof window.PCastScreenSharing?e():d--<0?f():void 0},Q),InstallTrigger.install(c,function(a,b){0===b?e():f()})}catch(g){g.message&&this._logger.warn(g.message),a("failed",g)}}function n(a,b){var c=this;switch(g.browser){case"Chrome":try{chrome.runtime.sendMessage(c._screenSharingExtensionId,{type:"get-desktop-media"},function(c){if("ok"!==c.status)return b(c.status,void 0,new Error(c.status));var d={video:{}};"object"==typeof a&&"object"==typeof a.screen&&(d.video=a.screen),"object"!=typeof d.video.mandatory&&(d.video.mandatory={}),d.video.mandatory.chromeMediaSource="desktop",d.video.mandatory.chromeMediaSourceId=c.streamId,b("ok",d,void 0)})}catch(d){d.message&&c._logger.warn(d.message),b("failed",void 0,d)}break;case"Firefox":var e={video:{}};"object"==typeof a&&"object"==typeof a.screen&&(e.video=a.screen),e.video.mediaSource="window",b("ok",e,void 0);break;default:b("not-supported",void 0,new Error("not-supported"))}}function o(a,b){var c=this;if(a.screen)if(c._screenSharingEnabled)n.call(c,a,b);else{var d=function(d){return"cancelled"===d?b(d,"cancelled"):"ok"!==d?b(d,void 0,new Error("screen-sharing-installation-failed")):void i.call(c,function(e){return c._screenSharingEnabled=e,c._screenSharingEnabled?void n.call(c,a,b):b(d,void 0,new Error("screen-sharing-installation-failed"))})};switch(g.browser){case"Chrome":l.call(c,d);break;case"Firefox":m.call(c,d);break;default:b("not-supported",void 0,new Error("not-supported"))}}else{var e={audio:a.audio||!1,video:a.video||!1};b("ok",e,void 0)}}function p(a,b){var c=this,d=function(a,d){c._gumStreams.push(d),b(c,a,d)},e=function(a,d,e){b(c,a,d,e)},f=a.screen,g=a.video||a.audio;return f&&g?q.call(c,{audio:a.audio,video:a.video},function(b,f){return q.call(c,{screen:a.screen},function(a,b){H(f,b.getTracks()),d(a,f)},function(a,b,c){I(f),e(a,b,c)})},e):q.call(c,a,d,e)}function q(a,b,c){var d=function(){c("cancelled",null)},e=function(a){c(S(a),void 0,a)},f=function(a){b("ok",a)};return o.call(this,a,function(a,b,c){if("cancelled"===a)return d();if("ok"!==a)return e(c);try{g.getUserMedia(b,f,e)}catch(h){e(h)}})}function r(){var a=this;this._connected=!0,a._stopped||a._protocol.authenticate(a._authToken,function(b,c){a._authenticationCallback&&(c?(a._logger.warn("Failed to authenticate",c),G.call(a,"offline"),a._authenticationCallback.call(a,a,"unauthorized",""),a.stop("unauthorized")):(G.call(a,"online"),a._authenticationCallback.call(a,a,b.status,b.sessionId)))})}function s(){this._connected=!1,G.call(this,"offline")}function t(a){switch(a){case"":case"none":case"ended":return"ended";case"server-error":case"not-ready":case"error":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}function u(a){var b=a.streamId,c=a.reason;return w.call(this,b,c)}function v(a){var b=a.streamId,c=a.status,d=a.reason,e=this._mediaStreams[b];e&&e.dataQualityChangedCallback(c,d);var f=this._publishers[b];f&&"function"==typeof f.dataQualityChangedCallback&&f.dataQualityChangedCallback(f,c,d)}function w(a,b){this._logger.info("[%s] Stream ended with reason [%s]",a,b);var c=this._mediaStreams[a];c&&c.streamEndedCallback(t(b),b),delete this._mediaStreams[a];var d=this._publishers[a];d&&"function"==typeof d.publisherEndedCallback&&d.publisherEndedCallback(d,t(b),b),delete this._publishers[a];var e=this._peerConnections[a];e&&K.call(this,a,e,"ended"),delete this._peerConnections[a]}function x(a,b,c,d,h){var i=this,j=function(j){function k(){for(var a=m.getTracks(),b=0;b<a.length;b++){var c=a[b];if(!J(c))return!1}return!0}function l(d){b.stopped||(i._logger.info("[%s] stop media stream",a),K.call(i,a,c,"stop"),i._protocol.destroyStream(a,d||"",function(b,c){return c?void i._logger.error("[%s] failed to destroy stream",a):void i._logger.info("[%s] destroyed stream",a)}),b.stopped=!0)}if(!b.failed){var m=j.stream;if(!m)return b.failed=!0,i._logger.warn("[%s] No remote stream",a),d.call(i,void 0,"failed");i._logger.info("[%s] Got remote stream",a);var n=function p(d){var j={children:[],renderer:null,isStopped:!1,isStreamEnded:!1,mediaStream:{createRenderer:function(){var a=null,b=new f(i._logger);return{start:function(c){return a=g.attachMediaStream(c,d),h.receiveAudio===!1&&(a.muted=!0),j.renderer=this,b.start(this,a),a},stop:function(){b.stop(),a&&("function"==typeof a.pause&&a.pause(),a.src&&(a.src=""),a.srcObject&&(a.srcObject=null),a=null),j.renderer=null},getStats:function(){return a?{width:a.videoWidth||a.width,height:a.videoHeight||a.height,currentTime:a.currentTime,networkState:a.networkState}:{width:0,height:0,currentTime:0,networkState:L.NETWORK_NO_SOURCE}},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},setVideoDisplayDimensionsChangedCallback:function(a,c){b.setVideoDisplayDimensionsChangedCallback(a,c)}}},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(a){j.isStopped||(I(d),k()&&l(a),j.isStopped=!0)},monitor:function n(b,d){if("object"!=typeof b)throw new Error('"options" must be an object');if("function"!=typeof d)throw new Error('"callback" must be a function');var n=new e(a,c,i._logger);b.direction="inbound",n.start(b,function(){return j.mediaStream.isActive()},function(b){return i._logger.warn("[%s] Media stream triggered monitor condition for [%s]",a,b),d(j.mediaStream,"client-side-failure",b)})},getStream:function(){return d},isActive:function(){var c=b.stopped,d="object"!=typeof i._mediaStreams[a],e=j.isStopped;return!c&&!d&&!e},getStreamId:function(){return a},select:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');if("function"!=typeof window.MediaStream)throw new Error("MediaStream not supported in current browser");for(var b=m.getTracks(),c=new window.MediaStream,d=0;d<b.length;d++)a(b[d],d)&&c.addTrack(b[d]);if(0===c.getTracks().length)return i._logger.warn("No tracks selected");var e=p(c);return j.children.push(e),e.mediaStream}},streamErrorCallback:function(a,b){for(var c=0;c<j.children.length;c++)j.children[c].streamErrorCallback(a,b);var d=j.mediaStream;"function"==typeof d.streamErrorCallback&&d.streamErrorCallback(d,a,b)},streamEndedCallback:function(a,b){for(var c=0;c<j.children.length;c++)j.children[c].streamEndedCallback(a,b);if(!j.isStreamEnded){var d=j.mediaStream;j.isStreamEnded=!0,"function"==typeof d.streamEndedCallback&&d.streamEndedCallback(d,a,b),d.stop(),j.renderer&&j.renderer.stop()}},dataQualityChangedCallback:function(a,b){for(var c=0;c<j.children.length;c++)j.children[c].dataQualityChangedCallback(a,b);var d=j.renderer;d&&"function"==typeof d.dataQualityChangedCallback&&d.dataQualityChangedCallback(d,a,b)}};return j},o=n(m);i._mediaStreams[a]=o,d.call(i,o.mediaStream)}};g.addEventListener(c,"addstream",j)}function y(a,b,c){var d=this,e=function(b){var e=b.candidate;e?d._logger.debug("[%s] ICE candidate: [%s] [%s] [%s]",a,e.sdpMid,e.sdpMLineIndex,e.candidate):d._logger.info("[%s] ICE candidate discovery complete",a),c&&c(e)};g.addEventListener(b,"icecandidate",e)}function z(a,b){var c=this,d=function(a){c._logger.info("[%s] Negotiation needed")},e=function(d){c._logger.info("[%s] ICE connection state changed [%s]",a,b.iceConnectionState)},f=function(d){c._logger.info("[%s] ICE gathering state changed [%s]",a,b.iceGatheringState)},h=function(d){c._logger.info("[%s] Signaling state changed [%s]",a,b.signalingState)},i=function(d){c._logger.info("[%s] Connection state changed [%s]",a,b.connectionState)};g.addEventListener(b,"negotiationneeded",d),g.addEventListener(b,"iceconnectionstatechange",e),g.addEventListener(b,"icegatheringstatechange ",f),g.addEventListener(b,"signalingstatechange",h),g.addEventListener(b,"connectionstatechange",i)}function A(a,b,c){var d=this,e={stopped:!1},f={getStreamId:function(){return a},isActive:function(){return!e.stopped},hasEnded:function(){return e.stopped},stop:function(b){e.stopped||(d._protocol.destroyStream(a,b||"",function(b,c){return c?void d._logger.error("[%s] failed to destroy stream",a):void d._logger.info("[%s] destroyed stream",a)}),e.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},getOptions:function(){return c}};d._publishers[a]=f,b(f)}function B(b,c,d,f,h,i){function j(){function b(b){k._logger.info("Created answer [%s]",b.sdp),k._protocol.setAnswerDescription(c,b.sdp,function(b,h){function j(){var a=/(b=AS:([0-9]*)[\n\r]*)/gi,b=/(mid:video)([\n\r]*)/gi;k._logger.info("Set local description (answer)");var h=0,j=a.exec(d);j&&j.length>=3&&(h=1e3*j[2]);var m={getStreamId:function(){return c},isActive:function(){return!l.stopped},hasEnded:function(){switch(o.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":return!0;default:return!0}},stop:function(a){l.stopped||(K.call(k,c,o,"closed"),k._protocol.destroyStream(c,a||"",function(a,b){return b?void k._logger.error("[%s] failed to destroy stream",c):void k._logger.info("[%s] destroyed stream",c)}),l.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},setDetectSpeakingCallback:function(){},limitBandwidth:function(c){if("number"!=typeof c)throw new Error('"bandwidthLimit" must be a number');var d=h?Math.min(c,h):c,e=o.remoteDescription;k._logger.info("Changing bandwidth limit to [%s]",d);var f=e.sdp.replace(a,"");f=f.replace(b,function(a,b,c,e,f){return[b,c,"b=AS:",Math.ceil(d/1e3),c].join("")});var i=new g.RTCSessionDescription({type:e.type,sdp:f});return o.setRemoteDescription(i),{dispose:function(){o.setRemoteDescription(e)}}},monitor:function n(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function');var n=new e(c,o,k._logger);a.direction="outbound",n.start(a,function(){return k._publishers[c]===m&&!l.stopped},function(a){return k._logger.warn("[%s] Publisher triggered monitor condition for [%s]",c,a),b(m,"client-side-failure",a)})},setRemoteMediaStreamCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.remoteMediaStreamCallback=a,p&&a(m,p)},getOptions:function(){return i}};k._publishers[c]=m,f.call(k,m)}if(h)return k._logger.warn("Failed to set answer description",h),r();a.includes(b.options,"ice-candidates")&&(q=function(b){var d=[],e=[];b?d.push(b):e.push("completed"),k._protocol.addIceCandidates(c,d,e,function(b,c){return c?void k._logger.warn("Failed to add ICE candidate",c):void(a.includes(b.options,"cancel")&&(q=null))})});var m=new g.RTCSessionDescription({type:"answer",sdp:b.sessionDescription.sdp});o.setLocalDescription(m,j,r)})}k._logger.info("Set remote description (offer)");var j={mandatory:{}};"Chrome"===g.browser?(j.mandatory.OfferToReceiveVideo=h.receiveVideo===!0,j.mandatory.OfferToReceiveAudio=h.receiveAudio===!0):(j.mandatory.offerToReceiveVideo=h.receiveVideo===!0,j.mandatory.offerToReceiveAudio=h.receiveAudio===!0),o.createAnswer(b,r,j)}var k=this,l={failed:!1,stopped:!1},m=d.match(/a=crypto:/i),n=d.match(/m=application /i),o=new g.RTCPeerConnection(M,{optional:[{DtlsSrtpKeyAgreement:!m},{RtpDataChannels:n}]}),p=null,q=null;k._peerConnections[c]=o,o.addStream(b);var r=function(){l.failed||(l.failed=!0,l.stopped=!0,delete k._peerConnections[c],K.call(k,c,o,"failure"),f.call(k,void 0,"failed"))};x.call(k,c,l,o,function(a){var b=k._publishers[c];p=a,b&&b.remoteMediaStreamCallback&&b.remoteMediaStreamCallback(b,a)},h),y.call(k,c,o,function(a){q&&q(a)}),z.call(k,c,o);var s=new g.RTCSessionDescription({type:"offer",sdp:d});o.setRemoteDescription(s,j,r)}function C(b,c,d,e){function f(){function c(c){h._logger.info("Created answer [%s]",c.sdp),h._protocol.setAnswerDescription(b,c.sdp,function(c,d){function e(){h._logger.debug("Set local description (answer)")}if(d)return h._logger.warn("Failed to set answer description",d),n();a.includes(c.options,"ice-candidates")&&(m=function(c){var d=[],e=[];c?d.push(c):e.push("completed"),h._protocol.addIceCandidates(b,c,e,function(b,c){return c?void h._logger.warn("Failed to add ICE candidate",c):void(a.includes(b.options,"cancel")&&(m=null))})});var f=new g.RTCSessionDescription({type:"answer",sdp:c.sessionDescription.sdp});l.setLocalDescription(f,e,n)})}h._logger.debug("Set remote description (offer)");var d={mandatory:{}};"Chrome"===g.browser?(d.mandatory.OfferToReceiveVideo=e.receiveVideo!==!1,d.mandatory.OfferToReceiveAudio=e.receiveAudio!==!1):(d.mandatory.offerToReceiveVideo=e.receiveVideo!==!1,d.mandatory.offerToReceiveAudio=e.receiveAudio!==!1),l.createAnswer(c,n,d)}var h=this,i={failed:!1,stopped:!1},j=c.match(/a=crypto:/i),k=c.match(/m=application /i),l=new g.RTCPeerConnection(M,{optional:[{DtlsSrtpKeyAgreement:!j},{RtpDataChannels:k}]}),m=null;h._peerConnections[b]=l;var n=function(){i.failed||(i.failed=!0,i.stopped=!0,delete h._peerConnections[b],K.call(h,b,l,"failure"),d.call(h,void 0,"failed"))};x.call(h,b,i,l,d,e),y.call(h,b,l,function(a){m&&m(a)}),z.call(h,b,l);var o=new g.RTCSessionDescription({type:"offer",sdp:c});l.setRemoteDescription(o,f,n)}function D(a,b,c,d){var e=this,f=b.match("a=x-playlist:([^\n]*[.]mpd)"),g=b.match("a=x-playlist:([^\n]*[.]m3u8)");return f&&2===f.length&&e._shaka&&e._shaka.Player.isBrowserSupported()?E.call(e,a,f[1],c,d):g&&2===g.length&&"maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL")?F.call(e,a,g[1],c,d):(e._logger.warn("[%s] Offer does not contain a supported manifest",a,b),c.call(e,void 0,"failed"))}function E(a,b,c,d){var e=this;if(!e._shaka)return e._logger.warn("[%s] Shaka player not available",a),c.call(e,void 0,"live-player-missing");if(!e._shaka.Player.isBrowserSupported())return e._logger.warn("[%s] Shaka does not support this browser",a),c.call(e,void 0,"browser-unsupported");var g=e._shaka,h=encodeURI(b).replace(/[#]/g,"%23"),i=function(b){var c=j;c.streamErrorCallback?(e._logger.debug("[%s] DASH live stream error event [%s]",a,b.detail),c.streamErrorCallback(c,"shaka",b.detail)):e._logger.error("[%s] DASH live stream error event [%s]",a,b.detail)},j={renderer:null,isStreamEnded:!1,isStopped:!1,mediaStream:{createRenderer:function(){var b=null,c=new f(e._logger);return{start:function(f){b=new g.Player(f),b.configure({manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4}}}),d.receiveAudio===!1&&(f.muted=!0),j.renderer=this,b.addEventListener("error",i);b.load(h).then(function(){e._logger.info("[%s] DASH live stream has been loaded",a),"function"==typeof f.play&&f.play()})["catch"](function(b){e._logger.error("[%s] Error while loading DASH live stream [%s]",a,b.code,b),j.streamErrorCallback("shaka",b)});return c.start(this,f),f},stop:function(){if(c.stop(),b){var d=function(){var a="";j.streamEndedCallback(t(a),a),b=null};b.destroy().then(function(){e._logger.info("[%s] DASH live stream has been destroyed",a)}).then(function(){d()})["catch"](function(b){e._logger.error("[%s] Error while destroying DASH live stream [%s]",a,b.code,b),d(),j.streamErrorCallback("shaka",b)})}j.renderer=null},getStats:function(){if(!b)return{width:0,height:0,currentTime:0,networkState:L.NETWORK_NO_SOURCE};var a=b.getStats();return a.currentTime=a.playTime+a.bufferingTime,a.estimatedBandwidth>0?a.networkState=L.NETWORK_LOADING:a.playTime>0?a.networkState=L.NETWORK_IDLE:a.video?a.networkState=L.NETWORK_EMPTY:a.networkState=L.NETWORK_NO_SOURCE,a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},getPlayer:function(){return b},isActive:function(){return!j.isStopped},getStreamId:function(){return a},setVideoDisplayDimensionsChangedCallback:function(a,b){c.setVideoDisplayDimensionsChangedCallback(a,b)}}},select:function(b){return e._logger.warn("[%s] selection of tracks not supported for shaka live streams",a),this},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(b){j.isStopped||(e._logger.info("[%s] stop media stream",a),e._protocol.destroyStream(a,b||"",function(b,c){return c?void e._logger.error("[%s] failed to destroy stream",a):void e._logger.info("[%s] destroyed stream",a)}),j.isStopped=!0)},monitor:function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')}},streamErrorCallback:function(a,b){var c=j.mediaStream;"function"==typeof c.streamErrorCallback&&c.streamErrorCallback(c,a,b)},streamEndedCallback:function(a,b){if(!j.isStreamEnded){var c=j.mediaStream;j.isStreamEnded=!0,"function"==typeof c.streamEndedCallback&&c.streamEndedCallback(c,a,b),c.stop(),j.renderer&&j.renderer.stop()}},dataQualityChangedCallback:function(a,b){var c=j.renderer;c&&"function"==typeof c.dataQualityChangedCallback&&c.dataQualityChangedCallback(c,a,b)}};e._mediaStreams[a]=j,c.call(e,j.mediaStream)}function F(a,b,c,d){var e=this,g=encodeURI(b).replace(/[#]/g,"%23"),h=function(b){var c=i.mediaStream;c.streamErrorCallback?(e._logger.debug("[%s] HLS live stream error event [%s]",a,b.detail),c.streamErrorCallback(c,"hls",b.detail)):e._logger.error("[%s] HLS live stream error event [%s]",a,b.detail)},i={renderer:null,isStreamEnded:!1,isStopped:!1,mediaStream:{createRenderer:function(){var b=null,c=new f(e._logger);return{start:function(f){try{return f.src=g,d.receiveAudio===!1&&(f.muted=!0),i.renderer=this,f.addEventListener("error",h),f.play(),b=f,c.start(this,b),f}catch(j){e._logger.error("[%s] Error while loading HLS live stream [%s]",a,j.code,j),i.streamErrorCallback("hls",j)}},stop:function(){if(c.stop(),b){var d=function(){b=null;var a="";i.streamEndedCallback(t(a),a)};try{b.pause(),e._logger.info("[%s] HLS live stream has been destroyed",a),d()}catch(f){e._logger.error("[%s] Error while destroying HLS live stream [%s]",a,f.code,f),d(),i.streamErrorCallback("hls",f)}}i.renderer=null},getStats:function(){return b?{width:b.videoWidth||b.width,height:b.videoHeight||b.height,currentTime:b.currentTime,networkState:b.networkState}:{width:0,height:0,currentTime:0,networkState:L.NETWORK_NO_SOURCE}},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},setVideoDisplayDimensionsChangedCallback:function(a,b){c.setVideoDisplayDimensionsChangedCallback(a,b)}}},select:function(b){return e._logger.warn("[%s] selection of tracks not supported for HLS live streams",a),this},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(b){i.isStopped||(e._logger.info("[%s] stop media stream",a),e._protocol.destroyStream(a,b||"",function(b,c){return c?void e._logger.error("[%s] failed to destroy stream",a):void e._logger.info("[%s] destroyed stream",a)}),i.isStopped=!0)},monitor:function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')},isActive:function(){return!i.isStopped},getStreamId:function(){return a}},streamErrorCallback:function(a,b){var c=i.mediaStream;"function"==typeof c.streamErrorCallback&&c.streamErrorCallback(c,a,b)},streamEndedCallback:function(a,b){if(!i.isStreamEnded){var c=i.mediaStream;i.isStreamEnded=!0,"function"==typeof c.streamEndedCallback&&c.streamEndedCallback(c,a,b),c.stop(),i.renderer&&i.renderer.stop()}},dataQualityChangedCallback:function(a,b){var c=i.renderer;c&&"function"==typeof c.dataQualityChangedCallback&&c.dataQualityChangedCallback(c,a,b)}};e._mediaStreams[a]=i,c.call(e,i.mediaStream)}function G(a){if(this._status!==a)switch(this._status=a,a){case"connecting":break;case"offline":this._offlineCallback.call(this);break;case"online":this._onlineCallback.call(this)}}function H(a,b){if("object"==typeof a&&"object"==typeof b&&b.constructor===Array)for(var c=0;c<b.length;c++)a.addTrack(b[c])}function I(a){if(a&&"function"==typeof a.getTracks)for(var b=a.getTracks(),c=0;c<b.length;c++){var d=b[c];d.stop()}}function J(a){if("object"!=typeof a)throw new Error("Invalid track.");return"ended"===a.readyState}function K(a,b,c){"closed"===b.signalingState||b.__closing||(this._logger.debug("[%s] close peer connection [%s]",a,c),b.close(),b.__closing=!0)}var L=a.freeze({NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3}),M=a.freeze({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]}),N="2017-05-03T14:47:09Z",O="icngjadgidcmifnehjcielbmiapkhjpn",P=a.freeze({url:"https://addons.mozilla.org/firefox/downloads/file/474686/pcast_screen_sharing-1.0.3-an+fx.xpi",iconUrl:"https://phenixp2p.com/public/images/phenix-logo-unicolor-64x64.png",hash:"sha256:4972e9718ea7f7c896abc12d1a9e664d5f3efe498539b082ab7694f9d7af4f3b"}),Q=100,R=450;h.prototype.getBaseUri=function(){return this._endPoint.getBaseUri()},h.prototype.getStatus=function(){return this._status},h.prototype.start=function(b,d,e,f){if("string"!=typeof b)throw new Error('"authToken" must be a string');if("function"!=typeof d)throw new Error('"authenticationCallback" must be a function');if("function"!=typeof e)throw new Error('"onlineCallback" must be a function');if("function"!=typeof f)throw new Error('"offlineCallback" must be a function');if(this._started)throw new Error('"Already started"');this._stopped=!1,this._started=!0,this._authToken=b,this._authenticationCallback=d,this._onlineCallback=e,this._offlineCallback=f,this._status="connecting",this._peerConnections={},this._mediaStreams={},this._publishers={},this._gumStreams=[];var g=this;i.call(g,function(b){g._screenSharingEnabled=b,g._endPoint.resolveUri(function(b,d){if(b){switch(g._logger.error("Failed to connect to [%s]",g._baseUri,b),G.call(g,"offline"),b.code){case 0:g._authenticationCallback.call(g,g,"network-unavailable","");break;case 503:g._authenticationCallback.call(g,g,"capacity","");break;default:g._authenticationCallback.call(g,g,"failed","")}return g._stopped=!0,void(g._started=!1)}g._logger.info("Discovered end point [%s]",d),g._protocol=new c(d,g._deviceId,g._version,g._logger),g._protocol.on("connected",a.bind(r,g)),g._protocol.on("disconnected",a.bind(s,g)),g._protocol.on("streamEnded",a.bind(u,g)),g._protocol.on("dataQuality",a.bind(v,g))})})},h.prototype.stop=function(){if(this._started){this._stopped=!0,this._started=!1,delete this._authenticationCallback;try{var b="";for(var c in this._mediaStreams)this._mediaStreams.hasOwnProperty(c)&&w.call(this,c,b);for(var c in this._publishers)if(this._publishers.hasOwnProperty(c)){var d=this._publishers[c];w.call(this,c,b),a.includes(d.getOptions(),"detached")||d.stop(b)}for(var c in this._peerConnections)this._peerConnections.hasOwnProperty(c)&&w.call(this,c,b);for(var e=0;e<this._gumStreams.length;e++)for(var f=this._gumStreams[e].getTracks(),g=0;g<f.length;g++)f[g].stop()}finally{this._protocol&&this._protocol.disconnect()}}},h.prototype.getUserMedia=function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function');return p.call(this,a,b)},h.prototype.publish=function(a,b,c,d,e){if("string"!=typeof a)throw new Error('"streamToken" must be a string');if("object"!=typeof b&&"string"!=typeof b)throw new Error('"streamToPublish" must be an object or URI');if("function"!=typeof c)throw new Error('"callback" must be a function');if(d=d||[],!Array.isArray(d))throw new Error('"tags" must be an array');if(e=e||{},"object"!=typeof e)throw new Error('"options" must be an object');var f=this,g="upload",h={negotiate:!0,connectOptions:e.connectOptions};"string"==typeof b?(h.negotiate=!1,h.connectUri=b):h.connectUri=e.connectUri,this._protocol.setupStream(g,a,h,function(a,d){if(!d){var g=a.createStreamResponse.streamId;if(h.negotiate===!0){var i=a.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp;return B.call(f,b,g,i,function(a,b){b?c.call(f,f,"failed",null):c.call(f,f,"ok",a)},e,a.createStreamResponse.options)}return A.call(f,g,function(a,b){b?c.call(f,f,"failed",null):c.call(f,f,"ok",a)},a.createStreamResponse.options)}switch(f._logger.warn("Failed to create uploader",d),d.status){case"capacity":return c.call(f,f,d.status);default:return c.call(f,f,"failed")}})},h.prototype.subscribe=function(a,b,c){if("string"!=typeof a)throw new Error('"streamToken" must be a string');if("function"!=typeof b)throw new Error('"callback" must be a function');if(c=c||{},"object"!=typeof c)throw new Error('"options" must be an object');var d=this,e="download",f={negotiate:c.negotiate!==!1,connectUri:c.connectUri,connectOptions:c.connectOptions};this._protocol.setupStream(e,a,f,function(a,e){if(!e){var f=a.createStreamResponse.streamId,g=a.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,h=C;return g.match(/a=x-playlist:/)&&(h=D),h.call(d,f,g,function(a,c){c?b.call(d,d,"failed",null):b.call(d,d,"ok",a)},c)}switch(d._logger.warn("Failed to create downloader",e),e.status){case"capacity":case"stream-ended":case"origin-stream-ended":case"streaming-not-available":return b.call(d,d,e.status);default:return b.call(d,d,"failed")}})},h.prototype.getProtocol=function(){return this._protocol},h.prototype.getLogger=function(){return this._logger},h.prototype.getStatus=function(){return this._status},h.prototype.toString=function(){return"PhenixPCast["+this._sessionId+","+(this._protocol?this._protocol.toString():"uninitialized")+"]"};var S=function(a){var b;return b="unavailable"===a.code?"conflict":"permission-denied"===a.message?"permission-denied":"PermissionDeniedError"===a.name?"permission-denied":"InternalError"===a.name&&"Starting video failed"===a.message?"conflict":"SourceUnavailableError"===a.name?"conflict":"SecurityError"===a.name&&"The operation is insecure."===a.message?"permission-denied":"failed"};return h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a=function(){};a.bind=function(b,c){var d=Array.prototype.slice.call(arguments,2);return function(){if(!a.isFunction(b))throw new TypeError("_.bind - callback must be a function");var e=d.concat(Array.prototype.slice.call(arguments));return b.apply(c,e)}},a.now=function(){return(new Date).getTime()},a.utc=function(b){return a.isNumber(b)?b:Math.floor(b)},a.map=function(b,c){if(!a.isObject(b))throw new Error("Collection must be an object or array.");var d=[];return b.constructor===Array?a.forEach(b,function(b){a.isString(c)&&a.isObject(b)?d.push(b[c]):a.isFunction(c)&&d.push(c(b))}):a.forOwn(b,function(b){a.isFunction(c)&&d.push(c(b))}),d},a.forEach=function(c,d){if(!a.isFunction(d))throw new Error("Callback must be a function");b(c);for(var e=0;e<c.length;e++)d(c[e],e)},a.forOwn=function(b,c){if(!a.isFunction(c))throw new Error("Callback must be a function");if(!a.isObject(b))throw new Error("objectWithProperties must be an object.");for(var d=Object.keys(b),e=0;e<d.length;e++){var f=d[e];b.hasOwnProperty(f)&&c(b[f],f)}},a.includes=function(b,c){if(!a.isObject(b))throw new Error("collection type not supported. Collection must be an array or object.");var d=!1,e=function(a){a===c&&(d=!0)};return b.constructor===Array?a.forEach(b,e):a.forOwn(b,e),d},a.reduce=function(b,c,d){if(!a.isObject(b))throw new Error("collection type not supported. Collection must be an array or object.");var e=d||null;return b.constructor===Array?a.forEach(b,function(a){e=c(e,a)}):a.forOwn(b,function(a,b){e=c(e,a,b)}),e},a.sample=function(a){
return b(a),a[Math.floor(Math.random()*a.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(c,d,e){b(c);var f;return a.forEach(c,function(a,b){if(d(a)&&b>=(e||0))return f=a}),f},a.findIndex=function(c,d,e){b(c);var f;return a.forEach(c,function(a,b){if(d(a)&&b>=(e||0))return f=b}),f},a.filter=function(c,d){b(c);var e=[];return a.forEach(c,function(a){d(a)&&e.push(a)}),e},a.remove=function(c,d){b(c);var e=function(a){return!d(a)};return a.filter(c,e)},a.hasDifferences=function(b,c,d){return a.findDifferences(b,c,d).length>0},a.findDifferences=function(b,c,d){function e(e,h){g[h]=1,(a.isObject(e)||a.isArray(e))&&d?a.hasIndexOrKey(c,h)&&a.sameTypes(b[h],c[h])?a.hasDifferences(b[h],c[h],d)&&f.push(h):f.push(h):b[h]!==c[h]&&f.push(h)}var f=[],g={};if(a.isArray(b)&&a.isArray(c))b.length>c.length?a.forEach(b,e):a.forEach(c,e);else{if(!a.isObject(b)||!a.isObject(c)||a.isArray(b)||a.isArray(c))throw new Error("Object types do not match");a.forOwn(b,e),a.forOwn(c,function(a,b){g.hasOwnProperty(b)||f.push(b)})}return f},a.hasIndexOrKey=function(b,c){return a.isArray(b)?b.length>parseInt(c):!!a.isObject(b)&&b.hasOwnProperty(c)},a.sameTypes=function(b,c){return a.isNullOrUndefined(b)||a.isNullOrUndefined(c)?a.isNullOrUndefined(b)&&a.isNullOrUndefined(c):a.isArray(b)||a.isArray(c)?a.isArray(b)&&a.isArray(c):typeof b==typeof c},a.freeze=function(a){return"freeze"in Object?Object.freeze(a):a},a.noop=function(){},a.isObject=function(a){return null!==a&&"object"==typeof a},a.isArray=function(b){return!!a.isObject(b)&&b.constructor===Array},a.isString=function(a){return"string"==typeof a},a.isNumber=function(a){return!isNaN(a)&&"number"==typeof a},a.isFunction=function(a){return"function"==typeof a},a.isNullOrUndefined=function(a){return null===a||void 0===a},a.getEnumName=function(b,c){var d=null,e=a.map(b,function(a){return a});return a.isNumber(c)?d=a.find(e,function(a){return a.id===c}):a.isString(c)&&(d=a.find(e,function(a){return a.name.toLowerCase()===c.toLowerCase()})),d?d.name:null};var b=function(b){if(!a.isArray(b))throw new Error("Array must be an array.")};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(){}var b=function(){console.log.apply(console,arguments)}||function(){},c=function(){console.error.apply(console,arguments)}||b;return a.prototype.trace=function(){return b(arguments)},a.prototype.debug=function(){return b(arguments)},a.prototype.info=function(){return b(arguments)},a.prototype.warn=function(){return c(arguments)},a.prototype.error=function(){return c(arguments)},a.prototype.fatal=function(){return c(arguments)},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(7),c(12),c(1)],e=function(a,b,c,d,e){"use strict";function f(b,d,e,f){if("string"!=typeof b)throw new Error('Must pass a valid "uri"');if("string"!=typeof d)throw new Error('Must pass a valid "deviceId"');if("string"!=typeof e)throw new Error('Must pass a valid "version"');if("object"!=typeof f)throw new Error('Must pass a valid "logger"');this._uri=b,this._deviceId=d,this._version=e,this._logger=f,this._mqProtocol=new c(this._logger),this._logger.info("Connecting to [%s]",b),this._webSocket=new WebSocket(b),this._webSocket.onopen=a.bind(k,this),this._webSocket.onclose=a.bind(l,this),this._webSocket.onmessage=a.bind(m,this),this._webSocket.onerror=a.bind(n,this),this._nextRequestId=0,this._events={},this._requests={}}function g(a,b,c){var d=(this._nextRequestId++).toString(),e={requestId:d,type:a,payload:this._mqProtocol.encode(a,b)};return this._requests[d]=c,this._webSocket.send(this._mqProtocol.encode("mq.Request",e).toString("base64"))}function h(a){var b=this._events[a];return b||(this._events[a]=b=[]),b}function i(b,c){var d=this._events[b];a.remove(d,function(a){return a===c}),this._events[b]=d}function j(a,b){var c=this._events[a];if(c)for(var d=0;d<c.length;d++)c[d].apply(this,b)}function k(a){this._logger.info("Connected"),j.call(this,"connected")}function l(a){this._logger.info("Disconnected [%s]: [%s]",a.code,a.reason),j.call(this,"disconnected",[a.code,a.reason])}function m(a){this._logger.debug(">> [%s]",a.data);var b=this._mqProtocol.decode("mq.Response",d.wrap(a.data,"base64"));this._logger.info(">> [%s]",b.type);var c=this._mqProtocol.decode(b.type,b.payload);"pcast.AuthenticateResponse"===b.type?this._sessionId=c.sessionId:"pcast.StreamEnded"===b.type?j.call(this,"streamEnded",[c]):"pcast.StreamDataQuality"===b.type?j.call(this,"dataQuality",[c]):"chat.RoomEvent"===b.type?j.call(this,"roomEvent",[c]):"chat.RoomConversationEvent"===b.type&&j.call(this,"roomChatEvent",[c]);var e=this._requests[b.requestId];e&&(delete this._requests[b.requestId],"mq.Error"===b.type||"ok"!==c.status?e(void 0,c):e(c))}function n(a){this._logger.error("An error occurred",a.data)}return f.prototype.on=function(b,c){if("string"!=typeof b)throw new Error('"eventName" must be a string');if("function"!=typeof c)throw new Error('"handler" must be a function');var d=h.call(this,b);return d.push(c),a.bind(i,this,b,c)},f.prototype.authenticate=function(a,b){if("string"!=typeof a)throw new Error('"authToken" must be a string');if("function"!=typeof b)throw new Error('"callback" must be a function');var c={apiVersion:this._mqProtocol.getApiVersion(),clientVersion:this._version,deviceId:this._deviceId,platform:e.browser,platformVersion:e.browserVersion.toString(),authenticationToken:a};return this._sessionId&&(auth.sessionId=this._sessionId),g.call(this,"pcast.Authenticate",c,b)},f.prototype.getSessionId=function(){return this._sessionId},f.prototype.disconnect=function(){return delete this._sessionId,this._webSocket.close(1e3,"byebye")},f.prototype.bye=function(a,b){if("string"!=typeof a)throw new Error('"reason" must be a string');if("function"!=typeof b)throw new Error('"callback" must be a function');var c={sessionId:this._sessionId,reason:a};return g.call(this,"pcast.Bye",c,b)},f.prototype.setupStream=function(a,b,c,d){if("string"!=typeof a)throw new Error('"streamType" must be a string');if("string"!=typeof b)throw new Error('"streamToken" must be a string');if("object"!=typeof c)throw new Error('"options" must be an object');if("function"!=typeof d)throw new Error('"callback" must be a function');var f=e.browser||"UnknownBrowser",h=f+"-"+(e.browserVersion||0),i={streamToken:b,createStream:{sessionId:this._sessionId,options:["data-quality-notifications"],connectUri:c.connectUri,connectOptions:c.connectOptions||[]}};return c.negotiate&&(i.createStream.createOfferDescription={streamId:"",options:[a,f,h],apiVersion:this._mqProtocol.getApiVersion()}),g.call(this,"pcast.SetupStream",i,d)},f.prototype.setAnswerDescription=function(a,b,c){if("string"!=typeof a)throw new Error('"streamId" must be a string');if("string"!=typeof b)throw new Error('"sdp" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');var d={streamId:a,sessionDescription:{type:"Answer",sdp:b},apiVersion:this._mqProtocol.getApiVersion()};return g.call(this,"pcast.SetRemoteDescription",d,c)},f.prototype.addIceCandidates=function(a,b,c,d){if("string"!=typeof a)throw new Error('"streamId" must be a string');if(!(b instanceof Array))throw new Error('"candidates" must be an array');if(!(c instanceof Array))throw new Error('"options" must be an array');if("function"!=typeof d)throw new Error('"callback" must be a function');for(var e=[],f=0;f<b.length;f++){var h=b[f];if("string"!=typeof h.candidate)throw new Error('"candidates['+f+'].candidate" must be a string');if("number"!=typeof h.sdpMLineIndex)throw new Error('"candidates['+f+'].sdpMLineIndex" must be a number');if("string"!=typeof h.sdpMid)throw new Error('"candidates['+f+'].sdpMid" must be a string');e.push({candidate:h.candidate,sdpMLineIndex:h.sdpMLineIndex,sdpMid:h.sdpMid})}var i={streamId:a,candidates:e,options:c,apiVersion:this._mqProtocol.getApiVersion()};return g.call(this,"pcast.AddIceCandidates",i,d)},f.prototype.updateStreamState=function(a,b,c,d,e){if("string"!=typeof a)throw new Error('"streamId" must be a string');if("string"!=typeof b)throw new Error('"signalingState" must be a string');if("string"!=typeof c)throw new Error('"iceGatheringState" must be a string');if("string"!=typeof d)throw new Error('"iceConnectionState" must be a string');if("function"!=typeof e)throw new Error('"callback" must be a function');var f={streamId:a,signalingState:b,iceGatheringState:c,iceConnectionState:d,apiVersion:this._mqProtocol.getApiVersion()};return g.call(this,"pcast.UpdateStreamState",f,e)},f.prototype.destroyStream=function(a,b,c){if("string"!=typeof a)throw new Error('"streamId" must be a string');if("string"!=typeof b)throw new Error('"reason" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');var d={streamId:a,reason:b};return g.call(this,"pcast.DestroyStream",d,c)},f.prototype.getRoomInfo=function(a,c,d){a?b.isString(a,"roomId"):b.isString(c,"alias"),b.isFunction(d,"callback");var e={roomId:a,alias:c,sessionId:this._sessionId};return g.call(this,"chat.GetRoomInfo",e,function(a,b){return a&&a.status?d(a):void d(b)})},f.prototype.createRoom=function(a,c,d,e){b.isString(a,"roomName"),b.isString(c,"type"),b.isString(d,"description"),b.isFunction(e,"callback");var f={sessionId:this._sessionId,room:{name:a,description:d,type:c}};return g.call(this,"chat.CreateRoom",f,function(a,b){return a&&a.status?e(a):void e(b)})},f.prototype.enterRoom=function(a,c,d,e,f){a?b.isString(a,"roomId"):b.isString(c,"alias"),b.isObject(d,"member"),b.isNumber(e,"timestamp"),b.isFunction(f,"callback");var h={roomId:a,alias:c,sessionId:this._sessionId,member:d,timestamp:e};return g.call(this,"chat.JoinRoom",h,function(a,b){return a&&a.status?f(a):void f(b)})},f.prototype.leaveRoom=function(a,c,d){b.isString(a,"roomId"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback");var e={roomId:a,sessionId:this._sessionId,timestamp:c};return g.call(this,"chat.LeaveRoom",e,d)},f.prototype.updateMember=function(a,c,d){b.isObject(a,"member"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback"),a.updateStreams=a.hasOwnProperty("streams");var e={sessionId:this._sessionId,member:a,timestamp:c};return g.call(this,"chat.UpdateMember",e,function(a,b){return a&&a.status?d(a):void d(b)})},f.prototype.updateRoom=function(a,c,d){b.isObject(a,"room"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback");var e={sessionId:this._sessionId,room:a,timestamp:c};return g.call(this,"chat.UpdateRoom",e,d)},f.prototype.sendMessageToRoom=function(a,c,d){b.stringNotEmpty(a,"roomId"),b.isObject(c,"chatMessage");var e={roomId:a,chatMessage:c};return g.call(this,"chat.SendMessageToRoom",e,d)},f.prototype.subscribeToRoomConversation=function(a,c,d,e){b.stringNotEmpty(a,"sessionId"),b.stringNotEmpty(c,"roomId"),b.isNumber(d,"batchSize");var f={sessionId:a,roomId:c,limit:d,options:["Subscribe"]};return g.call(this,"chat.FetchRoomConversation",f,e)},f.prototype.getMessages=function(a,c,d,e,f,h){b.stringNotEmpty(a,"sessionId"),b.stringNotEmpty(c,"roomId"),f&&e||b.isNumber(d,"batchSize");var i={sessionId:a,roomId:c,limit:d||0,options:[]};return f&&(b.stringNotEmpty(f,"beforeMessageId"),i.beforeMessageId=f),e&&(b.stringNotEmpty(e,"afterMessageId"),i.afterMessageId=e),g.call(this,"chat.FetchRoomConversation",i,h)},f.prototype.toString=function(){return"PCastProtocol["+this._uri+","+this._webSocket.readyState+"]"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3)],e=function(a){"use strict";var b=function(){};return b.prototype.isObject=function(b,c){var d='"'+c+'" must be an object';if(!a.isObject(b))throw new Error(d)},b.prototype.isArray=function(b,c){var d='"'+c+'" must be an array';if(!a.isArray(b))throw new Error(d)},b.prototype.isString=function(b,c){var d='"'+c+'" must be a string';if(!a.isString(b))throw new Error(d)},b.prototype.isNumber=function(b,c){var d='"'+c+'" must be a number';if(!a.isNumber(b))throw new Error(d)},b.prototype.isFunction=function(b,c){var d='"'+c+'" must be a function';if(!a.isFunction(b))throw new Error(d)},b.prototype.stringNotEmpty=function(a,b){var c='"'+b+'" must not be empty';if(this.isString(a,b),""===a)throw new Error(c)},new b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(8),c(9),c(10),c(11)],e=function(a,b,c,d,e){"use strict";function f(f){this._logger=f||new a;var g=b.loadJson(c);g=b.loadJson(d,g),g=b.loadJson(e,g),this._builders=g.build(),this._apiVersion=3}function g(a){for(var b=a.split("."),c=this._builders,d=0;d<b.length-1;d++)if(c=c[b[d]],!c)throw new Error('Unsupported type "'+a+'"');if(c=c[b[b.length-1]],"function"!=typeof c)throw new Error('Unsupported type "'+a+'"');return c}function h(a){if(a&&a.$type&&a.$type.children)for(var b in a.$type.children){var c=a.$type.children[b],d=a[c.name],e=c&&c.element?c.element.resolvedType:null;if(e&&"Message"===e.className&&e.children)a[c.name]=h(d);else if(e&&"Enum"===e.className&&e.children){for(var f=null,g=0;g<e.children.length;g++)if(e.children[g].id===d){f=e.children[g];break}f&&f.name&&(a[c.name]=f.name)}}return a}return f.prototype.getApiVersion=function(){return this._apiVersion},f.prototype.encode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");if("object"!=typeof b)throw new Error("'data' must be an object");var c=g.call(this,a);return c.encode(b)},f.prototype.decode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");var c=g.call(this,a);return h(c.decode(b))},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,c){a.exports=b},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"mq",messages:[{name:"Request",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5}]},{name:"Response",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"pcast",messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{"default":0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{"default":"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{"default":0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{"default":0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ArchiveStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"ArchiveStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"uri",id:2}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"ForwardToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"ForwardToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{"default":0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{"default":"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{"default":80}},{rule:"optional",type:"string",name:"method",id:4,options:{"default":"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{"default":"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"reason",id:4}]},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"chat",messages:[{name:"Room",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"name",id:3},{rule:"required",type:"string",name:"description",id:4},{rule:"required",type:"RoomType",name:"type",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"optional",type:"string",name:"bridgeId",id:7},{rule:"optional",type:"string",name:"pin",id:8}]},{name:"Stream",fields:[{rule:"required",type:"StreamType",name:"type",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"TrackState",name:"audioState",id:3},{rule:"required",type:"TrackState",name:"videoState",id:4}]},{name:"Member",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"required",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"MemberUpdate",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"screenName",id:2},{rule:"optional",type:"MemberRole",name:"role",id:3},{rule:"required",type:"bool",name:"updateStreams",id:7,options:{"default":!1}},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"optional",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"ChatUser",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"required",type:"uint64",name:"lastUpdate",id:4}]},{name:"ChatMessage",fields:[{rule:"required",type:"string",name:"messageId",id:1},{rule:"required",type:"uint64",name:"timestamp",id:2},{rule:"required",type:"ChatUser",name:"from",id:3},{rule:"required",type:"string",name:"message",id:4}]},{name:"CreateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2}]},{name:"CreateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2}]},{name:"JoinRoom",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"required",type:"Member",name:"member",id:4},{rule:"repeated",type:"string",name:"options",id:5},{rule:"required",type:"uint64",name:"timestamp",id:6}]},{name:"JoinRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"UpdateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"UpdateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"UpdateMember",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"MemberUpdate",name:"member",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"required",type:"uint64",name:"timestamp",id:4}]},{name:"UpdateMemberResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"uint64",name:"lastUpdate",id:2}]},{name:"LeaveRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"sessionId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"LeaveRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DestroyRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1}]},{name:"DestroyRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"GetRoomInfo",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"applicationId",id:4},{rule:"optional",type:"string",name:"secret",id:5},{rule:"repeated",type:"string",name:"options",id:6}]},{name:"GetRoomInfoResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",
id:4}]},{name:"RoomEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomEventType",name:"eventType",id:3},{rule:"repeated",type:"Member",name:"members",id:4},{rule:"optional",type:"Room",name:"room",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"required",type:"uint64",name:"timestamp",id:7}]},{name:"SendMessageToRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"ChatMessage",name:"chatMessage",id:2}]},{name:"SendMessageToRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"FetchRoomConversation",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"optional",type:"string",name:"afterMessageId",id:3},{rule:"optional",type:"string",name:"beforeMessageId",id:4},{rule:"required",type:"uint32",name:"limit",id:5},{rule:"repeated",type:"RoomConversationOption",name:"options",id:6}]},{name:"FetchRoomConversationResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:2}]},{name:"RoomConversationEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomConversationEventType",name:"eventType",id:3},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:4}]}],enums:[{name:"RoomType",values:[{name:"DirectChat",id:0},{name:"MultiPartyChat",id:1},{name:"ModeratedChat",id:2},{name:"TownHall",id:3},{name:"Channel",id:4}]},{name:"MemberRole",values:[{name:"Participant",id:0},{name:"Moderator",id:1},{name:"Presenter",id:2},{name:"Audience",id:3}]},{name:"MemberState",values:[{name:"Active",id:0},{name:"Passive",id:1},{name:"HandRaised",id:2},{name:"Inactive",id:3},{name:"Offline",id:4}]},{name:"RoomEventType",values:[{name:"MemberJoined",id:0},{name:"MemberLeft",id:1},{name:"MemberUpdated",id:2},{name:"RoomUpdated",id:3},{name:"RoomEnded",id:4}]},{name:"TrackState",values:[{name:"TrackEnabled",id:0},{name:"TrackDisabled",id:1},{name:"TrackEnded",id:2}]},{name:"StreamType",values:[{name:"User",id:0},{name:"Presentation",id:1},{name:"Audio",id:2}]},{name:"RoomConversationOption",values:[{name:"Subscribe",id:0}]},{name:"RoomConversationEventType",values:[{name:"Message",id:0}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){a.exports=c},function(a,b,c){var d,e;d=[c(14),c(15)],e=function(a,b){"use strict";function c(b,c,d){if("string"!=typeof b)throw new Error('Must pass a valid "version"');if("string"!=typeof c)throw new Error('Must pass a valid "baseUri"');if("object"!=typeof d)throw new Error('Must pass a valid "logger"');this._version=b,this._baseUri=c,this._logger=d,this._http=new a(b,c,d)}function d(a,c){if(0===a.lastIndexOf("wss:",0))c(void 0,a+"/ws");else if(0===a.lastIndexOf("https:",0)){var d=this;e.call(d,a,function(a,e){if(a)return c(a);var f=new b(c,d._version,d._baseUri,d._logger);f.resolveAll(e)})}else c(new Error("Uri not supported"))}function e(a,b){this._http.httpGetWithRetry(a+"/pcast/endPoints",function(a,c){if(a)return b(new Error("Failed to resolve an end point",a));var d=c.split(",");d.length<1&&b(new Error("Failed to discover end points")),b(void 0,d)},f)}var f=3;return c.DefaultPCastUri="https://pcast.phenixp2p.com",c.prototype.getBaseUri=function(){return this._baseUri},c.prototype.resolveUri=function(a){return d.call(this,this._baseUri,a)},c.prototype.toString=function(){return"PCastEndPoint["+this._baseUri+"]"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3)],e=function(a){"use strict";function b(a,b,c){if("string"!=typeof a)throw new Error('Must pass a valid "version"');if("string"!=typeof b)throw new Error('Must pass a valid "baseUri"');if("object"!=typeof c)throw new Error('Must pass a valid "logger"');this._version=a,this._baseUri=b,this._logger=c}return b.prototype.httpGetWithRetry=function c(b,d,e,f){void 0===f&&(f=1);var g=this,h=new XMLHttpRequest,i="GET",j=b+"?version="+encodeURIComponent(g._version)+"&_="+a.now();if("withCredentials"in h)h.open(i,j,!0);else if("undefined"!=typeof XDomainRequest)h=new XDomainRequest,h.open(i,j);else{var k=new Error("unsupported");k.code="unsupported",d(k)}h.addEventListener("readystatechange",function(){if(4===h.readyState)if(200===h.status)d(void 0,h.responseText);else if(h.status>=500&&h.status<600&&f<=e)c.call(g,b,d,e,f+1);else{g._logger.info("HTTP GET [%s] failed with [%s] [%s]",b,h.status,h.statusText);var a=new Error(0===h.status?"timeout":h.statusText);a.code=h.status,d(a)}}),h.timeout=15e3,h.send()},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(14)],e=function(a,b){"use strict";function c(a,c,d,e){this._done=!1,this._minTime=Number.MAX_VALUE,this._minResponseText="",this._onClosestEndpointFound=a,this._logger=e,this._version=c,this._http=new b(c,d,e)}var d=4;return c.prototype.isResolved=function(){return this._done},c.prototype.measurementCallback=function(a,b,c){return b<this._minTime&&(this._logger.info("Current closest end point is [%s] with latency of [%s] ms",c,b),this._minTime=b,this._minResponseText=c),this.isResolved()},c.prototype.completeCallback=function(a){if(this._minResponseText&&this._minTime<Number.MAX_VALUE&&!this.isResolved())return this._done=!0,this._onClosestEndpointFound(void 0,this._minResponseText)},c.prototype.resolveAll=function(a){for(var b=0;b<a.length;b++)this.resolve(a[b],d)},c.prototype.resolve=function(b,c){var d=this,e=1,f=function g(b){var f=1,h=a.now();d._logger.info("[%s] Checking end point [%s]",e,b),d._http.httpGetWithRetry.call(d,b,function(f,i){var j=a.now(),k=j-h;if(d._logger.info("[%s] End point [%s] latency is [%s] ms",e,b,k),e++,f||!d.measurementCallback(b,k,i))return e<=c&&!d.isResolved()?(f&&d._logger.info("Retrying after failure to resolve end point [%s]",b,f),g(b)):d.completeCallback(b)},f)};f(b)},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(1)],e=function(a,b){"use strict";function c(a,b,c){if("string"!=typeof a)throw new Error('Must pass a valid "name"');if("object"!=typeof b)throw new Error('Must pass a valid "peerConnection"');if("object"!=typeof c)throw new Error('Must pass a valid "logger"');this._name=a,this._peerConnection=b,this._logger=c}function d(c,d,e,o,p){function q(){var i=null;f(d,i,function(f){function i(d,f){switch(b.browser){case"Firefox":if(n=m|=d.selected&&"succeeded"===d.state,"outbound"===e.direction&&"outboundrtp"===d.type){var g={time:a.now(),value:d.bytesSent||0};switch(d.mediaType){case"video":r._logger.debug("[%s] Outbound [%s] [%s] with bitrate [%s], droppedFrames [%s] and frame rate [%s]",c,d.mediaType,d.ssrc,d.bitrateMean,d.droppedFrames,d.framerateMean),j=!0,t=d.framerateMean||0,k=!0,u=h(g,w),w=g;break;case"audio":r._logger.debug("[%s] Outbound [%s] [%s]",c,d.mediaType,d.ssrc),l=!0,v=h(g,x),x=g}}if("inbound"===e.direction&&"inboundrtp"===d.type){var g={time:a.now(),value:d.bytesReceived||0};switch(d.mediaType){case"video":r._logger.debug("[%s] Inbound [%s] [%s] with framerate [%s] and jitter [%s]",c,d.mediaType,d.ssrc,d.framerateMean,d.jitter),k=!0,u=h(g,w),w=g;break;case"audio":r._logger.debug("[%s] Inbound [%s] [%s] with jitter [%s]",c,d.mediaType,d.ssrc,d.jitter),l=!0,v=h(g,x),x=g}}break;default:if("true"===d.googWritable&&(n=!0),"true"===d.googReadable&&(m=!0),"ssrc"!==d.type)return;if("outbound"===e.direction){var g={time:a.now(),value:d.bytesSent||0};switch(d.mediaType){case"video":r._logger.debug("[%s] Outbound [%s] [%s] with average encoding time [%s] ms (CPU limited=[%s]) and RTT [%s]",c,d.mediaType,d.ssrc,d.googAvgEncodeMs,d.googCpuLimitedResolution,d.googRtt),j=!0,t=d.googFrameRateSent||0,k=!0,u=h(g,w),w=g;break;case"audio":r._logger.debug("[%s] Outbound [%s] [%s] with audio input level [%s] and RTT [%s] and jitter [%s]",c,d.mediaType,d.ssrc,d.audioInputLevel,d.googRtt,d.googJitterReceived),l=!0,v=h(g,x),x=g}}else if("inbound"===e.direction){var g={time:a.now(),value:d.bytesReceived||0};switch(d.mediaType){case"video":r._logger.debug("[%s] Inbound [%s] [%s] with current delay [%s] ms and target delay [%s] ms",c,d.mediaType,d.ssrc,d.googCurrentDelayMs,d.googTargetDelayMs),j=!0,t=d.googFrameRateReceived||0,k=!0,u=h(g,w),w=g;break;case"audio":r._logger.debug("[%s] Inbound [%s] [%s] with output level [%s] and jitter [%s] and jitter buffer [%s] ms",c,d.mediaType,d.ssrc,d.audioOutputLevel,d.googJitterReceived,d.googJitterBufferMs),l=!0,v=h(g,x),x=g}}}}var j=!1,k=!1,l=!1,m=!1,n=!1;if(f.forEach)f.forEach(i);else for(var H in f){var I=f[H];i(I,H)}if(k&&0===u||l&&0===v||j&&0===t){var J=g.call(r,d);k=k&&J.video&&J.video.enabled!==!1,l=l&&J.audio&&J.audio.enabled!==!1,j=j&&J.video&&J.video.enabled!==!1,m=m||!(J.video&&J.video.enabled!==!1||J.audio&&J.audio.enabled!==!1),n=n||!(J.video&&J.video.enabled!==!1||J.audio&&J.audio.enabled!==!1)}if((l||k||j)&&r._logger.debug("[%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",c,Math.ceil(v||0),Math.ceil(u||0),t||"?"),!o())return void r._logger.info("[%s] Finished monitoring of peer connection",c);if(!G||"closed"!==d.connectionState&&"failed"!==d.connectionState&&"failed"!==d.iceConnectionState)E&&j&&t<=y?s++:F&&l&&v<=A?s++:F&&k&&u<=z?s++:m&&n?s=0:s++;else{var J=g.call(r,d),K=0,L=0;for(var M in J){var N=J[M];N&&N.enabled!==!1?K++:L++}if(0===K&&L>0)return void r._logger.info("[%s] Finished monitoring of peer connection with [%s] inactive tracks",c,L);s++}s>=B?p("condition",t,u,v)?(s=Number.MIN_VALUE,setTimeout(q,C)):r._logger.error("[%s] Failure detected with frame rate [%s] FPS and bit rate [%s/%s] bps: [%s]",c,t,v,u,f):setTimeout(q,s>0?D:C)},function(a){p("error",a)})}if("string"!=typeof c)throw new Error('Must pass a valid "name"');if("object"!=typeof d)throw new Error('Must pass a valid "peerConnection"');if("object"!=typeof e)throw new Error('Must pass a valid "options"');if("function"!=typeof o)throw new Error('Must pass a valid "activeCallback"');if("function"!=typeof p)throw new Error('Must pass a valid "monitorCallback"');if("inbound"!==e.direction&&"outbound"!==e.direction)throw new Error("Invalid monitoring direction");var r=this,s=0,t=void 0,u=void 0,v=void 0,w={time:a.now(),value:0},x={time:a.now(),value:0},y=e.frameRateThreshold||k,z=e.videoBitRateThreshold||m,A=e.audioBitRateThreshold||l,B=e.conditionCountForNotificationThreshold||n,C=e.monitoringInterval||i,D=e.monitoringInterval||j,E=!e.hasOwnProperty("monitorFrameRate")||e.monitorFrameRate,F=!e.hasOwnProperty("monitorBitRate")||e.monitorBitRate,G=!e.hasOwnProperty("monitorState")||e.monitorState;setTimeout(q,C)}function e(a){if("Firefox"===b.browser)return a;var c={};return a.result().forEach(function(a){var b={id:a.id,type:a.type};a.names().forEach(function(c){b[c]=a.stat(c)}),c[b.id]=b}),c}function f(a,c,d,f){switch(b.browser){case"Firefox":return a.getStats(c).then(function(a){var b=e(a);d(b)})["catch"](function(a){f("error",a)});default:return a.getStats(function(a){var b=e(a);d(b)},c,function(a){f("error",a)})}}function g(a){var b={},c=a.localDescription.sdp.split("m="),d=a.remoteDescription.sdp.split("m=");if(c.length!==d.length)return{};for(var e=1;e<c.length;e++){var f=c[e];f.startsWith("audio")?b.audio={enabled:f.indexOf("a=inactive")===-1&&d[e].indexOf("a=inactive")===-1}:f.startsWith("video")&&(b.video={enabled:f.indexOf("a=inactive")===-1&&d[e].indexOf("a=inactive")===-1})}return b}function h(a,b){return 8*(a.value-b.value)/((a.time-b.time)/1e3)}var i=4e3,j=1500,k=2,l=5e3,m=6e3,n=3;return c.prototype.start=function(a,b,c){return d.call(this,this._name,this._peerConnection,a,b,c)},c.prototype.toString=function(){return"PeerConnectionMonitor[]"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(a){if(!a)throw new Error("'logger' must be specified.");this._logger=a,this._dimensionsChangedIntervalId=null,this._videoDisplayDimensionsChangedCallback=null,this._toBeStarted=!1,this._videoElement=null,this._dimensionsChangedData={pollFrequency:f,previousWidth:0,previousHeight:0},this._renderer=null}function b(a,b){b&&void 0!==b.videoWidth||this._logger.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this._renderer=a,this._videoElement=b,this._toBeStarted=!0,e.call(this)}function c(){this._toBeStarted=!1,this._dimensionsChangedIntervalId&&(clearInterval(this._dimensionsChangedIntervalId),this._dimensionsChangedIntervalId=null)}function d(a,b){if(null===a)return this._videoDisplayDimensionsChangedCallback=null,void c.call(this);if("function"!=typeof a)throw new Error('"callback" must be a function');this._videoDisplayDimensionsChangedCallback=a,b&&b.pollFrequency&&(this._dimensionsChangedData.pollFrequency=b.pollFrequency>=g?b.pollFrequency:g),e.call(this)}function e(){if(this._toBeStarted&&!this._dimensionsChangedIntervalId&&this._videoDisplayDimensionsChangedCallback){var a=this;this._dimensionsChangedData.previousWidth=this._videoElement.videoWidth,this._dimensionsChangedData.previousHeight=this._videoElement.videoHeight,this._dimensionsChangedIntervalId=setInterval(function(){a._videoElement.videoWidth===a._dimensionsChangedData.previousWidth&&a._videoElement.videoHeight===a._dimensionsChangedData.previousHeight||(a._dimensionsChangedData.previousWidth=a._videoElement.videoWidth,a._dimensionsChangedData.previousHeight=a._videoElement.videoHeight,a._videoDisplayDimensionsChangedCallback(a._renderer,{width:a._videoElement.videoWidth,height:a._videoElement.videoHeight}))},a._dimensionsChangedData.pollFrequency)}}var f=500,g=15;return a.prototype.start=function(a,c){b.call(this,a,c)},a.prototype.stop=function(){c.call(this)},a.prototype.setVideoDisplayDimensionsChangedCallback=function(a,b){d.call(this,a,b)},a.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this._dimensionsChangedData.pollFrequency+", previousHeight="+this._dimensionsChangedData.previousHeight+", previousWidth="+this._dimensionsChangedData.previousHeight+", state="+(this._dimensionsChangedIntervalId?"running":"stopped")+"]"},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(20),c(21),c(4),c(28),c(19),c(22),c(30),c(27),c(26)],e=function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){b.isObject(a,"pcast"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),this._self=new c(null),this._activeRoom=new c(null),this._cachedRoom=new c(null),this._roomChatService=null,b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),this._authService=new f(this._pcast)}function m(a){var b=this._self.getValue().toJson();this._self.setValue(new h(b.state,a,b.screenName,b.role,b.streams,b.lastUpdate,this))}function n(){var b=this,c=b._activeRoom.getValue();if(a.isObject(c)){var d=c.getRoomId(),e=c.getObservableAlias().getValue();b.leaveRoom(function(){b.enterRoom(d,e,function(){b._logger.info("Room Reset Completed")})})}}function o(a,b){var c=b.room,d=b.members,e=new g(c.roomId,c.alias,c.name,c.description,c.type,d,c.bridgeId,c.pin,this),f=new g(c.roomId,c.alias,c.name,c.description,c.type,d,c.bridgeId,c.pin,this);p.call(this,e),this._activeRoom.setValue(e),this._cachedRoom.setValue(f),a(e,"ok",null)}function p(b){var c=this._self.getValue(),d=b.getObservableMembers().getValue(),e=a.findIndex(d,function(a){return c.getSessionId()===a.getSessionId()});if(!a.isNumber(e))throw new Error("Invalid Room State: Self member not in room list of members.");c._update(d[e].toJson()),d[e]=c,b.getObservableMembers().setValue(d)}function q(c){b.isObject(c,"event"),b.isString(c.roomId,"event.roomId"),b.isString(c.eventType,"event.eventType"),b.isArray(c.members,"event.members"),a.forEach(c.members,function(a){b.isObject(a,"member")});var d=this;switch(c.eventType){case j.events.memberJoined.name:return d._logger.debug("[%s] Member joined [%s]",c.roomId,c.members),r.call(d,c.roomId,c.members);case j.events.memberLeft.name:return d._logger.debug("[%s] Member left [%s]",c.roomId,c.members),s.call(d,c.roomId,c.members);case j.events.memberUpdated.name:return d._logger.debug("[%s] Member updated [%s]",c.roomId,c.members),t.call(d,c.roomId,c.members);case j.events.roomUpdated.name:return d._logger.debug("[%s] Room updated [%s]",c.roomId,c.room),u.call(d,c.roomId,c.room);case j.events.roomEnded.name:d._logger.info("[%s] Room ended",c.roomId);break;default:d._logger.warn("Unsupported room event [%s]",c.eventType)}}function r(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(c._removeMembers(b),c._addMembers(b),d._removeMembers(b),d._addMembers(b),this._logger.info("[%s] Room has now [%d] members",a,c.getObservableMembers().getValue().length))}function s(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(c._removeMembers(b),d._removeMembers(b),this._logger.info("[%s] Room has now [%d] members",a,c.getObservableMembers().getValue().length))}function t(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(c._updateMembers(b),d._updateMembers(b),this._logger.info("[%s] Room has [%d] updated members",a,b.length))}function u(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(d._update(b),c._update(b))}function v(a){m.call(this,a)}function w(a,b){var c=b.getValue(),d=c.getObservableMembers().getValue();return x(a,d)}function x(b,c){return a.find(c,function(a){return b===a.getSessionId()})}function y(b){this._logger.info("PCast status changed to [%s]",b),"offline"!==b.toLowerCase()&&"offline"===this._lastPcastStatus||"offline"===b.toLowerCase()&&"offline"!==this._lastPcastStatus&&!a.isNullOrUndefined(this._lastPcastStatus),this._lastPcastStatus=b}function z(){var b=this._self.subscribe(a.bind(n,this)),c=this._authService.getObservableStatus().subscribe(a.bind(y,this)),d=this._authService.getObservableSessionId().subscribe(a.bind(v,this));this._disposables.push(b.dispose),this._disposables.push(c.dispose),this._disposables.push(d.dispose)}function A(b){if(a.isArray(b))for(var c=0;c<b.length;c++)"function"==typeof b[c]&&b[c]()}function B(b,c){var d=C(b,c);return d.sessionId=b.getSessionId(),d.lastUpdate=c?c.getLastUpdate():a.now(),d}function C(b,c){if(null===c)return b.toJson();var d={},e=b.toJson(),f=c.toJson(),g=a.findDifferences(e,f,!0);return a.forEach(g,function(a){d[a]=e[a]}),d}function D(a,b,c){this._authService.assertAuthorized(),this._protocol.getRoomInfo(a,b,function(a){return"ok"!==a.status?c(a.room,a.status,a.reason):void c(a.room,a.status,null)})}function E(a,b,c,d){this._authService.assertAuthorized(),this._protocol.createRoom(a,b,c,function(a){if("ok"!==a.status&&"already-exists"!==a.status)throw new Error(a.reason);d(a)})}function F(b,c,d){this._authService.assertAuthorized();var e=this._self.getValue(),f=e.getObservableScreenName().getValue(),g=e.getObservableRole().getValue(),h=B.call(this,e,null),i=a.now();this._logger.info("Enter room [%s]/[%s] with screen name [%s] and role [%s]",b,c,f,g),this._protocol.enterRoom(b,c,h,i,function(a){if("ok"!==a.status)throw new Error("Joining of room failed: "+a.status);d(a)})}function G(b){if(!this._activeRoom.getValue())return this._logger.warn("Unable to leave room. Not currently in a room.");this._authService.assertAuthorized();var c=this._activeRoom.getValue().getRoomId(),d=a.now();this._logger.info("Leave room [%s]",c),this._protocol.leaveRoom(c,d,function(a){if("ok"!==a.status)throw new Error("Leaving room failed: "+a.status);b(a.status)})}function H(b,c){if(!this._activeRoom.getValue())return this._logger.warn("notInRoomError"),c("not-in-room",J);this._authService.assertAuthorized();var d=w(b.getSessionId(),this._cachedRoom),e=B.call(this,b,d),f=a.now();this._logger.info("Updating member info for active room");var g=this;this._protocol.updateMember(e,f,function(a){return"ok"!==a.status?(g._logger.warn("Update of member failed: "+a.status),c("failed","Update of member failed: "+a.status)):c("ok",null)})}function I(b){if(!this._activeRoom.getValue())return this._logger.warn("notInRoomError"),b("not-in-room",J);this._authService.assertAuthorized();var c=this._activeRoom.getValue(),d=a.now(),e=this;this._protocol.updateRoom(c.toJson(),d,function(a){return"ok"!==a.status?(e._logger.warn("Update of room failed: "+a.status),b("failed","Update of member failed: "+a.status)):b(a.status,null)})}l.prototype.start=function(d,e){b.stringNotEmpty(d,"role"),b.stringNotEmpty(e,"screenName"),this._authService.start();var f=k.states.passive.name,g=this._authService.getPCastSessionId(),i=e,j=[],l=a.now(),m=new h(f,g,i,d,j,l);this._self=new c(m),this._disposables=[];var n=this._protocol.on("roomEvent",a.bind(q,this));return this._disposables.push(n),z.call(this),m},l.prototype.getRoomInfo=function(a,c,d){a?b.stringNotEmpty("roomId",a):b.stringNotEmpty("alias",c),b.isFunction(d),D.call(this,a,c,d)},l.prototype.createRoom=function(a,c,d,e){b.isString(a,"name"),b.isString(c,"type"),b.isString(d,"description"),b.isFunction(e),E.call(this,a,c,d,function(a){e(a.room)})},l.prototype.enterRoom=function(c,d,e){c?b.stringNotEmpty("roomId",c):b.stringNotEmpty("alias",d),b.isFunction(e),F.call(this,c,d,a.bind(o,this,e))},l.prototype.leaveRoom=function(a){var b=this;return G.call(b,function(c){b._roomChatService&&b._roomChatService.stop(),b._roomChatService=null,b._activeRoom.setValue(null),b._cachedRoom.setValue(null),a(c)})},l.prototype.getRoomChatService=function(){return!this._roomChatService&&this._activeRoom.getValue()&&(this._roomChatService=new i(this)),this._roomChatService},l.prototype.getSelf=function(){return this._self.getValue()},l.prototype.getObservableActiveRoom=function(){return this._activeRoom},l.prototype.updateSelf=function(a){b.isFunction(a),H.call(this,this.getSelf(),a)},l.prototype.updateMember=function(a,c){b.isFunction(c),b.isObject(a),H.call(this,a,c)},l.prototype.updateRoom=function(a){b.isFunction(a),I.call(this,a)},l.prototype.revertRoomChanges=function(){var a=this._activeRoom.getValue(),b=this._cachedRoom.getValue();return a&&b?void a._update(b.toJson()):this._logger.warn("Unable to revert changes to room. Not currently in a room.")},l.prototype.revertMemberChanges=function(a){b.isObject(a);var c=w(a.getSessionId(),this._cachedRoom),d=w(a.getSessionId(),this._activeRoom);return c&&d?void d._update(c.toJson()):this._logger.warn("Unable to revert changes to member. Member is currently not in room.")},l.prototype.toString=function(){return"RoomService"},l.prototype.stop=function(){this._authService.stop(),A(this._disposables)};var J="Not in a room. Please Enter a room before updating self.";return l}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(20),c(21),c(22),c(27)],e=function(a,b,c,d,e,f){"use strict";function g(a,b,c,d,e,f,g,h,i){this.init(a,b,c,d,e,f,g,h,i)}function h(a){var b=i(a);this._members.setValue(b)}function i(b){return a.map(b,function(a){return new e(a.state,a.sessionId,a.screenName,a.role,a.streams,a.lastUpdate)})}function j(b){if(b=a.getEnumName(k,b),!b)throw new Error('"type" must be a valid room type');return b}var k=f.types;return g.prototype.init=function(a,e,f,g,i,k,l,m,n){b.isString(a,"id"),b.isString(e,"alias"),b.isString(f,"name"),b.isString(g,"description"),b.isArray(k,"members"),l&&b.isString(l,"bridgeId"),m&&b.isString(m,"pin"),this._roomId=new c(a),this._alias=new c(e),this._name=new c(f),this._description=new c(g),this._type=new c(i,j),this._members=new d([]).extend({method:"notifyWhenChangesStop",timeout:400}),this._options=new d,this._bridgeId=new c(l),this._pin=new c(m),this._roomService=n,h.call(this,k)},g.prototype.getRoomId=function(){return this._roomId.getValue()},g.prototype.getObservableAlias=function(){return this._alias},g.prototype.getObservableName=function(){return this._name},g.prototype.getObservableDescription=function(){return this._description},g.prototype.getObservableType=function(){return this._type},g.prototype.getObservableMembers=function(){return this._members},g.prototype.getObservableBridgeId=function(){return this._bridgeId},g.prototype.getObservablePin=function(){return this._pin},g.prototype.toString=function(){return this._type.getValue()+"["+this._roomId.getValue()+"]"},g.prototype.toJson=function(){return{roomId:this._roomId.getValue(),alias:this._alias.getValue(),name:this._name.getValue(),description:this._description.getValue(),type:this._type.getValue(),pin:this._pin.getValue(),bridgeId:this._bridgeId.getValue()}},g.prototype.commitChanges=function(a){this._roomService.updateRoom(this,a)},g.prototype.reload=function(){this._roomService.revertRoomChanges(this)},g.prototype._update=function(b){a.isObject(b)&&(b.roomId&&this._roomId.setValue(b.roomId),b.alias&&this._alias.setValue(b.alias),b.name&&this._name.setValue(b.name),b.description&&this._description.setValue(b.description),b.type&&this._type.setValue(b.type),b.options&&this._options.setValue(b.options),b.bridgeId&&this._bridgeId.setValue(b.bridgeId),b.pin&&this._pin.setValue(b.pin),b.members)},g.prototype._addMembers=function(b){var c=this,d=i(b);a.forEach(d,function(a){c._members.push(a)})},g.prototype._removeMembers=function(b){var c=this;a.forEach(b,function(a){c._members.remove(function(b){return a.sessionId===b.getSessionId()&&a.lastUpdate>=b.getObservableLastUpdate().getValue()})})},g.prototype._updateMembers=function(b){a.forEach(this._members.getValue(),function(c){var d=a.find(b,function(a){return c.getSessionId()===a.sessionId&&a.lastUpdate>c.getObservableLastUpdate().getValue()});d&&c._update(d)})},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6)],e=function(a,b){"use strict";function c(a,b){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=b,e.call(this,a)}function d(b){return"undefined"==typeof b||null===b?b:a.isArray(b)?b.slice():b}function e(a){var b=a;this.beforeChange&&(b=this.beforeChange(a)),this.latestValue=d(b)}function f(b){this.lastChangeTime=a.now(),this.isPendingChanges||0===this.subscriptionCount||(this.isPendingChanges=!0,g.call(this,b))}function g(b){var c=this;setTimeout(function(){var b=a.now()-c.lastChangeTime;if(c.resetOnChange&&b<c.subscriptionTimeout)g.call(c,c.subscriptionTimeout-b);else try{h.call(c)}finally{c.isPendingChanges=!1}},b)}function h(){var b=this;a.forOwn(b.subscribeCallbacks,function(c){a.isFunction(c)&&c(b.latestValue)})}return c.prototype.getValue=function(){return d(this.latestValue)},c.prototype.setValue=function(a){a!==this.latestValue&&(e.call(this,a),f.call(this,this.subscriptionTimeout))},c.prototype.subscribe=function(c,d){function e(){delete h.subscribeCallbacks[i],g&&(clearInterval(g),g=null),h.subscriptionCount-=1}b.isFunction(c),d&&b.isObject(d);var g,h=this,i=a.uniqueId();return h.subscribeCallbacks[i]=c,h.subscriptionCount+=1,d&&("notify"===d.initial&&f.call(h,h.subscriptionTimeout),d.listenForChanges&&(g=setInterval(function(){var a=d.listenForChanges.callback();a!==h.latestValue&&h.setValue(a)},d.listenForChanges.timeout))),{dispose:e}},c.prototype.extend=function(c){switch(b.isObject(c),c.method){case"notifyWhenChangesStop":this.subscriptionTimeout=c.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=c.timeout}return a.isNumber(c.rateLimit)&&(this.subscriptionTimeout=c.rateLimit),this},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(20)],e=function(a,b,c){"use strict";function d(a,d){var e=a;void 0!==e&&null!==e||(e=[]),b.isArray(e),this.observableArray=new c(e,d)}return d.prototype.getValue=function(){return this.observableArray.getValue()},d.prototype.setValue=function(a){return void 0!==a&&null!==a||(a=[]),void 0!==a&&b.isArray(a),this.observableArray.setValue(a)},d.prototype.subscribe=function(a,b){return this.observableArray.subscribe(a,b)},d.prototype.push=function(a){var b=this.observableArray.getValue();b.push(a),this.observableArray.setValue(b)},d.prototype.pop=function(){var a=this.observableArray.getValue(),b=a.pop();return this.observableArray.setValue(a),b},d.prototype.remove=function(b){var c=this.observableArray.getValue(),d=function(c){return a.isFunction(b)?b(c):c===b},e=a.filter(c,d);return e.length>0&&this.observableArray.setValue(a.remove(c,d)),e},d.prototype.removeAll=function(){var a=this.observableArray.getValue();return this.observableArray.setValue([]),a},d.prototype.extend=function(a){return this.observableArray.extend(a),this},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(20),c(21),c(23),c(26)],e=function(a,b,c,d,e,f){"use strict";function g(a,b,c,d,e,f,g){this.init(a,b,c,d,e,f,g)}function h(a){return new e(a.uri,a.type,a.audioState,a.videoState)}function i(b){var c=this._streams.getValue(),d=[];a.forEach(b,function(b){var e=a.find(c,function(a){return a.getUri()===b.uri&&a.getType()===b.type});e?e._update(b):e=h(b),d.push(e)}),this._streams.setValue(d)}function j(b){if(b=a.getEnumName(l,b),!b)throw new Error('"role" must be a valid member role');return b}function k(b){if(b=a.getEnumName(m,b),!b)throw new Error('"state" must be a valid member state');return b}var l=f.roles,m=f.states;return g.prototype.init=function(e,f,g,h,i,l,m){b.isString(f,"sessionId"),b.isString(g,"screenName"),b.isArray(i,"streams"),b.isNumber(a.utc(l),"lastUpdate"),this._sessionId=new c(f),this._screenName=new c(g),this._streams=new d([]),this._state=new c(e,k).extend({rateLimit:500}),this._role=new c(h,j),this._lastUpdate=new c(l,a.utc),this._roomService=m,this.setStreams(i)},g.prototype.getObservableState=function(){return this._state},g.prototype.getSessionId=function(){return this._sessionId.getValue()},g.prototype.getObservableScreenName=function(){return this._screenName},g.prototype.getObservableRole=function(){return this._role},g.prototype.getObservableStreams=function(){return this._streams},g.prototype.getObservableLastUpdate=function(){return this._lastUpdate},g.prototype.getLastUpdate=function(){return this._lastUpdate.getValue()},g.prototype.getStreams=function(){return a.map(this._streams.getValue(),function(a){return a.toJson()})},g.prototype.commitChanges=function(a){this._roomService.updateMember(this,a)},g.prototype.reload=function(){this._roomService.revertMemberChanges(this)},g.prototype.setStreams=function(b){var c=a.map(b,function(a){return h(a)});this._streams.setValue(c)},g.prototype.toString=function(){return this.getObservableRole().getValue()+"["+this.getObservableScreenName().getValue()+","+this.getSessionId()+"]"},g.prototype.toJson=function(){var b={sessionId:this._sessionId.getValue(),screenName:this._screenName.getValue(),role:this._role.getValue(),state:this._state.getValue(),streams:[],lastUpdate:this._lastUpdate.getValue()};return a.forEach(this._streams.getValue(),function(a){b.streams.push(a.toJson())}),b},g.prototype._update=function(b){a.isObject(b)&&(b.hasOwnProperty("state")&&this._state.setValue(b.state),b.hasOwnProperty("screenName")&&this._screenName.setValue(b.screenName),b.hasOwnProperty("role")&&this._role.setValue(b.role),b.hasOwnProperty("lastUpdate")&&this._lastUpdate.setValue(b.lastUpdate),b.hasOwnProperty("streams")&&i.call(this,b.streams))},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(20),c(21),c(24),c(25)],e=function(a,b,c,d,e,f){"use strict";function g(a,b,c,d){this.init(a,b,c,d)}function h(b){if(b=a.getEnumName(j,b),!b)throw new Error('"type" must be a valid stream type');return b}function i(b){if(b=a.getEnumName(k,b),!b)throw new Error('"state" must be a valid track state');return b}var j=e.types,k=f.states;return g.prototype.init=function(a,d,e,f){b.isString(a,"uri"),
this._uri=new c(a),this._type=new c(d,h),this._audioState=new c(e||k.trackEnabled.name,i),this._videoState=new c(f||k.trackEnabled.name,i)},g.prototype.getUri=function(){return this._uri.getValue()},g.prototype.getType=function(){return this._type.getValue()},g.prototype.getObservableAudioState=function(){return this._audioState},g.prototype.getObservableVideoState=function(){return this._videoState},g.prototype.toJson=function(){return{uri:this._uri.getValue(),type:this._type.getValue(),audioState:this._audioState.getValue(),videoState:this._videoState.getValue()}},g.prototype._update=function(b){a.isObject(b)&&(b.hasOwnProperty("audioState")&&this._audioState.setValue(b.audioState),b.hasOwnProperty("videoState")&&this._videoState.setValue(b.videoState))},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={types:{user:{id:0,name:"User"},presentation:{id:1,name:"Presentation"},audio:{id:2,name:"Audio"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={states:{trackEnabled:{id:0,name:"TrackEnabled"},trackDisabled:{id:1,name:"TrackDisabled"},trackEnded:{id:2,name:"TrackEnded"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={roles:{participant:{id:0,name:"Participant"},moderator:{id:1,name:"Moderator"},presenter:{id:2,name:"Presenter"},audience:{id:3,name:"Audience"}},states:{active:{id:0,name:"Active"},passive:{id:1,name:"Passive"},handRaised:{id:2,name:"HandRaised"},inactive:{id:3,name:"Inactive"},offline:{id:4,name:"Offline"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={types:{directChat:{id:0,name:"DirectChat"},multiPartyChat:{id:1,name:"MultiPartyChat"},moderatedChat:{id:2,name:"ModeratedChat"},townHall:{id:3,name:"TownHall"},channel:{id:4,name:"Channel"}},events:{memberJoined:{id:0,name:"MemberJoined"},memberLeft:{id:1,name:"MemberLeft"},memberUpdated:{id:2,name:"MemberUpdated"},roomUpdated:{id:3,name:"RoomUpdated"},roomEnded:{id:4,name:"RoomEnded"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(20),c(29)],e=function(a,b,c,d){"use strict";function e(a){this._sessionId=new c,this._status=new c,this._sessionIdMonitor=new d(this._sessionId),this._statusMonitor=new d(this._status),this.init(a)}function f(a){return null!==a&&void 0!==a&&""!==a}function g(a){return null!==a&&void 0!==a&&""!==a&&"offline"!==a.toLowerCase()}return e.prototype.init=function(a){b.isObject(a,"pcast"),b.isFunction(a.getStatus,"pcast.getStatus"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast!==a&&(this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),b.isFunction(this._protocol.getSessionId,"this._protocol.getSessionId"),b.isFunction(this._pcast.getStatus,"this._pcast.getStatus"),this._sessionId.setValue(this.getPCastSessionId()),this._status.setValue(this.getPCastStatus()))},e.prototype.start=function(){this._sessionIdMonitor.isEnabled()||this._sessionIdMonitor.start(a.bind(this.getPCastSessionId,this)),this._statusMonitor.isEnabled()||this._statusMonitor.start(a.bind(this.getPCastStatus,this))},e.prototype.stop=function(){this._sessionIdMonitor.isEnabled()&&this._sessionIdMonitor.stop(),this._statusMonitor.isEnabled()&&this._statusMonitor.stop()},e.prototype.assertAuthorized=function(){if(!g(this.getPCastStatus()))throw new Error("Unable to perform action. Status [%s]. Please wait to reconnect.",this.getPCastStatus());if(!f(this.getPCastSessionId()))throw new Error("Unable to perform action. Invalid sessionId [%s]",this.getPCastSessionId())},e.prototype.getObservableSessionId=function(){return this._sessionId},e.prototype.getObservableStatus=function(){return this._status},e.prototype.getPCastSessionId=function(){return this._protocol.getSessionId()},e.prototype.getPCastStatus=function(){return this._pcast.getStatus()},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6)],e=function(a,b){"use strict";function c(a){b.isObject(a,"observable"),this._observable=a,this._listenerSubscription=null,this._isEnabled=!1}return c.prototype.start=function(b,c){this._isEnabled=!0,this._listenerSubscription=this._observable.subscribe(a.noop,{listenForChanges:{callback:b,timeout:c||500}})},c.prototype.stop=function(){this._isEnabled=!1,this._listenerSubscription&&this._listenerSubscription.dispose(),this._listenerSubscription=null},c.prototype.isEnabled=function(){return this._isEnabled},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(21),c(31)],e=function(a,b,c,d){"use strict";function e(a){b.isObject(a,"roomService"),b.isObject(a._pcast,"roomService._pcast"),b.isObject(a._logger,"roomService._logger"),this._roomService=a,this._pcast=a._pcast,this._logger=a._logger,this._chatService=new d(this._pcast),this._chatMessages=new c([]),this._latestMessageQueue=[],this._disposables=[]}function f(a){i.call(this),a&&h.call(this)}function g(){var b=this._roomService.getObservableActiveRoom().subscribe(a.bind(f,this));this._disposables.push(b.dispose)}function h(){i.call(this),this._roomChatSubscriptionDispose=j.call(this,this._batchSize)}function i(){this._roomChatSubscriptionDispose&&this._roomChatSubscriptionDispose()}function j(b){var c=this._roomService.getObservableActiveRoom().getValue(),d=c.getRoomId(),e=this;return this._chatMessages.setValue([]),this._chatService.subscribeAndLoadMessages(d,b,function(b){var c=e._chatMessages.getValue();a.forEach(b,function(a){c.push(a)}),c.length>m&&c.splice(0,c.length-m),e._chatMessages.setValue(c)})}function k(b){if(a.isArray(b))for(var c=0;c<b.length;c++)"function"==typeof b[c]&&b[c]()}var l=0,m=100;return e.prototype.start=function(a){this._batchSize=a||l,this._chatService.start(),g.call(this),h.call(this)},e.prototype.stop=function(){this._chatService.stop(),i.call(this),k(this._disposables)},e.prototype.getObservableChatMessages=function(){return this._chatMessages},e.prototype.getObservableChatEnabled=function(){return this._chatService.getObservableChatEnabled()},e.prototype.sendMessageToRoom=function(a){var b=this._roomService.getObservableActiveRoom().getValue(),c=b.getRoomId(),d=this._roomService._self.getValue(),e=d.getObservableScreenName().getValue(),f=d.getObservableRole().getValue(),g=d.getLastUpdate();this._chatService.sendMessageToRoom(c,e,f,g,a)},e.prototype.getMessages=function(a,b,c,d){var e=this._roomService.getObservableActiveRoom().getValue(),f=e.getRoomId();return this._chatService.getMessages(f,a,b,c,function(a){d(a)})},e.prototype.toString=function(){return"RoomChatService"},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(20),c(4),c(28)],e=function(a,b,c,d,e){"use strict";function f(a){b.isObject(a,"pcast"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),this._enabled=new c((!1)),b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),this._authService=new e(this._pcast)}function g(){var b=this._authService.getObservableStatus().subscribe(a.bind(l,this)),c=this._authService.getObservableSessionId().subscribe(a.bind(m,this));this._disposables.push(b.dispose),this._disposables.push(c.dispose)}function h(a,b){var c=this;this._roomMessagesListeners[a]=b;var d=function(){c._roomMessagesListeners[a]===b&&delete c._roomMessagesListeners[a]};return this._disposables.push(d),d}function i(){}function j(a,b){var c=this._roomMessagesListeners[a];c(b)}function k(a){switch(b.isObject(a,"event"),b.stringNotEmpty(a.roomId,"event.roomId"),b.stringNotEmpty(a.eventType,"event.eventType"),b.isArray(a.chatMessages,"event.chatMessages"),a.eventType){case"Message":this._logger.debug("[%s] Room messages [%s]",a.roomId,a.chatMessages);var c=this._roomMessagesListeners[a.roomId];s(a.chatMessages),c&&c(a.chatMessages);break;default:this._logger.warn("Unsupported room conversation event [%s]",a.eventType)}}function l(a){switch(a.toLowerCase()){case"offline":return;case"online":return n.call(this)}}function m(){n.call(this)}function n(){var b=this;a.forOwn(this._roomMessagesListeners,function(a,c){p.call(b,c,1,a)})}function o(a,c,d,e,f){b.stringNotEmpty(a,"roomId"),b.isFunction(f,"callback"),e&&d||b.isNumber(c,"batchSize"),e&&b.stringNotEmpty(e,"beforeMessageId"),d&&b.stringNotEmpty(d,"afterMessageId"),r.call(this),this._authService.assertAuthorized();var g=this._authService.getPCastSessionId();this._protocol.getMessages(g,a,c,d,e,function(a){if("ok"!==a.status)throw new Error("Fetch of room conversation failed: "+a.status);s(a.chatMessages),f(a.chatMessages)})}function p(a,c,d){b.stringNotEmpty(a,"roomId"),b.isNumber(c,"batchSize"),b.isFunction(d,"callback"),r.call(this),this._authService.assertAuthorized();var e=this._authService.getPCastSessionId(),f=this;this._protocol.subscribeToRoomConversation(e,a,c,function(b){if("ok"!==b.status)throw delete f._roomMessagesListeners[a],new Error("Fetch of room conversation failed: "+b.status);s(b.chatMessages),d(b.chatMessages)})}function q(a,c,d,e,f,g){b.stringNotEmpty(a,"roomId"),b.stringNotEmpty(c,"screenName"),b.stringNotEmpty(d,"role"),b.isNumber(e,"lastUpdate"),b.stringNotEmpty(f,"message"),r.call(this),this._authService.assertAuthorized();var h=this._authService.getPCastSessionId(),i={messageId:"",timestamp:0,from:{sessionId:h,screenName:c,role:d,lastUpdate:e},message:f};return this._protocol.sendMessageToRoom(a,i,g)}function r(){if(!this._enabled.getValue())throw new Error("ChatService not Enabled. Please start before performing actions.")}function s(b){a.forEach(b,function(a){t(a)})}function t(b){b.timestamp&&(b.timestamp=a.utc(b.timestamp)),b.from&&(b.from.lastUpdate=a.utc(b.from.lastUpdate))}function u(b){if(a.isArray(b))for(var c=0;c<b.length;c++)"function"==typeof b[c]&&b[c]()}return f.prototype.start=function(){if(!this._enabled.getValue()){this._disposables=[],this._roomMessagesListeners={},this._enabled.setValue(!0),this._authService.start(),g.call(this);var b=this._protocol.on("roomChatEvent",a.bind(k,this));this._disposables.push(b)}},f.prototype.stop=function(){this._enabled.getValue()&&(this._authService.stop(),u(this._disposables))},f.prototype.getObservableChatEnabled=function(){return this._enabled},f.prototype.sendMessageToRoom=function(b,c,d,e,f){q.call(this,b,c,d,e,f,a.bind(i,this))},f.prototype.subscribeAndLoadMessages=function(b,c,d){var e=h.call(this,b,d);return p.call(this,b,c,a.bind(j,this,b)),e},f.prototype.getMessages=function(a,b,c,d,e){o.call(this,a,b,c,d,e)},f.prototype.toString=function(){return"ChatService"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(4),c(33),c(34),c(35)],e=function(a,b,c,d,e,f){"use strict";function g(e,f){b.isArray(e,"userMediaStreams"),f=f||{},this._logger=f.logger||new c,this._audioContext=f.audioContext||new d,this._nativeAudioContext=this._audioContext.getNativeAudioContext(),this._audioVolumeMeters=[],this._onSpeakingChanged=null,this._userMediaStreams=e,this._disposeOfAudioContext=a.isObject(f.audioContext)}function h(a,b){var c=new e(this.logger),d=new f(this.logger);c.init(this._nativeAudioContext,a.alpha),c.connect(b),d.onValue(this._onSpeakingChanged),d.startDetection(c,a),this._audioVolumeMeters.push(c)}return g.prototype.start=function(c,d){b.isFunction(d,"callback"),this._onSpeakingChanged=d,c=c||{},a.forEach(this._userMediaStreams,a.bind(h,this,c))},g.prototype.stop=function(){a.forEach(this._audioVolumeMeters,function(a){a.stop()}),this._onSpeakingChanged=null},g.prototype.dispose=function(){this._disposeOfAudioContext&&this._nativeAudioContext.close(),this._userMediaStreams=null},g.prototype.toString=function(){return"AudioSpeakerDetector"},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6)],e=function(a,b){"use strict";function c(){this.init()}return c.prototype.init=function(){if(!window.AudioContext)throw new Error("Browser does not support AudioContext");this._audioContext=new window.AudioContext},c.prototype.getNativeAudioContext=function(){return this._audioContext},c.prototype.toString=function(){return"AudioContext"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6)],e=function(a,b){"use strict";function c(a){b.isObject(a),this._logger=a}function d(b){for(var c=b.inputBuffer.getChannelData(0),d=0,e=0,f=0;f<c.length;f++)d+=c[f]*c[f],Math.abs(c[f])>.99&&e++;this._value=Math.sqrt(d/c.length),this._smoothedValue=this._alpha*this._value+(1-this._alpha)*this._smoothedValue,this._smoothedPeakValue=Math.max(this._value,this._alpha*this._value+(1-this._alpha)*this._smoothedPeakValue),this._clipped=e,this._callback&&this._callback.call(this,{date:a.now(),value:this._value,smoothedValue:this._smoothedValue,smoothedPeakValue:this._smoothedPeakValue,clipped:this._clipped})}function e(a){b.isObject(a,"stream");var c=this;a.getAudioTracks().length>0?(c._mediaStreamSource=c._context.createMediaStreamSource(a),c._mediaStreamSource.connect(c._scriptProcessor),c._scriptProcessor.connect(c._context.destination)):c._logger.info("Stream has no audio tracks")}function f(){this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._scriptProcessor.disconnect()}var g=1/16;return c.prototype.init=function(c,e){b.isObject(c,"context"),b.isFunction(c.createScriptProcessor,"context.createScriptProcessor"),e=parseFloat(e||g),b.isNumber(e,"alpha"),this._context=c,this._alpha=e,this._value=0,this._smoothedValue=0,this._smoothedPeakValue=0,this._clipped=0,this._scriptProcessor=c.createScriptProcessor(4096,1,1),this._scriptProcessor.addEventListener("audioprocess",a.bind(d,this))},c.prototype.onValue=function(a){this._callback=a},c.prototype.getValue=function(){return this._value},c.prototype.getSmoothedValue=function(){return this._smoothedValue},c.prototype.getSmoothedPeakValue=function(){return this._smoothedPeakValue},c.prototype.connect=function(a){var b=this;return e.call(b,a)},c.prototype.stop=function(){return f.call(this)},c.prototype.toString=function(){return"AudioVolumeMeter"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6)],e=function(a,b){"use strict";function c(a){b.isObject(a),this._logger=a,this.init()}function d(c,d){b.isObject(c,"audioVolumeMeter"),d=d||{};var g=this,h=!1,i=d.speakingHysteresisInterval||e,j=d.silenceHysteresisInterval||f;b.isNumber(i,"options.speakingHysteresisInterval"),b.isNumber(j,"options.silenceHysteresisInterval");var k=!1,l=a.now()+i,m=a.now()+j;c.onValue(function(d){if(!h){b.isObject(c,"audioVolumeMeter"),b.isNumber(d.date,"value.date"),b.isNumber(d.value,"value.value"),b.isNumber(d.smoothedValue,"value.smoothedValue"),b.isNumber(d.smoothedPeakValue,"value.smoothedPeakValue"),b.isNumber(d.clipped,"value.clipped");var e=d.value>.01&&d.value>2*d.smoothedValue&&d.value>.25*d.smoothedPeakValue,f=d.value>.8*d.smoothedValue,n=d.value<.5*d.smoothedValue,o=!e;(e||k&&f)&&l<d.date?(m=a.utc(d.date)+j,k||(k=!0,g._logger.info("Speaking detected"),g._callback&&g._callback("speaking"))):(n||!k&&o)&&m<d.date&&(l=a.utc(d.date)+i,k&&(k=!1,g._logger.info("Silence detected"),g._callback&&g._callback("silence")))}})}var e=50,f=1500;return c.prototype.init=function(){},c.prototype.onValue=function(a){this._callback=a},c.prototype.startDetection=function(a,b){var c=this;return d.call(c,a,b)},c.prototype.toString=function(){return"AudioSpeakerDetection"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6),c(4),c(37)],e=function(a,b,c,d){"use strict";function e(a,d){b.isArray(a,"userMediaStreams"),d=d||{},this._logger=d.logger||new c,this._publisherAdjusters=[],this._publishers=a}function f(a,b,c){var e=new d(c);e.connect(a,b),this._publisherAdjusters.push(e)}return e.prototype.start=function(b,c){c=c||{},a.forEach(this._publishers,a.bind(f,this,b,c))},e.prototype.stop=function(){a.forEach(this._publisherAdjusters,function(a){a.close()}),this._publisherAdjusters=[]},e.prototype.toString=function(){return"BandwidthMonitor"},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3),c(6)],e=function(a,b){"use strict";function c(a){this.init(a)}function d(b,c){if(this._membersSubscription&&this._membersSubscription.dispose(),!c)return this._publisher.limitBandwidth(b);var d=c.getObservableMembers();this._membersSubscription=d.subscribe(a.bind(e,this,b),{initial:"notify"})}function e(a,b){if(b.length!==this._roomMemberCount){this._roomMemberCount=b.length;var c=a/Math.max(1,this._roomMemberCount-1);this._publisher.limitBandwidth(c)}}var f=5e6;return c.prototype.init=function(a){b.isObject(a,"publisher"),this._publisher=a,this._roomMemberCount=0,this._roomSubscription=null,this._membersSubscription=null},c.prototype.connect=function(c,e){b.isObject(c,"roomService"),e=e||{};var g=c.getObservableActiveRoom(),h=e.roomBandwidthLimit||f;this._roomSubscription=g.subscribe(a.bind(d,this,h),{initial:"notify"})},c.prototype.close=function(){this._roomSubscription&&this._roomSubscription.dispose(),this._membersSubscription&&this._membersSubscription.dispose(),this._roomSubscription=null,this._membersSubscription=null},c.prototype.toString=function(){return"PublisherBandwidthAdjuster"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))}])});
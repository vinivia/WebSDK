/**
 * Copyright 2017 PhenixP2P Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],b):"object"==typeof exports?exports["phenix-web-sdk"]=b():a["phenix-web-sdk"]=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d,e;d=[c(1),c(2),c(5)],e=function(a,b,c){return window.PhenixPCast=b,{PCast:b,Logger:c,RTC:a}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){!function(b,c){a.exports=c()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d,e;d=[c(1),c(7)],e=function(a,b){return a.onLoaded=function(){b(a)},a.onLoaded(),a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(2),c(3),c(4)],e=function(a,b,c){"use strict";var d=new a(navigator.userAgent).detect(),e={RTCPeerConnection:b.RTCPeerConnection,RTCSessionDescription:b.RTCSessionDescription,RTCIceCandidate:b.RTCIceCandidate,getSources:b.getSources,getUserMedia:b.getUserMedia,getStats:b.getStats,attachMediaStream:b.attachMediaStream,reattachMediaStream:b.reattachMediaStream,browser:d.browser,browserVersion:d.version,webrtcSupported:b.webrtcSupported,phenixSupported:!1,isPhenixEnabled:function(){return!1},onLoaded:void 0};if(c.isSupported()){e.phenixSupported=!0;var f=new c,g=function(){e.RTCPeerConnection=f.getRTCPeerConnectionConstructor(),e.RTCSessionDescription=f.getRTCSessionDescriptionConstructor(),e.RTCIceCandidate=f.getRTCIceCandidateConstructor(),e.getSources=f.getSourcesDelegate(),e.getUserMedia=f.getUserMediaDelegate(),e.getStats=f.getStatsDelegate(),Function.prototype.bind?(e.attachMediaStream=f.attachMediaStream.bind(f),e.reattachMediaStream=f.reattachMediaStream.bind(f),e.isPhenixEnabled=f.isEnabled.bind(f)):(e.attachMediaStream=function(){f.attachMediaStream.apply(f,arguments)},e.reattachMediaStream=function(){f.reattachMediaStream.apply(f,arguments)},e.isPhenixEnabled=function(){return f.isEnabled()}),e.webrtcSupported=!0,e.phenixSupported=!0,e.phenixVersion=f.getVersion(),e.onLoaded&&e.onLoaded.call()};f.isEnabled()?g():f.onReady(function(a){a&&(g(),e.onload&&"function"==typeof e.onload&&e.onload())}),f.onLoaded(function(){g()})}else e.phenixSupported=!1;return e.addEventListener=function(a,b,c,d){a.phenixSetEventListener?a.phenixSetEventListener(b,c):a.addEventListener?a.addEventListener(b,c,d===!0):a.attachEvent("on"+b,c)},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(a){this._userAgent=a}return a.prototype.detect=function(){var a="Unknown",b="?",c=this._userAgent.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),d=this._userAgent.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./);return c&&c.length>=2?a=c[1]:this._userAgent.match(/^\(?Mozilla/)&&(a="Mozilla",(this._userAgent.match(/MSIE/)||this._userAgent.match(/; Trident\/.*rv:[0-9]+/))&&(a="IE",(d=this._userAgent.match(/MSIE ([0-9]+)/))?(b=parseInt(d[1],10),(d=this._userAgent.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(b=parseInt(d[1],10))):(d=this._userAgent.match(/rv:([0-9]+)/))&&(b=parseInt(d[1],10)))),"Chrome"===a&&this._userAgent.match(/OPR\//)?(a="Opera",d=this._userAgent.match(/(OPR)\/([0-9]+)\./)):"Chrome"===a&&this._userAgent.match(/Edge\//)?(a="Edge",d=this._userAgent.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==a&&"IE"!==a||!this._userAgent.match(/Opera/)||(a="Opera",d=this._userAgent.match(/(Opera) ([0-9]+)\./)),"IE"!==a&&d&&d.length>=3&&(b=parseInt(d[2],10)),{browser:a,version:b}},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(2)],e=function(a){"use strict";var b=function(){console.log.apply(console,arguments)}||function(){},c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=!1,m=function(a){navigator.mediaDevices.enumerateDevices().then(function(b){var c=[];b.forEach(function(a){"audioinput"===a.kind?c.push({kind:"audio",id:a.deviceId,label:a.label}):"videoinput"===a.kind&&c.push({kind:"video",id:a.deviceId,label:a.label})}),a(c)})};navigator.mozGetUserMedia?(b("Firefox detected",navigator.userAgent),c=mozRTCPeerConnection,d=mozRTCSessionDescription,e=mozRTCIceCandidate,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?function(a,b,c){navigator.mediaDevices.getUserMedia(a).then(b)["catch"](c)}:navigator.mozGetUserMedia.bind(navigator),h=function(a,b,c){var d=a.getStats(b).then(c);if("rejected"===d.state)throw new Error(d.message)},k=function(b,c,d){var e=null,f=b.split(":");if(0===f[0].indexOf("stun"))e={url:b};else if(0===f[0].indexOf("turn")){var g=new a(navigator.userAgent).detect();if(g.version<27){var h=b.split("?");0===h[1].indexOf("transport=udp")&&(e={url:h[0],credential:d,username:c})}else e={url:b,credential:d,username:c}}return e},i=function(a,c){b("Attaching media stream");var d=a.muted;return a.mozSrcObject=c,a.play(),d===!0&&(a.muted=!0),a},j=function(a,c){b("Reattaching media stream");var d=a.muted;return a.mozSrcObject=c.mozSrcObject,a.play(),d===!0&&(a.muted=!0),a},MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=function(){return[]}),f=navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?m:MediaStreamTrack.getSources?MediaStreamTrack.getSources.bind(MediaStreamTrack):function(a){setTimeout(function(){a([{kind:"audio",id:"default",label:"",facing:""},{kind:"video",id:"default",label:"",facing:""}])},0)},l=!0):navigator.webkitGetUserMedia?(b("Webkit detected",navigator.userAgent),k=function(a,b,c){var d=null,e=a.split(":");return 0===e[0].indexOf("stun")?d={url:a}:0===e[0].indexOf("turn")&&(d={url:a,credential:c,username:b}),d},c=window.webkitRTCPeerConnection,d=window.RTCSessionDescription,e=window.RTCIceCandidate,g=function(a,c,d){var e=function(a){setTimeout(function(){for(var e=a.getTracks(),f=0;f<e.length;f++){var g=e[f];if(g.onended=function(a){b(a.timeStamp,"Track",g.id,g.label,"ended")},b("Track",g.id,g.label,e[f].kind,"readyState=",e[f].readyState),"ended"===g.readyState){try{var h=new Error("User media not available");h.code="unavailable",d(h)}finally{for(var i=0;i<e.length;i++)e[i].stop()}return}}c(a)},100)};navigator.webkitGetUserMedia(a,e,d)},h=function(a,b,c,d){a.getStats(c,b,d)},i=function(a,c){return"undefined"!=typeof a.srcObject?a.srcObject=c:"undefined"!=typeof a.mozSrcObject?a.mozSrcObject=c:"undefined"!=typeof a.src?a.src=URL.createObjectURL(c):b("Error attaching stream to element."),a.play(),a},j=function(a,b){return a.src=b.src,a},f=navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?m:MediaStreamTrack.getSources.bind(MediaStreamTrack),l=!0):b("Browser does not appear to be WebRTC-capable",navigator.userAgent);var n={RTCPeerConnection:c,RTCSessionDescription:d,RTCIceCandidate:e,getSources:f,getUserMedia:g,getStats:h,attachMediaStream:i,reattachMediaStream:j,webrtcSupported:l};return n.exportGlobal=function(){window.RTCPeerConnection=n.RTCPeerConnection,window.RTCSessionDescription=n.RTCSessionDescription,window.RTCIceCandidate=n.RTCIceCandidate},n}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(5),c(6)],e=function(a,b){"use strict";function c(){var b=this;this._root=e(),this._version="?";var c=function(a){b._loaded=!0,b._enabled=a===!0,b._version=b._phenixRTC.phenixVersion||"?.?.?.?",h(a?"Phenix RTC "+b._version:"No Phenix RTC"),b._onReady&&b._onReady(b._enabled)};try{this._phenixRTC=f(this._root),this._phenixRTC.onunload=function(){b._loaded=!1};var d=new a;d.waitForReady(this._phenixRTC,c)}catch(g){i("Error while loading Phenix RTC"+g),loaded(!1)}}function d(){this._root&&document.getElementById("phenixRTC")!==this._root&&(document.body.appendChild(this._root),this._onLoaded&&this._onLoaded.call(this))}function e(){var a=document.createElement("div");return a.id="phenixRTC",a.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",document.body.appendChild(a),a}function f(a){var b=document.createElement("object");return b.type="application/x-phenix-rtc",a.appendChild(b),b}function g(a,c){if(!a)throw new Error("Can not attach a stream to a undefined element");if(a.phenixVersion)return a.src=c,a;var d=new b(a,c);return d.getElement().phenixPresenter=d,d.getElement()}var h=function(){console.log.apply(console,arguments)}||function(){},i=function(){console.error.apply(console,arguments)}||h;return c.prototype.onReady=function(a){var b=this;this._loaded?setTimeout(function(){a(b._enabled)},1):this._onReady=a},c.prototype.onLoaded=function(a){this._onLoaded=a},c.prototype.isLoaded=function(){return this._loaded===!0},c.isSupported=function(){if(navigator.plugins)for(var a=navigator.plugins,b=0;b<a.length;b++)if(a[b].name.indexOf("PhenixRTC")>=0)return!0;if(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/))try{return new ActiveXObject("PhenixP2P.RTC"),!0}catch(c){return!1}return!1},c.prototype.isEnabled=function(){return d.call(this),this._phenixRTC&&void 0!=this._phenixRTC.phenixVersion},c.prototype.getVersion=function(){return d.call(this),this._version},c.prototype.getRTCPeerConnectionConstructor=function(){return d.call(this),this._phenixRTC.RTCPeerConnection},c.prototype.getRTCSessionDescriptionConstructor=function(){return d.call(this),this._phenixRTC.RTCSessionDescription},c.prototype.getRTCIceCandidateConstructor=function(){return d.call(this),this._phenixRTC.RTCIceCandidate},c.prototype.getSourcesDelegate=function(){var a=this;return function(b){return d.call(a),a._phenixRTC.getSources(b)}},c.prototype.getUserMediaDelegate=function(){var a=this;return function(b,c,e){return d.call(a),a._phenixRTC.getUserMedia(b,c,e)}},c.prototype.getStatsDelegate=function(){return function(a,b,c,d){return a.getStats(b,c,d)}},c.prototype.attachMediaStream=function(a,b){return d.call(this),g.call(this,a,b)},c.prototype.reattachMediaStream=function(a,b){return d.call(this),this.attachMediaStream(a,b.src)},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(2)],e=function(a){"use strict";function b(a){this._timeout=a||15e3}var c=new a(navigator.userAgent).detect(),d=4,e=function(){console.error.apply(console,arguments)}||log;return b.prototype.waitForReadyWithTimeout=function(a,b,f){var g=!1,h=1,i=h,j=function(a){g||(g=!0,b(a))},k=function l(){a.readyState===d?j(!0):a.phenixVersion?j(!0):(h=Math.min(h+1e3,2*h),i+=h,i>f?(e("Timed out while waiting for <object> to load"),j(!1)):setTimeout(l,h))};a.hasOwnProperty&&a.hasOwnProperty("onload")||"IE"!==c.browser&&e("No means of detecting when <object> is loaded"),a.onload=function(){j(!0)},k()},b.prototype.waitForReady=function(a,b){a.phenixVersion?b(!0):this.waitForReadyWithTimeout(a,b,this._timeout)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(5)],e=function(a){"use strict";function b(b,d){var e=this;this._ghost=b,this._stream=d,this._events={};var f=function(a){e._loaded=!0,e._enabled=a===!0,a?h.call(e):m("Failed to create Phenix video element"),e._onReady&&e._onReady(e._enabled)};try{this._video=c(),this._video.className=this._ghost.className,this._video.height=this._ghost.height,this._video.width=this._ghost.width,this._ghost.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this._video.onunload=function(){e._loaded=!1},j.call(this),document.body&&document.body.contains||l("document.body.contains is not supported"),document.body&&document.body.contains&&document.body.contains(this._ghost)&&this._ghost.parentNode.replaceChild(this._video,this._ghost);var g=new a;g.waitForReady(this._video,f)}catch(i){m("Error while loading Phenix RTC"+i),f(!1)}}function c(){var a=document.createElement("object");return a.type="application/x-phenix-video",a}function d(a,b,c){var d=this._events[a];d||(d=this._events[a]=[],this._loaded&&f.call(this,a)),d.push(b)}function e(a,b,c){var d=this._events[a];if(d){var e=d.indexOf(b);e>=0&&(d=d.splice(e,1),d.length>0?this._events[a]=d:delete this._events[a])}}function f(a){function b(){var b=c._events[a];if(b)for(var d=0;d<b.length;d++)b[d].apply(c,arguments)}var c=this;c._video.phenixSetEventListener(a,b)}function g(a,b){var c;document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0)):(c=document.createEventObject(),c.eventType=b),c.eventName=b,setTimeout(function(){document.createEvent?a.dispatchEvent(c):a.fireEvent("on"+c.eventType,c)})}function h(){for(var a=Object.keys(this._events),b=0;b<a.length;b++)f.call(this,a[b]);this.hookUpEvents(),i.call(this),this._video.id=this._ghost.id,this._video.style.cssText=this._ghost.cssText,this._video.className=this._ghost.className,this._video.innerHtml=this._ghost.innerHtml,this._video.width=this._ghost.width,this._video.height=this._ghost.height,this._video.autoplay=this._ghost.autoplay,this._video.muted=this._ghost.muted,this._video.defaultMuted=this._ghost.defaultMuted,this._video.volume=this._ghost.volume,this._stream&&(this._video.src=this._stream)}function i(){var a=this,b=["style"];if(window.MutationObserver){var c=new MutationObserver(function(c){c.forEach(function(c){"attributes"===c.type&&c.target===a._ghost&&b.indexOf(c.attributeName)===-1&&(a._video[c.attributeName]=a._ghost[c.attributeName])})}),d={attributes:!0};c.observe(a._ghost,d)}else l("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),a._ghost.addEventListener?a._ghost.addEventListener("DOMAttrModified",function(b){a._video[b.target.tagName]=a._ghost[b.target.tagName]},!1):a._ghost.attachEvent("onpropertychange",function(b){a._video[b.target.tagName]=a._ghost[b.target.tagName]})}function j(){var a=this;if(window.MutationObserver){var b=new MutationObserver(function(b){b.forEach(function(b){if("childList"===b.type)for(var c=0;c<b.addedNodes.length;c++){var d=b.addedNodes[c];b.target!==a._video&&(d===a._ghost?(b.target.replaceChild(a._video,a._ghost),h.call(a)):k(b.target,a._ghost)&&(a._ghost.parentNode.replaceChild(a._video,a._ghost),h.call(a)))}})}),c={childList:!0,attributes:!1,characterData:!1,subtree:!0};b.observe(document.body,c)}else l("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),d(a._ghost,"DOMNodeInserted",function(b){a._ghost.parentNode.replaceChild(a._video,a._ghost)},!1)}function k(a,b){for(var c=b.parentNode;null!=c;){if(c==a)return!0;c=c.parentNode}return!1}var l=function(){console.log.apply(console,arguments)}||function(){},m=function(){console.error.apply(console,arguments)}||l;return b.prototype.hookUpEvents=function(){var a=this,b=this._ghost;this.addEventListener("error",function(){g(b,"error")}),this.addEventListener("mute",function(){b.muted=a._video.muted,g(b,"mute")}),this.addEventListener("unmute",function(){b.muted=a._video.muted,g(b,"unmute")}),this.addEventListener("ended",function(){b.ended=a._video.ended,g(b,"ended")}),this.addEventListener("loadedmetadata",function(){l("Video loaded metadata",a._video.videoWidth,a._video.videoHeight),b.width=a._video.width,b.height=a._video.height,g(b,"loadedmetadata")}),this.addEventListener("loadeddata",function(){b.width=a._video.width,b.height=a._video.height,g(b,"loadeddata")}),this.addEventListener("resize",function(){b.width=a._video.width,b.height=a._video.height,g(b,"resize")})},b.prototype.onReady=function(a){var b=this;this._loaded?setTimeout(function(){a(b._enabled)},1):this._onReady=a},b.prototype.getElement=function(){return this._video},b.prototype.addEventListener=function(a,b,c){d.call(this,a,b,c)},b.prototype.removeEventListener=function(a,b,c){e.call(this,a,b,c)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a=function(a){window.RTCPeerConnection=a.RTCPeerConnection,window.RTCSessionDescription=a.RTCSessionDescription,window.RTCIceCandidate=a.RTCIceCandidate};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))}])})},function(a,b,c){var d,e;d=[c(3),c(14),c(18),c(19),c(17),c(5),c(1)],e=function(a,b,c,d,e,f,g){"use strict";function h(a){a=a||{},this._logger=a.logger||new f,this._baseUri=a.uri||b.DefaultPCastUri,this._deviceId=a.deviceId||"",this._version=P,this._endPoint=new b(this._version,this._baseUri,this._logger),this._screenSharingExtensionId=a.screenSharingExtensionId||Q,this._screenSharingAddOn=a.screenSharingAddOn||R,this._screenSharingEnabled=!1,this._shaka=a.shaka||window.shaka,this._videojs=a.videojs||window.videojs,this._status="offline","Chrome"===g.browser&&this._screenSharingExtensionId&&k.call(this),g.addEventListener(window,"unload",function(a){return function(){a.stop()}}(this))}function i(a){var b=this;if("Chrome"===g.browser&&b._screenSharingExtensionId)try{chrome.runtime.sendMessage(b._screenSharingExtensionId,{type:"version"},function(c){c&&"ok"===c.status?(b._logger.info("Screen sharing enabled using version [%s]",c.version),a(!0)):(b._logger.info("Screen sharing NOT available"),a(!1))})}catch(c){c.message&&b._logger.warn(c.message,c),a(!1)}else a("Firefox"===g.browser&&"object"==typeof window.PCastScreenSharing?!0:!1)}function j(){return"https://chrome.google.com/webstore/detail/"+this._screenSharingExtensionId}function k(){for(var a=j.call(this),b=document.getElementsByTagName("link"),c=0;c<b.length;c++)if(b[c].href===a)return;this._logger.debug("Adding Chrome Web Store link [%s]",a);var d=document.createElement("link");d.rel="chrome-webstore-item",d.href=a,document.getElementsByTagName("head")[0].appendChild(d)}function l(a){var b=this,c=j.call(this);try{chrome.webstore.install(c,function(){return a("ok")},function(c){if(c){if(c.match(/cancelled/gi))return b._logger.info("User cancelled screen sharing"),a("cancelled",new Error(c));b._logger.warn(c)}return a("failed",new Error(c||"failed"))})}catch(d){d.message&&b._logger.warn(d.message),a("failed",d)}}function m(a){try{var b,c={"PCast Screen Sharing":{URL:this._screenSharingAddOn.url,IconURL:this._screenSharingAddOn.iconUrl,Hash:this._screenSharingAddOn.hash,toString:function(){return this.URL}}},d=T,e=function(){b&&clearInterval(b),a("ok")},f=function(){b&&clearInterval(b),a("failed",new Error("failed"))};b=setInterval(function(){return"object"==typeof window.PCastScreenSharing?e():d--<0?f():void 0},S),InstallTrigger.install(c,function(a,b){0===b?e():f()})}catch(g){g.message&&this._logger.warn(g.message),a("failed",g)}}function n(a,b){var c=this;switch(g.browser){case"Chrome":try{chrome.runtime.sendMessage(c._screenSharingExtensionId,{type:"get-desktop-media"},function(c){if("ok"!==c.status)return b(c.status,void 0,new Error(c.status));var d={video:{}};"object"==typeof a&&"object"==typeof a.screen&&(d.video=a.screen),"object"!=typeof d.video.mandatory&&(d.video.mandatory={}),d.video.mandatory.chromeMediaSource="desktop",d.video.mandatory.chromeMediaSourceId=c.streamId,b("ok",d,void 0)})}catch(d){d.message&&c._logger.warn(d.message),b("failed",void 0,d)}break;case"Firefox":var e={video:{}};"object"==typeof a&&"object"==typeof a.screen&&(e.video=a.screen),e.video.mediaSource="window",b("ok",e,void 0);break;default:b("not-supported",void 0,new Error("not-supported"))}}function o(a,b){var c=this;if(a.screen)if(c._screenSharingEnabled)n.call(c,a,b);else{var d=function(d){return"cancelled"===d?b(d,"cancelled"):"ok"!==d?b(d,void 0,new Error("screen-sharing-installation-failed")):void i.call(c,function(e){return c._screenSharingEnabled=e,c._screenSharingEnabled?void n.call(c,a,b):b(d,void 0,new Error("screen-sharing-installation-failed"))})};switch(g.browser){case"Chrome":l.call(c,d);break;case"Firefox":m.call(c,d);break;default:b("not-supported",void 0,new Error("not-supported"))}}else{var e={audio:a.audio||!1,video:a.video||!1};b("ok",e,void 0)}}function p(a,b){var c=this,d=function(a,d){c._gumStreams.push(d),b(c,a,d)},e=function(a,d,e){b(c,a,d,e)},f=a.screen,g=a.video||a.audio;return f&&g?q.call(c,{audio:a.audio,video:a.video},function(b,f){return q.call(c,{screen:a.screen},function(a,b){H(f,b.getTracks()),d(a,f)},function(a,b,c){I(f),e(a,b,c)})},e):q.call(c,a,d,e)}function q(a,b,c){var d=function(){c("cancelled",null)},e=function(a){c(U(a),void 0,a)},f=function(a){b("ok",a)};return o.call(this,a,function(a,b,c){if("cancelled"===a)return d();if("ok"!==a)return e(c);try{g.getUserMedia(b,f,e)}catch(h){e(h)}})}function r(){var a=this;this._connected=!0,a._stopped||a._protocol.authenticate(a._authToken,function(b,c){a._authenticationCallback&&(c?(a._logger.warn("Failed to authenticate",c),G.call(a,"offline"),a._authenticationCallback.call(a,a,"unauthorized",""),a.stop("unauthorized")):(G.call(a,"online"),a._authenticationCallback.call(a,a,b.status,b.sessionId)))})}function s(){this._connected=!1,G.call(this,"offline")}function t(a){switch(a){case"":case"none":case"ended":return"ended";case"server-error":case"not-ready":case"error":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}function u(a){var b=a.streamId,c=a.reason;return w.call(this,b,c)}function v(a){var b=a.streamId,c=a.status,d=a.reason,e=this._mediaStreams[b];e&&e.dataQualityChangedCallback(c,d);var f=this._publishers[b];f&&"function"==typeof f.dataQualityChangedCallback&&f.dataQualityChangedCallback(f,c,d)}function w(a,b){this._logger.info("[%s] Stream ended with reason [%s]",a,b);var c=this._mediaStreams[a];c&&c.streamEndedCallback(t(b),b),delete this._mediaStreams[a];var d=this._publishers[a];d&&"function"==typeof d.publisherEndedCallback&&d.publisherEndedCallback(d,t(b),b),delete this._publishers[a];var e=this._peerConnections[a];e&&L.call(this,a,e,"ended"),delete this._peerConnections[a]}function x(a,b,e,f,h){var i=this,j=function(j){function k(){for(var a=m.getTracks(),b=0;b<a.length;b++){var c=a[b];if(!J(c))return!1}return!0}function l(c){b.stopped||(i._logger.info("[%s] stop media stream",a),L.call(i,a,e,"stop"),i._protocol.destroyStream(a,c||"",function(b,c){return c?void i._logger.error("[%s] failed to destroy stream",a):void i._logger.info("[%s] destroyed stream",a)}),b.stopped=!0)}if(!b.failed){var m=j.stream;if(!m)return b.failed=!0,i._logger.warn("[%s] No remote stream",a),f.call(i,void 0,"failed");i._logger.info("[%s] Got remote stream",a);var n=function p(f){var j={children:[],renderer:null,isStopped:!1,isStreamEnded:!1,mediaStream:{createRenderer:function(){var a=null,b=new d(i._logger);return{start:function(c){return a=g.attachMediaStream(c,f),h.receiveAudio===!1&&(c.muted=!0),j.renderer=this,b.start(this,a),a},stop:function(){b.stop(),a&&a.pause(),a=null,j.renderer=null},getStats:function(){return a?{width:a.videoWidth||a.width,height:a.videoHeight||a.height,currentTime:a.currentTime,networkState:a.networkState}:{width:0,height:0,currentTime:0,networkState:N.NETWORK_NO_SOURCE}},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},setVideoDisplayDimensionsChangedCallback:function(a,c){b.setVideoDisplayDimensionsChangedCallback(a,c)}}},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(a){j.isStopped||(I(f),k()&&l(a),j.isStopped=!0)},monitor:function n(b,d){if("object"!=typeof b)throw new Error('"options" must be an object');if("function"!=typeof d)throw new Error('"callback" must be a function');var n=new c(a,e,i._logger);b.direction="inbound",n.start(b,function(){return j.mediaStream.isActive()},function(b){return i._logger.warn("[%s] Media stream triggered monitor condition for [%s]",a,b),d(j.mediaStream,"client-side-failure",b)})},getStream:function(){return f},isActive:function(){var c=b.stopped,d="object"!=typeof i._mediaStreams[a],e=j.isStopped;return!c&&!d&&!e},getStreamId:function(){return a},select:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');if("function"!=typeof window.MediaStream)throw new Error("MediaStream not supported in current browser");for(var b=m.getTracks(),c=new window.MediaStream,d=0;d<b.length;d++)a(b[d],d)&&c.addTrack(b[d]);if(0===c.getTracks().length)return i._logger.warn("No tracks selected");var e=p(c);return j.children.push(e),e.mediaStream}},streamErrorCallback:function(a,b){for(var c=0;c<j.children.length;c++)j.children[c].streamErrorCallback(a,b);var d=j.mediaStream;"function"==typeof d.streamErrorCallback&&d.streamErrorCallback(d,a,b)},streamEndedCallback:function(a,b){for(var c=0;c<j.children.length;c++)j.children[c].streamEndedCallback(a,b);if(!j.isStreamEnded){var d=j.mediaStream;j.isStreamEnded=!0,"function"==typeof d.streamEndedCallback&&d.streamEndedCallback(d,a,b),d.stop(),j.renderer&&j.renderer.stop()}},dataQualityChangedCallback:function(a,b){for(var c=0;c<j.children.length;c++)j.children[c].dataQualityChangedCallback(a,b);var d=j.renderer;d&&"function"==typeof d.dataQualityChangedCallback&&d.dataQualityChangedCallback(d,a,b)}};return j},o=n(m);i._mediaStreams[a]=o,f.call(i,o.mediaStream)}};g.addEventListener(e,"addstream",j)}function y(a,b,c){var d=this,e=function(b){var e=b.candidate;e?d._logger.debug("[%s] ICE candidate: [%s] [%s] [%s]",a,e.sdpMid,e.sdpMLineIndex,e.candidate):d._logger.info("[%s] ICE candidate discovery complete",a),c&&c(e)};g.addEventListener(b,"icecandidate",e)}function z(a,b){var c=this,d=function(a){c._logger.info("[%s] Negotiation needed")},e=function(d){c._logger.info("[%s] ICE connection state changed [%s]",a,b.iceConnectionState)},f=function(d){c._logger.info("[%s] ICE gathering state changed [%s]",a,b.iceGatheringState)},h=function(d){c._logger.info("[%s] Signaling state changed [%s]",a,b.signalingState)},i=function(d){c._logger.info("[%s] Connection state changed [%s]",a,b.connectionState)};g.addEventListener(b,"negotiationneeded",d),g.addEventListener(b,"iceconnectionstatechange",e),g.addEventListener(b,"icegatheringstatechange ",f),g.addEventListener(b,"signalingstatechange",h),g.addEventListener(b,"connectionstatechange",i)}function A(a,b,c){var d=this,e={stopped:!1},f={getStreamId:function(){return a},isActive:function(){return!e.stopped},hasEnded:function(){return e.stopped},stop:function(b){e.stopped||(d._protocol.destroyStream(a,b||"",function(b,c){return c?void d._logger.error("[%s] failed to destroy stream",a):void d._logger.info("[%s] destroyed stream",a)}),e.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},getOptions:function(){return c}};d._publishers[a]=f,b(f)}function B(a,b,d,e,f,h){function i(){function a(a){j._logger.info("Created answer [%s]",a.sdp),j._protocol.setAnswerDescription(b,a.sdp,function(a,f){function i(){var a=/(b=AS:([0-9]*)[\n\r]*)/gi,f=/(mid:video)([\n\r]*)/gi;j._logger.info("Set local description (answer)");var i=0,l=a.exec(d);l&&l.length>=3&&(i=1e3*l[2]);var m={getStreamId:function(){return b},isActive:function(){return!k.stopped},hasEnded:function(){switch(n.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":return!0;default:return!0}},stop:function(a){k.stopped||(L.call(j,b,n,"closed"),j._protocol.destroyStream(b,a||"",function(a,c){return c?void j._logger.error("[%s] failed to destroy stream",b):void j._logger.info("[%s] destroyed stream",b)}),k.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},limitBandwidth:function(b){if("number"!=typeof b)throw new Error('"bandwidthLimit" must be a number');var c=i?Math.min(b,i):b,d=n.remoteDescription;j._logger.info("Changing bandwidth limit to [%s]",c);var e=d.sdp.replace(a,"");e=e.replace(f,function(a,b,d,e,f){return[b,d,"b=AS:",Math.ceil(c/1e3),d].join("")});var h=new g.RTCSessionDescription({type:d.type,sdp:e});return n.setRemoteDescription(h),{dispose:function(){n.setRemoteDescription(d)}}},monitor:function p(a,d){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof d)throw new Error('"callback" must be a function');var p=new c(b,n,j._logger);a.direction="outbound",p.start(a,function(){return j._publishers[b]===m&&!k.stopped},function(a){return j._logger.warn("[%s] Publisher triggered monitor condition for [%s]",b,a),d(m,"client-side-failure",a)})},setRemoteMediaStreamCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.remoteMediaStreamCallback=a,o&&a(m,o)},getOptions:function(){return h}};j._publishers[b]=m,e.call(j,m)}if(f)return j._logger.warn("Failed to set answer description",f),q();K(a.options,"ice-candidates")&&(p=function(a){var c=[],d=[];a?c.push(a):d.push("completed"),j._protocol.addIceCandidates(b,c,d,function(a,b){return b?void j._logger.warn("Failed to add ICE candidate",b):void(K(a.options,"cancel")&&(p=null))})});var l=new g.RTCSessionDescription({type:"answer",sdp:a.sessionDescription.sdp});n.setLocalDescription(l,i,q)})}j._logger.info("Set remote description (offer)");var i={mandatory:{}};"Chrome"===g.browser?(i.mandatory.OfferToReceiveVideo=f.receiveVideo===!0,i.mandatory.OfferToReceiveAudio=f.receiveAudio===!0):(i.mandatory.offerToReceiveVideo=f.receiveVideo===!0,i.mandatory.offerToReceiveAudio=f.receiveAudio===!0),n.createAnswer(a,q,i)}var j=this,k={failed:!1,stopped:!1},l=d.match(/a=crypto:/i),m=d.match(/m=application /i),n=new g.RTCPeerConnection(O,{optional:[{DtlsSrtpKeyAgreement:!l},{RtpDataChannels:m}]}),o=null,p=null;j._peerConnections[b]=n,n.addStream(a);var q=function(){k.failed||(k.failed=!0,k.stopped=!0,delete j._peerConnections[b],L.call(j,b,n,"failure"),e.call(j,void 0,"failed"))};x.call(j,b,k,n,function(a){var c=j._publishers[b];o=a,c&&c.remoteMediaStreamCallback&&c.remoteMediaStreamCallback(c,a)},f),y.call(j,b,n,function(a){p&&p(a)}),z.call(j,b,n);var r=new g.RTCSessionDescription({type:"offer",sdp:d});n.setRemoteDescription(r,i,q)}function C(a,b,c,d){function e(){function b(b){f._logger.info("Created answer [%s]",b.sdp),f._protocol.setAnswerDescription(a,b.sdp,function(b,c){function d(){f._logger.debug("Set local description (answer)")}if(c)return f._logger.warn("Failed to set answer description",c),m();K(b.options,"ice-candidates")&&(l=function(b){var c=[],d=[];b?c.push(b):d.push("completed"),f._protocol.addIceCandidates(a,b,d,function(a,b){return b?void f._logger.warn("Failed to add ICE candidate",b):void(K(a.options,"cancel")&&(l=null))})});var e=new g.RTCSessionDescription({type:"answer",sdp:b.sessionDescription.sdp});k.setLocalDescription(e,d,m)})}f._logger.debug("Set remote description (offer)");
var c={mandatory:{}};"Chrome"===g.browser?(c.mandatory.OfferToReceiveVideo=d.receiveVideo!==!1,c.mandatory.OfferToReceiveAudio=d.receiveAudio!==!1):(c.mandatory.offerToReceiveVideo=d.receiveVideo!==!1,c.mandatory.offerToReceiveAudio=d.receiveAudio!==!1),k.createAnswer(b,m,c)}var f=this,h={failed:!1,stopped:!1},i=b.match(/a=crypto:/i),j=b.match(/m=application /i),k=new g.RTCPeerConnection(O,{optional:[{DtlsSrtpKeyAgreement:!i},{RtpDataChannels:j}]}),l=null;f._peerConnections[a]=k;var m=function(){h.failed||(h.failed=!0,h.stopped=!0,delete f._peerConnections[a],L.call(f,a,k,"failure"),c.call(f,void 0,"failed"))};x.call(f,a,h,k,c,d),y.call(f,a,k,function(a){l&&l(a)}),z.call(f,a,k);var n=new g.RTCSessionDescription({type:"offer",sdp:b});k.setRemoteDescription(n,e,m)}function D(a,b,c,d){var e=this,f=b.match("a=x-playlist:([^\n]*[.]mpd)"),g=b.match("a=x-playlist:([^\n]*[.]m3u8)");return f&&2===f.length&&e._shaka&&e._shaka.Player.isBrowserSupported()?E.call(e,a,f[1],c,d):g&&2===g.length&&"maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL")?F.call(e,a,g[1],c,d):(e._logger.warn("[%s] Offer does not contain a supported manifest",a,b),c.call(e,void 0,"failed"))}function E(a,b,c,e){var f=this;if(!f._shaka)return f._logger.warn("[%s] Shaka player not available",a),c.call(f,void 0,"live-player-missing");if(!f._shaka.Player.isBrowserSupported())return f._logger.warn("[%s] Shaka does not support this browser",a),c.call(f,void 0,"browser-unsupported");var g=f._shaka,h=encodeURI(b).replace(/[#]/g,"%23"),i=function(b){var c=j;c.streamErrorCallback?(f._logger.debug("[%s] DASH live stream error event [%s]",a,b.detail),c.streamErrorCallback(c,"shaka",b.detail)):f._logger.error("[%s] DASH live stream error event [%s]",a,b.detail)},j={renderer:null,isStreamEnded:!1,isStopped:!1,mediaStream:{createRenderer:function(){var b=null,c=new d(f._logger);return{start:function(d){b=new g.Player(d),e.receiveAudio===!1&&(d.muted=!0),j.renderer=this,b.addEventListener("error",i);b.load(h).then(function(){f._logger.info("[%s] DASH live stream has been loaded",a)})["catch"](function(b){f._logger.error("[%s] Error while loading DASH live stream [%s]",a,b.code,b),j.streamErrorCallback("shaka",b)});return c.start(this,d),d},stop:function(){if(c.stop(),b){var d=function(){var a="";j.streamEndedCallback(t(a),a),b=null};b.destroy().then(function(){f._logger.info("[%s] DASH live stream has been destroyed",a)}).then(function(){d()})["catch"](function(b){f._logger.error("[%s] Error while destroying DASH live stream [%s]",a,b.code,b),d(),j.streamErrorCallback("shaka",b)})}j.renderer=null},getStats:function(){if(!b)return{width:0,height:0,currentTime:0,networkState:N.NETWORK_NO_SOURCE};var a=b.getStats();return a.currentTime=a.playTime+a.bufferingTime,a.estimatedBandwidth>0?a.networkState=N.NETWORK_LOADING:a.playTime>0?a.networkState=N.NETWORK_IDLE:a.video?a.networkState=N.NETWORK_EMPTY:a.networkState=N.NETWORK_NO_SOURCE,a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},getPlayer:function(){return b},isActive:function(){return!j.isStopped},getStreamId:function(){return a},setVideoDisplayDimensionsChangedCallback:function(a,b){c.setVideoDisplayDimensionsChangedCallback(a,b)}}},select:function(b){return f._logger.warn("[%s] selection of tracks not supported for shaka live streams",a),this},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(b){j.isStopped||(f._logger.info("[%s] stop media stream",a),f._protocol.destroyStream(a,b||"",function(b,c){return c?void f._logger.error("[%s] failed to destroy stream",a):void f._logger.info("[%s] destroyed stream",a)}),j.isStopped=!0)},monitor:function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')}},streamErrorCallback:function(a,b){var c=j.mediaStream;"function"==typeof c.streamErrorCallback&&c.streamErrorCallback(c,a,b)},streamEndedCallback:function(a,b){if(!j.isStreamEnded){var c=j.mediaStream;j.isStreamEnded=!0,"function"==typeof c.streamEndedCallback&&c.streamEndedCallback(c,a,b),c.stop(),j.renderer&&j.renderer.stop()}},dataQualityChangedCallback:function(a,b){var c=j.renderer;c&&"function"==typeof c.dataQualityChangedCallback&&c.dataQualityChangedCallback(c,a,b)}};f._mediaStreams[a]=j,c.call(f,j.mediaStream)}function F(a,b,c,e){var f=this,g=encodeURI(b).replace(/[#]/g,"%23"),h=function(b){var c=i.mediaStream;c.streamErrorCallback?(f._logger.debug("[%s] HLS live stream error event [%s]",a,b.detail),c.streamErrorCallback(c,"hls",b.detail)):f._logger.error("[%s] HLS live stream error event [%s]",a,b.detail)},i={renderer:null,isStreamEnded:!1,isStopped:!1,mediaStream:{createRenderer:function(){var b=null,c=new d(f._logger);return{start:function(d){try{return d.src=g,e.receiveAudio===!1&&(d.muted=!0),i.renderer=this,d.addEventListener("error",h),d.play(),b=d,c.start(this,b),d}catch(j){f._logger.error("[%s] Error while loading HLS live stream [%s]",a,j.code,j),i.streamErrorCallback("hls",j)}},stop:function(){if(c.stop(),b){var d=function(){b=null;var a="";i.streamEndedCallback(t(a),a)};try{b.pause(),f._logger.info("[%s] HLS live stream has been destroyed",a),d()}catch(e){f._logger.error("[%s] Error while destroying HLS live stream [%s]",a,e.code,e),d(),i.streamErrorCallback("hls",e)}}i.renderer=null},getStats:function(){return b?{width:b.videoWidth||b.width,height:b.videoHeight||b.height,currentTime:b.currentTime,networkState:b.networkState}:{width:0,height:0,currentTime:0,networkState:N.NETWORK_NO_SOURCE}},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},setVideoDisplayDimensionsChangedCallback:function(a,b){c.setVideoDisplayDimensionsChangedCallback(a,b)}}},select:function(b){return f._logger.warn("[%s] selection of tracks not supported for HLS live streams",a),this},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(b){i.isStopped||(f._logger.info("[%s] stop media stream",a),f._protocol.destroyStream(a,b||"",function(b,c){return c?void f._logger.error("[%s] failed to destroy stream",a):void f._logger.info("[%s] destroyed stream",a)}),i.isStopped=!0)},monitor:function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')},isActive:function(){return!i.isStopped},getStreamId:function(){return a}},streamErrorCallback:function(a,b){var c=i.mediaStream;"function"==typeof c.streamErrorCallback&&c.streamErrorCallback(c,a,b)},streamEndedCallback:function(a,b){if(!i.isStreamEnded){var c=i.mediaStream;i.isStreamEnded=!0,"function"==typeof c.streamEndedCallback&&c.streamEndedCallback(c,a,b),c.stop(),i.renderer&&i.renderer.stop()}},dataQualityChangedCallback:function(a,b){var c=i.renderer;c&&"function"==typeof c.dataQualityChangedCallback&&c.dataQualityChangedCallback(c,a,b)}};f._mediaStreams[a]=i,c.call(f,i.mediaStream)}function G(a){if(this._status!==a)switch(this._status=a,a){case"connecting":break;case"offline":this._offlineCallback.call(this);break;case"online":this._onlineCallback.call(this)}}function H(a,b){if("object"==typeof a&&"object"==typeof b&&b.constructor===Array)for(var c=0;c<b.length;c++)a.addTrack(b[c])}function I(a){if(a&&"function"==typeof a.getTracks)for(var b=a.getTracks(),c=0;c<b.length;c++){var d=b[c];d.stop()}}function J(a){if("object"!=typeof a)throw new Error("Invalid track.");return"ended"===a.readyState}function K(a,b){if(!a)return!1;if("function"==typeof a.indexOf)return a.indexOf(b)!==-1;for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1}function L(a,b,c){"closed"===b.signalingState||b.__closing||(this._logger.debug("[%s] close peer connection [%s]",a,c),b.close(),b.__closing=!0)}var M=function(a){return"freeze"in Object?Object.freeze(a):a},N=M({NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3}),O=M({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]}),P="2017-03-30T21:46:21Z",Q="icngjadgidcmifnehjcielbmiapkhjpn",R=M({url:"https://addons.mozilla.org/firefox/downloads/file/474686/pcast_screen_sharing-1.0.3-an+fx.xpi",iconUrl:"https://phenixp2p.com/public/images/phenix-logo-unicolor-64x64.png",hash:"sha256:4972e9718ea7f7c896abc12d1a9e664d5f3efe498539b082ab7694f9d7af4f3b"}),S=100,T=450;h.prototype.getBaseUri=function(){return this._endPoint.getBaseUri()},h.prototype.getStatus=function(){return this._status},h.prototype.start=function(b,c,d,e){if("string"!=typeof b)throw new Error('"authToken" must be a string');if("function"!=typeof c)throw new Error('"authenticationCallback" must be a function');if("function"!=typeof d)throw new Error('"onlineCallback" must be a function');if("function"!=typeof e)throw new Error('"offlineCallback" must be a function');if(this._started)throw new Error('"Already started"');this._stopped=!1,this._started=!0,this._authToken=b,this._authenticationCallback=c,this._onlineCallback=d,this._offlineCallback=e,this._status="connecting",this._peerConnections={},this._mediaStreams={},this._publishers={},this._gumStreams=[];var f=this;i.call(f,function(b){f._screenSharingEnabled=b,f._endPoint.resolveUri(function(b,c){if(b){switch(f._logger.error("Failed to connect to [%s]",f._baseUri,b),G.call(f,"offline"),b.code){case 0:f._authenticationCallback.call(f,f,"network-unavailable","");break;case 503:f._authenticationCallback.call(f,f,"capacity","");break;default:f._authenticationCallback.call(f,f,"failed","")}return f._stopped=!0,void(f._started=!1)}f._logger.info("Discovered end point [%s]",c),f._protocol=new a(c,f._deviceId,f._version,f._logger),f._protocol.on("connected",r.bind(f)),f._protocol.on("disconnected",s.bind(f)),f._protocol.on("streamEnded",u.bind(f)),f._protocol.on("dataQuality",v.bind(f))})})},h.prototype.stop=function(){if(this._started){this._stopped=!0,this._started=!1,delete this._authenticationCallback;try{var a="";for(var b in this._mediaStreams)this._mediaStreams.hasOwnProperty(b)&&w.call(this,b,a);for(var b in this._publishers)if(this._publishers.hasOwnProperty(b)){var c=this._publishers[b];w.call(this,b,a),K(c.getOptions(),"detached")||c.stop(a)}for(var b in this._peerConnections)this._peerConnections.hasOwnProperty(b)&&w.call(this,b,a);for(var d=0;d<this._gumStreams.length;d++)for(var e=this._gumStreams[d].getTracks(),f=0;f<e.length;f++)e[f].stop()}finally{this._protocol&&this._protocol.disconnect()}}},h.prototype.getUserMedia=function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function');return p.call(this,a,b)},h.prototype.publish=function(a,b,c,d,e){if("string"!=typeof a)throw new Error('"streamToken" must be a string');if("object"!=typeof b&&"string"!=typeof b)throw new Error('"streamToPublish" must be an object or URI');if("function"!=typeof c)throw new Error('"callback" must be a function');if(d=d||[],!Array.isArray(d))throw new Error('"tags" must be an array');if(e=e||{},"object"!=typeof e)throw new Error('"options" must be an object');var f=this,g="upload",h={negotiate:!0,connectOptions:e.connectOptions};"string"==typeof b?(h.negotiate=!1,h.connectUri=b):h.connectUri=e.connectUri,this._protocol.setupStream(g,a,h,function(a,d){if(!d){var g=a.createStreamResponse.streamId;if(h.negotiate===!0){var i=a.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp;return B.call(f,b,g,i,function(a,b){b?c.call(f,f,"failed",null):c.call(f,f,"ok",a)},e,a.createStreamResponse.options)}return A.call(f,g,function(a,b){b?c.call(f,f,"failed",null):c.call(f,f,"ok",a)},a.createStreamResponse.options)}switch(f._logger.warn("Failed to create uploader",d),d.status){case"capacity":return c.call(f,f,d.status);default:return c.call(f,f,"failed")}})},h.prototype.subscribe=function(a,b,c){if("string"!=typeof a)throw new Error('"streamToken" must be a string');if("function"!=typeof b)throw new Error('"callback" must be a function');if(c=c||{},"object"!=typeof c)throw new Error('"options" must be an object');var d=this,e="download",f={negotiate:c.negotiate!==!1,connectUri:c.connectUri,connectOptions:c.connectOptions};this._protocol.setupStream(e,a,f,function(a,e){if(!e){var f=a.createStreamResponse.streamId,g=a.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,h=C;return g.match(/a=x-playlist:/)&&(h=D),h.call(d,f,g,function(a,c){c?b.call(d,d,"failed",null):b.call(d,d,"ok",a)},c)}switch(d._logger.warn("Failed to create downloader",e),e.status){case"capacity":case"stream-ended":case"origin-stream-ended":case"streaming-not-available":return b.call(d,d,e.status);default:return b.call(d,d,"failed")}})},h.prototype.toString=function(){return"PhenixPCast["+this._sessionId+","+(this._protocol?this._protocol.toString():"uninitialized")+"]"};var U=function(a){var b;return b="unavailable"===a.code?"conflict":"permission-denied"===a.message?"permission-denied":"PermissionDeniedError"===a.name?"permission-denied":"InternalError"===a.name&&"Starting video failed"===a.message?"conflict":"SourceUnavailableError"===a.name?"conflict":"SecurityError"===a.name&&"The operation is insecure."===a.message?"permission-denied":"failed"};return h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(10),c(1)],e=function(a,b,c){"use strict";function d(b,c,d,e){if("string"!=typeof b)throw new Error('Must pass a valid "uri"');if("string"!=typeof c)throw new Error('Must pass a valid "deviceId"');if("string"!=typeof d)throw new Error('Must pass a valid "version"');if("object"!=typeof e)throw new Error('Must pass a valid "logger"');this._uri=b,this._deviceId=c,this._version=d,this._logger=e,this._mqProtocol=new a(this._logger),this._logger.info("Connecting to [%s]",b),this._webSocket=new WebSocket(b),this._webSocket.onopen=h.bind(this),this._webSocket.onclose=i.bind(this),this._webSocket.onmessage=j.bind(this),this._webSocket.onerror=k.bind(this),this._nextRequestId=0,this._events={},this._requests={}}function e(a,b,c){var d=(this._nextRequestId++).toString(),e={requestId:d,type:a,payload:this._mqProtocol.encode(a,b)};return this._requests[d]=c,this._webSocket.send(this._mqProtocol.encode("mq.Request",e).toString("base64"))}function f(a){var b=this._events[a];return b||(this._events[a]=b=[]),b}function g(a,b){var c=this._events[a];if(c)for(var d=0;d<c.length;d++)c[d].apply(this,b)}function h(a){this._logger.info("Connected"),g.call(this,"connected")}function i(a){this._logger.info("Disconnected [%s]: [%s]",a.code,a.reason),g.call(this,"disconnected",[a.code,a.reason])}function j(a){this._logger.debug(">> [%s]",a.data);var c=this._mqProtocol.decode("mq.Response",b.wrap(a.data,"base64"));this._logger.info(">> [%s]",c.type);var d=this._mqProtocol.decode(c.type,c.payload);"pcast.AuthenticateResponse"===c.type?this._sessionId=d.sessionId:"pcast.StreamEnded"===c.type?g.call(this,"streamEnded",[d]):"pcast.StreamDataQuality"===c.type&&g.call(this,"dataQuality",[d]);var e=this._requests[c.requestId];e&&(delete this._requests[c.requestId],"mq.Error"===c.type||"ok"!==d.status?e(void 0,d):e(d))}function k(a){this._logger.error("An error occurred",a.data)}return d.prototype.on=function(a,b){if("string"!=typeof a)throw new Error('"eventName" must be a string');if("function"!=typeof b)throw new Error('"handler" must be a function');var c=f.call(this,a);c.push(b)},d.prototype.authenticate=function(a,b){if("string"!=typeof a)throw new Error('"authToken" must be a string');if("function"!=typeof b)throw new Error('"callback" must be a function');var d={apiVersion:this._mqProtocol.getApiVersion(),clientVersion:this._version,deviceId:this._deviceId,platform:c.browser,platformVersion:c.browserVersion.toString(),authenticationToken:a};return this._sessionId&&(auth.sessionId=this._sessionId),e.call(this,"pcast.Authenticate",d,b)},d.prototype.disconnect=function(){return delete this._sessionId,this._webSocket.close(1e3,"byebye")},d.prototype.bye=function(a,b){if("string"!=typeof a)throw new Error('"reason" must be a string');if("function"!=typeof b)throw new Error('"callback" must be a function');var c={sessionId:this._sessionId,reason:a};return e.call(this,"pcast.Bye",c,b)},d.prototype.setupStream=function(a,b,d,f){if("string"!=typeof a)throw new Error('"streamType" must be a string');if("string"!=typeof b)throw new Error('"streamToken" must be a string');if("object"!=typeof d)throw new Error('"options" must be an object');if("function"!=typeof f)throw new Error('"callback" must be a function');var g=c.browser||"UnknownBrowser",h=g+"-"+(c.browserVersion||0),i={streamToken:b,createStream:{sessionId:this._sessionId,options:["data-quality-notifications"],connectUri:d.connectUri,connectOptions:d.connectOptions||[]}};return d.negotiate&&(i.createStream.createOfferDescription={streamId:"",options:[a,g,h],apiVersion:this._mqProtocol.getApiVersion()}),e.call(this,"pcast.SetupStream",i,f)},d.prototype.setAnswerDescription=function(a,b,c){if("string"!=typeof a)throw new Error('"streamId" must be a string');if("string"!=typeof b)throw new Error('"sdp" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');var d={streamId:a,sessionDescription:{type:"Answer",sdp:b},apiVersion:this._mqProtocol.getApiVersion()};return e.call(this,"pcast.SetRemoteDescription",d,c)},d.prototype.addIceCandidates=function(a,b,c,d){if("string"!=typeof a)throw new Error('"streamId" must be a string');if(!(b instanceof Array))throw new Error('"candidates" must be an array');if(!(c instanceof Array))throw new Error('"options" must be an array');if("function"!=typeof d)throw new Error('"callback" must be a function');for(var f=[],g=0;g<b.length;g++){var h=b[g];if("string"!=typeof h.candidate)throw new Error('"candidates['+g+'].candidate" must be a string');if("number"!=typeof h.sdpMLineIndex)throw new Error('"candidates['+g+'].sdpMLineIndex" must be a number');if("string"!=typeof h.sdpMid)throw new Error('"candidates['+g+'].sdpMid" must be a string');f.push({candidate:h.candidate,sdpMLineIndex:h.sdpMLineIndex,sdpMid:h.sdpMid})}var i={streamId:a,candidates:f,options:c,apiVersion:this._mqProtocol.getApiVersion()};return e.call(this,"pcast.AddIceCandidates",i,d)},d.prototype.updateStreamState=function(a,b,c,d,f){if("string"!=typeof a)throw new Error('"streamId" must be a string');if("string"!=typeof b)throw new Error('"signalingState" must be a string');if("string"!=typeof c)throw new Error('"iceGatheringState" must be a string');if("string"!=typeof d)throw new Error('"iceConnectionState" must be a string');if("function"!=typeof f)throw new Error('"callback" must be a function');var g={streamId:a,signalingState:b,iceGatheringState:c,iceConnectionState:d,apiVersion:this._mqProtocol.getApiVersion()};return e.call(this,"pcast.UpdateStreamState",g,f)},d.prototype.destroyStream=function(a,b,c){if("string"!=typeof a)throw new Error('"streamId" must be a string');if("string"!=typeof b)throw new Error('"reason" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');var d={streamId:a,reason:b};return e.call(this,"pcast.DestroyStream",d,c)},d.prototype.toString=function(){return"PCastProtocol["+this._uri+","+this._webSocket.readyState+"]"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(5),c(6)],e=function(a,b){"use strict";function c(c){this._logger=c||new a;var d=b.loadJson(f);d=b.loadJson(g,d),d=b.loadJson(h,d),this._builders=d.build(),this._apiVersion=3}function d(a){for(var b=a.split("."),c=this._builders,d=0;d<b.length-1;d++)if(c=c[b[d]],!c)throw new Error('Unsupported type "'+a+'"');if(c=c[b[b.length-1]],"function"!=typeof c)throw new Error('Unsupported type "'+a+'"');return c}function e(a){if(a&&a.$type&&a.$type.children)for(var b in a.$type.children){var c=a.$type.children[b],d=a[c.name],f=c&&c.element?c.element.resolvedType:null;if(f&&"Message"===f.className&&f.children)a[c.name]=e(d);else if(f&&"Enum"===f.className&&f.children){for(var g=null,h=0;h<f.children.length;h++)if(f.children[h].id===d){g=f.children[h];break}g&&g.name&&(a[c.name]=g.name)}}return a}var f='{"package":"mq","messages":[{"name":"Request","fields":[{"rule":"optional","type":"string","name":"sessionId","id":1},{"rule":"optional","type":"string","name":"requestId","id":2},{"rule":"required","type":"string","name":"type","id":3},{"rule":"optional","type":"string","name":"encoding","id":4},{"rule":"required","type":"bytes","name":"payload","id":5}]},{"name":"Response","fields":[{"rule":"optional","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"requestId","id":2},{"rule":"required","type":"string","name":"type","id":3},{"rule":"optional","type":"string","name":"encoding","id":4},{"rule":"required","type":"bytes","name":"payload","id":5},{"rule":"repeated","type":"double","name":"wallTime","id":6}]},{"name":"Error","fields":[{"rule":"required","type":"string","name":"reason","id":1}]},{"name":"PingPong","fields":[{"rule":"required","type":"uint64","name":"originTimestamp","id":1},{"rule":"optional","type":"uint64","name":"count","id":2}]}]}',g='{"package":"pcast","messages":[{"name":"Authenticate","fields":[{"rule":"optional","type":"uint32","name":"apiVersion","id":9,"options":{"default":0}},{"rule":"required","type":"string","name":"clientVersion","id":1},{"rule":"optional","type":"string","name":"device","id":12},{"rule":"required","type":"string","name":"deviceId","id":2},{"rule":"optional","type":"string","name":"manufacturer","id":13},{"rule":"required","type":"string","name":"platform","id":3},{"rule":"required","type":"string","name":"platformVersion","id":4},{"rule":"required","type":"string","name":"authenticationToken","id":5},{"rule":"optional","type":"string","name":"connectionId","id":6},{"rule":"optional","type":"string","name":"connectionRouteKey","id":10},{"rule":"optional","type":"string","name":"remoteAddress","id":11},{"rule":"optional","type":"string","name":"sessionId","id":7},{"rule":"optional","type":"string","name":"applicationId","id":8}]},{"name":"AuthenticateResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"string","name":"sessionId","id":2},{"rule":"optional","type":"string","name":"redirect","id":3},{"rule":"repeated","type":"string","name":"roles","id":4}]},{"name":"Bye","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"reason","id":2}]},{"name":"ByeResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"SessionDescription","fields":[{"rule":"required","type":"Type","name":"type","id":1,"options":{"default":"Offer"}},{"rule":"required","type":"string","name":"sdp","id":2}],"enums":[{"name":"Type","values":[{"name":"Offer","id":0},{"name":"Answer","id":1}]}]},{"name":"CreateStream","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"optional","type":"string","name":"originStreamId","id":2},{"rule":"repeated","type":"string","name":"options","id":3},{"rule":"optional","type":"string","name":"connectUri","id":8},{"rule":"repeated","type":"string","name":"connectOptions","id":9},{"rule":"repeated","type":"string","name":"tags","id":4},{"rule":"optional","type":"SetRemoteDescription","name":"setRemoteDescription","id":5},{"rule":"optional","type":"CreateOfferDescription","name":"createOfferDescription","id":6},{"rule":"optional","type":"CreateAnswerDescription","name":"createAnswerDescription","id":7}]},{"name":"CreateStreamResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"string","name":"streamId","id":2},{"rule":"optional","type":"string","name":"instanceRouteKey","id":5},{"rule":"optional","type":"SetRemoteDescriptionResponse","name":"setRemoteDescriptionResponse","id":3},{"rule":"optional","type":"CreateOfferDescriptionResponse","name":"createOfferDescriptionResponse","id":4},{"rule":"optional","type":"CreateAnswerDescriptionResponse","name":"createAnswerDescriptionResponse","id":6},{"rule":"repeated","type":"string","name":"options","id":7}]},{"name":"SetLocalDescription","fields":[{"rule":"required","type":"string","name":"streamId","id":1},{"rule":"required","type":"SessionDescription","name":"sessionDescription","id":2},{"rule":"optional","type":"uint32","name":"apiVersion","id":3,"options":{"default":0}}]},{"name":"SetLocalDescriptionResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"repeated","type":"string","name":"options","id":2}]},{"name":"SetRemoteDescription","fields":[{"rule":"required","type":"string","name":"streamId","id":1},{"rule":"required","type":"SessionDescription","name":"sessionDescription","id":2},{"rule":"optional","type":"uint32","name":"apiVersion","id":3,"options":{"default":0}}]},{"name":"SetRemoteDescriptionResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"SessionDescription","name":"sessionDescription","id":2},{"rule":"repeated","type":"string","name":"options","id":3}]},{"name":"CreateOfferDescription","fields":[{"rule":"required","type":"string","name":"streamId","id":1},{"rule":"repeated","type":"string","name":"options","id":2},{"rule":"optional","type":"uint32","name":"apiVersion","id":3,"options":{"default":0}}]},{"name":"CreateOfferDescriptionResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"SessionDescription","name":"sessionDescription","id":2},{"rule":"repeated","type":"string","name":"options","id":3}]},{"name":"CreateAnswerDescription","fields":[{"rule":"required","type":"string","name":"streamId","id":1},{"rule":"repeated","type":"string","name":"options","id":2},{"rule":"optional","type":"uint32","name":"apiVersion","id":3,"options":{"default":0}}]},{"name":"CreateAnswerDescriptionResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"SessionDescription","name":"sessionDescription","id":2},{"rule":"repeated","type":"string","name":"options","id":3}]},{"name":"IceCandidate","fields":[{"rule":"required","type":"string","name":"candidate","id":1},{"rule":"required","type":"uint32","name":"sdpMLineIndex","id":2},{"rule":"required","type":"string","name":"sdpMid","id":3}]},{"name":"AddIceCandidates","fields":[{"rule":"required","type":"string","name":"streamId","id":1},{"rule":"repeated","type":"IceCandidate","name":"candidates","id":2},{"rule":"repeated","type":"string","name":"options","id":3},{"rule":"optional","type":"uint32","name":"apiVersion","id":4,"options":{"default":0}}]},{"name":"AddIceCandidatesResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"repeated","type":"string","name":"options","id":2}]},{"name":"UpdateStreamState","fields":[{"rule":"required","type":"string","name":"streamId","id":1},{"rule":"required","type":"string","name":"signalingState","id":2},{"rule":"required","type":"string","name":"iceGatheringState","id":3},{"rule":"required","type":"string","name":"iceConnectionState","id":4},{"rule":"optional","type":"uint32","name":"apiVersion","id":5,"options":{"default":0}}]},{"name":"UpdateStreamStateResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"repeated","type":"string","name":"options","id":2}]},{"name":"DestroyStream","fields":[{"rule":"required","type":"string","name":"streamId","id":1},{"rule":"optional","type":"string","name":"reason","id":2},{"rule":"repeated","type":"string","name":"options","id":3}]},{"name":"DestroyStreamResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"ArchiveStream","fields":[{"rule":"required","type":"string","name":"streamId","id":1},{"rule":"repeated","type":"string","name":"options","id":2}]},{"name":"ArchiveStreamResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"string","name":"uri","id":2}]},{"name":"ConnectionDisconnected","fields":[{"rule":"required","type":"string","name":"connectionId","id":1},{"rule":"required","type":"uint32","name":"reasonCode","id":2},{"rule":"optional","type":"string","name":"description","id":3}]},{"name":"ConnectionDisconnectedResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"StreamStarted","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"streamId","id":2},{"rule":"repeated","type":"string","name":"tags","id":3}]},{"name":"SourceStreamStarted","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"streamId","id":2},{"rule":"repeated","type":"string","name":"capabilities","id":3},{"rule":"repeated","type":"string","name":"tags","id":4}]},{"name":"StreamEnded","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"streamId","id":2},{"rule":"required","type":"string","name":"reason","id":3},{"rule":"repeated","type":"string","name":"tags","id":4}]},{"name":"SourceStreamEnded","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"streamId","id":2},{"rule":"required","type":"string","name":"reason","id":3},{"rule":"repeated","type":"string","name":"capabilities","id":4},{"rule":"repeated","type":"string","name":"tags","id":5}]},{"name":"StreamEndedResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"StreamIdle","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"streamId","id":2},{"rule":"repeated","type":"string","name":"options","id":3},{"rule":"repeated","type":"string","name":"tags","id":4}]},{"name":"StreamArchived","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"streamId","id":2},{"rule":"required","type":"string","name":"uri","id":3}]},{"name":"SessionEnded","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"reason","id":2},{"rule":"required","type":"float","name":"duration","id":3}]},{"name":"ForwardToClient","fields":[{"rule":"required","type":"string","name":"connectionId","id":1},{"rule":"required","type":"string","name":"type","id":2},{"rule":"required","type":"bytes","name":"payload","id":3}]},{"name":"ForwardToClientResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"SetupStream","fields":[{"rule":"required","type":"string","name":"streamToken","id":1},{"rule":"required","type":"CreateStream","name":"createStream","id":2}]},{"name":"SetupStreamResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"CreateStreamResponse","name":"createStreamResponse","id":2}]},{"name":"SetupPlaylistStream","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"streamToken","id":2},{"rule":"repeated","type":"string","name":"options","id":3},{"rule":"repeated","type":"string","name":"tags","id":4}]},{"name":"PlaylistStreamManifest","fields":[{"rule":"required","type":"string","name":"manifest","id":1}]},{"name":"SetupPlaylistStreamResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"repeated","type":"PlaylistStreamManifest","name":"manifests","id":2}]},{"name":"StreamDataQuality","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"streamId","id":2},{"rule":"required","type":"uint64","name":"timestamp","id":3},{"rule":"required","type":"DataQualityStatus","name":"status","id":4},{"rule":"required","type":"DataQualityReason","name":"reason","id":5}],"enums":[{"name":"DataQualityStatus","values":[{"name":"NoData","id":0},{"name":"AudioOnly","id":1},{"name":"All","id":2}]},{"name":"DataQualityReason","values":[{"name":"None","id":0},{"name":"UploadLimited","id":1},{"name":"DownloadLimited","id":2},{"name":"PublisherLimited","id":3},{"name":"NetworkLimited","id":4}]}]},{"name":"StreamDataQualityResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"CallbackEvent","fields":[{"rule":"optional","type":"uint32","name":"apiVersion","id":1,"options":{"default":0}},{"rule":"required","type":"string","name":"entity","id":2},{"rule":"required","type":"string","name":"what","id":3},{"rule":"required","type":"string","name":"data","id":4},{"rule":"optional","type":"string","name":"sessionId","id":5}]},{"name":"Uri","fields":[{"rule":"optional","type":"string","name":"protocol","id":1,"options":{"default":"http"}},{"rule":"required","type":"string","name":"host","id":2},{"rule":"optional","type":"uint32","name":"port","id":3,"options":{"default":80}},{"rule":"optional","type":"string","name":"method","id":4,"options":{"default":"POST"}},{"rule":"optional","type":"string","name":"path","id":5,"options":{"default":"/"}}]},{"name":"SetApplicationCallback","fields":[{"rule":"required","type":"string","name":"applicationId","id":1},{"rule":"required","type":"string","name":"secret","id":2},{"rule":"required","type":"Uri","name":"callback","id":3}]},{"name":"SetApplicationCallbackResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"IssueAuthenticationToken","fields":[{"rule":"required","type":"string","name":"applicationId","id":1},{"rule":"required","type":"string","name":"secret","id":2},{"rule":"repeated","type":"string","name":"capabilities","id":3}]},{"name":"IssueAuthenticationTokenResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"string","name":"authenticationToken","id":2}]},{"name":"IssueStreamToken","fields":[{"rule":"required","type":"string","name":"applicationId","id":1},{"rule":"required","type":"string","name":"secret","id":2},{"rule":"required","type":"string","name":"sessionId","id":3},{"rule":"optional","type":"string","name":"originStreamId","id":4},{"rule":"repeated","type":"string","name":"capabilities","id":5}]},{"name":"IssueStreamTokenResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"string","name":"streamToken","id":2}]},{"name":"TerminateStream","fields":[{"rule":"required","type":"string","name":"applicationId","id":1},{"rule":"required","type":"string","name":"secret","id":2},{"rule":"required","type":"string","name":"streamId","id":3},{"rule":"optional","type":"string","name":"reason","id":4}]},{"name":"TerminateStreamResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"Stream","fields":[{"rule":"required","type":"string","name":"streamId","id":1}]},{"name":"ListStreams","fields":[{"rule":"required","type":"string","name":"applicationId","id":1},{"rule":"required","type":"string","name":"secret","id":2},{"rule":"optional","type":"string","name":"start","id":3},{"rule":"required","type":"uint32","name":"length","id":4},{"rule":"repeated","type":"string","name":"options","id":5}]},{"name":"ListStreamsResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"string","name":"start","id":2},{"rule":"optional","type":"uint32","name":"length","id":3},{"rule":"repeated","type":"Stream","name":"streams","id":4}]}]}',h='{"package":"chat","messages":[{"name":"Room","fields":[{"rule":"optional","type":"string","name":"roomId","id":1},{"rule":"required","type":"string","name":"name","id":2},{"rule":"required","type":"string","name":"description","id":3},{"rule":"required","type":"RoomType","name":"type","id":4},{"rule":"repeated","type":"string","name":"options","id":5}]},{"name":"Stream","fields":[{"rule":"required","type":"StreamType","name":"type","id":1},{"rule":"required","type":"string","name":"uri","id":2},{"rule":"required","type":"TrackState","name":"audioState","id":3},{"rule":"required","type":"TrackState","name":"videoState","id":4}]},{"name":"Member","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"screenName","id":2},{"rule":"required","type":"MemberRole","name":"role","id":3},{"rule":"repeated","type":"Stream","name":"streams","id":4},{"rule":"required","type":"uint64","name":"lastUpdate","id":7}]},{"name":"CreateRoom","fields":[{"rule":"required","type":"Room","name":"room","id":1}]},{"name":"CreateRoomResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"string","name":"roomId","id":2}]},{"name":"JoinRoom","fields":[{"rule":"required","type":"string","name":"roomId","id":1},{"rule":"required","type":"string","name":"sessionId","id":2},{"rule":"required","type":"Member","name":"member","id":3},{"rule":"repeated","type":"string","name":"options","id":4},{"rule":"required","type":"uint64","name":"timestamp","id":5}]},{"name":"JoinRoomResponse","fields":[{"rule":"required","type":"string","name":"status","id":1},{"rule":"optional","type":"Room","name":"room","id":2},{"rule":"repeated","type":"Member","name":"members","id":3},{"rule":"repeated","type":"string","name":"options","id":4}]},{"name":"UpdateRoom","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"Room","name":"room","id":2},{"rule":"required","type":"uint64","name":"timestamp","id":3}]},{"name":"UpdateRoomResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"UpdateMember","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"Member","name":"member","id":2},{"rule":"repeated","type":"string","name":"options","id":3},{"rule":"required","type":"uint64","name":"timestamp","id":4}]},{"name":"UpdateMemberResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"LeaveRoom","fields":[{"rule":"required","type":"string","name":"roomId","id":1},{"rule":"required","type":"string","name":"sessionId","id":2},{"rule":"required","type":"uint64","name":"timestamp","id":3}]},{"name":"LeaveRoomResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"DestroyRoom","fields":[{"rule":"required","type":"string","name":"roomId","id":1}]},{"name":"DestroyRoomResponse","fields":[{"rule":"required","type":"string","name":"status","id":1}]},{"name":"RoomEvent","fields":[{"rule":"required","type":"string","name":"sessionId","id":1},{"rule":"required","type":"string","name":"roomId","id":2},{"rule":"required","type":"RoomEventType","name":"eventType","id":3},{"rule":"repeated","type":"Member","name":"members","id":4},{"rule":"optional","type":"Room","name":"room","id":5},{"rule":"repeated","type":"string","name":"options","id":6},{"rule":"required","type":"uint64","name":"timestamp","id":7}]}],"enums":[{"name":"RoomType","values":[{"name":"DirectChat","id":0},{"name":"MultiPartyChat","id":1},{"name":"ModeratedChat","id":2},{"name":"TownHall","id":3}]},{"name":"MemberRole","values":[{"name":"Participant","id":0},{"name":"Moderator","id":1},{"name":"Presenter","id":2},{"name":"Audience","id":3}]},{"name":"RoomEventType","values":[{"name":"MemberJoined","id":0},{"name":"MemberLeft","id":1},{"name":"MemberUpdated","id":2},{"name":"Updated","id":3},{"name":"Ended","id":4}]},{"name":"TrackState","values":[{"name":"Enabled","id":0},{"name":"Disabled","id":1},{"name":"Ended","id":2}]},{"name":"StreamType","values":[{"name":"User","id":0},{"name":"Presentation","id":1}]}]}';
return c.prototype.getApiVersion=function(){return this._apiVersion},c.prototype.encode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");if("object"!=typeof b)throw new Error("'data' must be an object");var c=d.call(this,a);return c.encode(b)},c.prototype.decode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");var c=d.call(this,a);return e(c.decode(b))},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(){}var b=function(){console.log.apply(console,arguments)}||function(){},c=function(){console.error.apply(console,arguments)}||b;return a.prototype.trace=function(){return b(arguments)},a.prototype.debug=function(){return b(arguments)},a.prototype.info=function(){return b(arguments)},a.prototype.warn=function(){return c(arguments)},a.prototype.error=function(){return c(arguments)},a.prototype.fatal=function(){return c(arguments)},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e,f;(function(a,g){!function(a,h){c(9).amd?(e=[c(10)],d=h,f="function"==typeof d?d.apply(b,e):d,!(void 0!==f&&(g.exports=f))):"object"==typeof g&&g&&g.exports?g.exports=h(c(10),!0):(a.dcodeIO=a.dcodeIO||{}).ProtoBuf=h(a.dcodeIO.ByteBuffer)}(this,function(b,d){"use strict";var e={};return e.ByteBuffer=b,e.Long=b.Long||null,e.VERSION="4.1.2",e.WIRE_TYPES={},e.WIRE_TYPES.VARINT=0,e.WIRE_TYPES.BITS64=1,e.WIRE_TYPES.LDELIM=2,e.WIRE_TYPES.STARTGROUP=3,e.WIRE_TYPES.ENDGROUP=4,e.WIRE_TYPES.BITS32=5,e.PACKABLE_WIRE_TYPES=[e.WIRE_TYPES.VARINT,e.WIRE_TYPES.BITS64,e.WIRE_TYPES.BITS32],e.TYPES={int32:{name:"int32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},uint64:{name:"uint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.UZERO:void 0},sint64:{name:"sint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},bool:{name:"bool",wireType:e.WIRE_TYPES.VARINT,defaultValue:!1},"double":{name:"double",wireType:e.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:e.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.ZERO:void 0},"float":{name:"float",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},"enum":{name:"enum",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:e.WIRE_TYPES.STARTGROUP,defaultValue:null}},e.MAP_KEY_TYPES=[e.TYPES.int32,e.TYPES.sint32,e.TYPES.sfixed32,e.TYPES.uint32,e.TYPES.fixed32,e.TYPES.int64,e.TYPES.sint64,e.TYPES.sfixed64,e.TYPES.uint64,e.TYPES.fixed64,e.TYPES.bool,e.TYPES.string,e.TYPES.bytes],e.ID_MIN=1,e.ID_MAX=536870911,e.convertFieldsToCamelCase=!1,e.populateAccessors=!0,e.populateDefaults=!0,e.Util=function(){var b={};return b.IS_NODE=!("object"!=typeof a||a+""!="[object process]"||a.browser),b.XHR=function(){for(var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=null,c=0;c<a.length;c++){try{b=a[c]()}catch(d){continue}break}if(!b)throw Error("XMLHttpRequest is not supported");return b},b.fetch=function(a,d){if(d&&"function"!=typeof d&&(d=null),b.IS_NODE){var e=c(12);if(d)e.readFile(a,function(a,b){d(a?null:""+b)});else try{return e.readFileSync(a)}catch(f){return null}}else{var g=b.XHR();if(g.open("GET",a,!!d),g.setRequestHeader("Accept","text/plain"),"function"==typeof g.overrideMimeType&&g.overrideMimeType("text/plain"),!d)return g.send(null),200==g.status||0==g.status&&"string"==typeof g.responseText?g.responseText:null;if(g.onreadystatechange=function(){4==g.readyState&&d(200==g.status||0==g.status&&"string"==typeof g.responseText?g.responseText:null)},4==g.readyState)return;g.send(null)}},b.toCamelCase=function(a){return a.replace(/_([a-zA-Z])/g,function(a,b){return b.toUpperCase()})},b}(),e.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},e.DotProto=function(a,b){function c(a,c){var d=-1,e=1;if("-"==a.charAt(0)&&(e=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))d=parseInt(a);else if(b.NUMBER_HEX.test(a))d=parseInt(a.substring(2),16);else{if(!b.NUMBER_OCT.test(a))throw Error("illegal id value: "+(e<0?"-":"")+a);d=parseInt(a.substring(1),8)}if(d=e*d|0,!c&&d<0)throw Error("illegal id value: "+(e<0?"-":"")+a);return d}function d(a){var c=1;if("-"==a.charAt(0)&&(c=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))return c*parseInt(a,10);if(b.NUMBER_HEX.test(a))return c*parseInt(a.substring(2),16);if(b.NUMBER_OCT.test(a))return c*parseInt(a.substring(1),8);if("inf"===a)return c*(1/0);if("nan"===a)return NaN;if(b.NUMBER_FLT.test(a))return c*parseFloat(a);throw Error("illegal number value: "+(c<0?"-":"")+a)}function e(a,b,c){"undefined"==typeof a[b]?a[b]=c:(Array.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c))}var f={},g=function(a){this.source=a+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},h=g.prototype;h._readString=function(){var a='"'===this._stringOpen?b.STRING_DQ:b.STRING_SQ;a.lastIndex=this.index-1;var c=a.exec(this.source);if(!c)throw Error("unterminated string");return this.index=a.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,c[1]},h.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var a,c,d;do{for(a=!1;b.WHITESPACE.test(d=this.source.charAt(this.index));)if("\n"===d&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,a=!0}else{if("*"!==(d=this.source.charAt(this.index)))return"/";do{if("\n"===d&&++this.line,++this.index===this.source.length)return null;c=d,d=this.source.charAt(this.index)}while("*"!==c||"/"!==d);++this.index,a=!0}}while(a);if(this.index===this.source.length)return null;var e=this.index;b.DELIM.lastIndex=0;var f=b.DELIM.test(this.source.charAt(e++));if(!f)for(;e<this.source.length&&!b.DELIM.test(this.source.charAt(e));)++e;var g=this.source.substring(this.index,this.index=e);return'"'!==g&&"'"!==g||(this._stringOpen=g),g},h.peek=function(){if(0===this.stack.length){var a=this.next();if(null===a)return null;this.stack.push(a)}return this.stack[0]},h.skip=function(a){var b=this.next();if(b!==a)throw Error("illegal '"+b+"', '"+a+"' expected")},h.omit=function(a){return this.peek()===a&&(this.next(),!0)},h.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},f.Tokenizer=g;var i=function(a){this.tn=new g(a),this.proto3=!1},j=i.prototype;return j.parse=function(){var a,c={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]},d=!0;try{for(;a=this.tn.next();)switch(a){case"package":if(!d||null!==c["package"])throw Error("unexpected 'package'");if(a=this.tn.next(),!b.TYPEREF.test(a))throw Error("illegal package name: "+a);this.tn.skip(";"),c["package"]=a;break;case"import":if(!d)throw Error("unexpected 'import'");a=this.tn.peek(),"public"===a&&this.tn.next(),a=this._readString(),this.tn.skip(";"),c.imports.push(a);break;case"syntax":if(!d)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(c.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(c,null),d=!1;break;case"enum":this._parseEnum(c),d=!1;break;case"option":this._parseOption(c);break;case"service":this._parseService(c);break;case"extend":this._parseExtend(c);break;default:throw Error("unexpected '"+a+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete c.name,c},i.parse=function(a){return new i(a).parse()},j._readString=function(){var a,b,c="";do{if(b=this.tn.next(),"'"!==b&&'"'!==b)throw Error("illegal string delimiter: "+b);c+=this.tn.next(),this.tn.skip(b),a=this.tn.peek()}while('"'===a||'"'===a);return c},j._readValue=function(a){var c=this.tn.peek();if('"'===c||"'"===c)return this._readString();if(this.tn.next(),b.NUMBER.test(c))return d(c);if(b.BOOL.test(c))return"true"===c.toLowerCase();if(a&&b.TYPEREF.test(c))return c;throw Error("illegal value: "+c)},j._parseOption=function(a,c){var d=this.tn.next(),e=!1;if("("===d&&(e=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal option name: "+d);var f=d;e&&(this.tn.skip(")"),f="("+f+")",d=this.tn.peek(),b.FQTYPEREF.test(d)&&(f+=d,this.tn.next())),this.tn.skip("="),this._parseOptionValue(a,f),c||this.tn.skip(";")},j._parseOptionValue=function(a,c){var d=this.tn.peek();if("{"!==d)e(a.options,c,this._readValue(!0));else for(this.tn.skip("{");"}"!==(d=this.tn.next());){if(!b.NAME.test(d))throw Error("illegal option name: "+c+"."+d);this.tn.omit(":")?e(a.options,c+"."+d,this._readValue(!0)):this._parseOptionValue(a,c+"."+d)}},j._parseService=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal service name at line "+this.tn.line+": "+c);var d=c,e={name:d,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if("option"===c)this._parseOption(e);else{if("rpc"!==c)throw Error("illegal service token: "+c);this._parseServiceRPC(e)}this.tn.omit(";"),a.services.push(e)},j._parseServiceRPC=function(a){var c="rpc",d=this.tn.next();if(!b.NAME.test(d))throw Error("illegal rpc service method name: "+d);var e=d,f={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.request_stream=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal rpc service request type: "+d);if(f.request=d,this.tn.skip(")"),d=this.tn.next(),"returns"!==d.toLowerCase())throw Error("illegal rpc service request type delimiter: "+d);if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.response_stream=!0,d=this.tn.next()),f.response=d,this.tn.skip(")"),d=this.tn.peek(),"{"===d){for(this.tn.next();"}"!==(d=this.tn.next());){if("option"!==d)throw Error("illegal rpc service token: "+d);this._parseOption(f)}this.tn.omit(";")}else this.tn.skip(";");"undefined"==typeof a[c]&&(a[c]={}),a[c][e]=f},j._parseMessage=function(a,d){var e=!!d,f=this.tn.next(),g={name:"",fields:[],enums:[],messages:[],options:{},oneofs:{}};if(!b.NAME.test(f))throw Error("illegal "+(e?"group":"message")+" name: "+f);for(g.name=f,e&&(this.tn.skip("="),d.id=c(this.tn.next()),g.isGroup=!0),f=this.tn.peek(),"["===f&&d&&this._parseFieldOptions(d),this.tn.skip("{");"}"!==(f=this.tn.next());)if(b.RULE.test(f))this._parseMessageField(g,f);else if("oneof"===f)this._parseMessageOneOf(g);else if("enum"===f)this._parseEnum(g);else if("message"===f)this._parseMessage(g);else if("option"===f)this._parseOption(g);else if("extensions"===f)this._parseExtensions(g);else if("extend"===f)this._parseExtend(g);else{if(!b.TYPEREF.test(f))throw Error("illegal message token: "+f);if(!this.proto3)throw Error("illegal field rule: "+f);this._parseMessageField(g,"optional",f)}return this.tn.omit(";"),a.messages.push(g),g},j._parseMessageField=function(a,d,e){if(!b.RULE.test(d))throw Error("illegal message field rule: "+d);var f,g={rule:d,type:"",name:"",options:{},id:0};if("map"===d){if(e)throw Error("illegal type: "+e);if(this.tn.skip("<"),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field type: "+f);if(g.keytype=f,this.tn.skip(","),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field: "+f);if(g.type=f,this.tn.skip(">"),f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}else if(e="undefined"!=typeof e?e:this.tn.next(),"group"===e){var h=this._parseMessage(a,g);if(!/^[A-Z]/.test(h.name))throw Error("illegal group name: "+h.name);g.type=h.name,g.name=h.name.toLowerCase(),this.tn.omit(";")}else{if(!b.TYPE.test(e)&&!b.TYPEREF.test(e))throw Error("illegal message field type: "+e);if(g.type=e,f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}return a.fields.push(g),g},j._parseMessageOneOf=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal oneof name: "+c);var d,e=c,f=[];for(this.tn.skip("{");"}"!==(c=this.tn.next());)d=this._parseMessageField(a,"optional",c),d.oneof=e,f.push(d.id);this.tn.omit(";"),a.oneofs[e]=f},j._parseFieldOptions=function(a){this.tn.skip("[");for(var b,c=!0;"]"!==(b=this.tn.peek());)c||this.tn.skip(","),this._parseOption(a,!0),c=!1;this.tn.next()},j._parseEnum=function(a){var d={name:"",values:[],options:{}},e=this.tn.next();if(!b.NAME.test(e))throw Error("illegal name: "+e);for(d.name=e,this.tn.skip("{");"}"!==(e=this.tn.next());)if("option"===e)this._parseOption(d);else{if(!b.NAME.test(e))throw Error("illegal name: "+e);this.tn.skip("=");var f={name:e,id:c(this.tn.next(),!0)};e=this.tn.peek(),"["===e&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),d.values.push(f)}this.tn.omit(";"),a.enums.push(d)},j._parseExtensions=function(b){var c=this.tn.next(),e=[];"min"===c?e.push(a.ID_MIN):"max"===c?e.push(a.ID_MAX):e.push(d(c)),this.tn.skip("to"),c=this.tn.next(),"min"===c?e.push(a.ID_MIN):"max"===c?e.push(a.ID_MAX):e.push(d(c)),this.tn.skip(";"),b.extensions=e},j._parseExtend=function(a){var c=this.tn.next();if(!b.TYPEREF.test(c))throw Error("illegal extend reference: "+c);var d={ref:c,fields:[]};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if(b.RULE.test(c))this._parseMessageField(d,c);else{if(!b.TYPEREF.test(c))throw Error("illegal extend token: "+c);if(!this.proto3)throw Error("illegal field rule: "+c);this._parseMessageField(d,"optional",c)}return this.tn.omit(";"),a.messages.push(d),d},j.toString=function(){return"Parser at line "+this.tn.line},f.Parser=i,f}(e,e.Lang),e.Reflect=function(a){function c(c){if("string"==typeof c&&(c=a.TYPES[c]),"undefined"==typeof c.defaultValue)throw Error("default value for type "+c.name+" is not supported");return c==a.TYPES.bytes?new b(0):c.defaultValue}function d(b,c){if(b&&"number"==typeof b.low&&"number"==typeof b.high&&"boolean"==typeof b.unsigned&&b.low===b.low&&b.high===b.high)return new a.Long(b.low,b.high,"undefined"==typeof c?b.unsigned:c);if("string"==typeof b)return a.Long.fromString(b,c||!1,10);if("number"==typeof b)return a.Long.fromNumber(b,c||!1);throw Error("not convertible to Long")}function e(b,c){var d=c.readVarint32(),f=7&d,g=d>>>3;switch(f){case a.WIRE_TYPES.VARINT:do d=c.readUint8();while(128===(128&d));break;case a.WIRE_TYPES.BITS64:c.offset+=8;break;case a.WIRE_TYPES.LDELIM:d=c.readVarint32(),c.offset+=d;break;case a.WIRE_TYPES.STARTGROUP:e(g,c);break;case a.WIRE_TYPES.ENDGROUP:if(g===b)return!1;throw Error("Illegal GROUPEND after unknown group: "+g+" ("+b+" expected)");case a.WIRE_TYPES.BITS32:c.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+b+": "+f)}return!0}var f={},g=function(a,b,c){this.builder=a,this.parent=b,this.name=c,this.className},h=g.prototype;h.fqn=function(){for(var a=this.name,b=this;;){if(b=b.parent,null==b)break;a=b.name+"."+a}return a},h.toString=function(a){return(a?this.className+" ":"")+this.fqn()},h.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},f.T=g;var i=function(a,b,c,d,e){g.call(this,a,b,c),this.className="Namespace",this.children=[],this.options=d||{},this.syntax=e||"proto2"},j=i.prototype=Object.create(g.prototype);j.getChildren=function(a){if(a=a||null,null==a)return this.children.slice();for(var b=[],c=0,d=this.children.length;c<d;++c)this.children[c]instanceof a&&b.push(this.children[c]);return b},j.addChild=function(a){var b;if(b=this.getChild(a.name))if(b instanceof m.Field&&b.name!==b.originalName&&null===this.getChild(b.originalName))b.name=b.originalName;else{if(!(a instanceof m.Field&&a.name!==a.originalName&&null===this.getChild(a.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+a.name);a.name=a.originalName}this.children.push(a)},j.getChild=function(a){for(var b="number"==typeof a?"id":"name",c=0,d=this.children.length;c<d;++c)if(this.children[c][b]===a)return this.children[c];return null},j.resolve=function(a,b){var c="string"==typeof a?a.split("."):a,d=this,e=0;if(""===c[e]){for(;null!==d.parent;)d=d.parent;e++}var g;do{do{if(!(d instanceof f.Namespace)){d=null;break}if(g=d.getChild(c[e]),!g||!(g instanceof f.T)||b&&!(g instanceof f.Namespace)){d=null;break}d=g,e++}while(e<c.length);if(null!=d)break;if(null!==this.parent)return this.parent.resolve(a,b)}while(null!=d);return d},j.qn=function(a){var b=[],c=a;do b.unshift(c.name),c=c.parent;while(null!==c);for(var d=1;d<=b.length;d++){var e=b.slice(b.length-d);if(a===this.resolve(e,a instanceof f.Namespace))return e.join(".")}return a.fqn()},j.build=function(){for(var a,b={},c=this.children,d=0,e=c.length;d<e;++d)a=c[d],a instanceof i&&(b[a.name]=a.build());return Object.defineProperty&&Object.defineProperty(b,"$options",{value:this.buildOpt()}),b},j.buildOpt=function(){for(var a={},b=Object.keys(this.options),c=0,d=b.length;c<d;++c){var e=b[c],f=this.options[b[c]];a[e]=f}return a},j.getOption=function(a){return"undefined"==typeof a?this.options:"undefined"!=typeof this.options[a]?this.options[a]:null},f.Namespace=i;var k=function(b,c,d,e){if(this.type=b,this.resolvedType=c,this.isMapKey=d,this.syntax=e,d&&a.MAP_KEY_TYPES.indexOf(b)<0)throw Error("Invalid map key type: "+b.name)},l=k.prototype;k.defaultFieldValue=c,l.verifyValue=function(c){var e=function(a,b){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+a+" ("+b+")")}.bind(this);switch(this.type){case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c>4294967295?0|c:c;case a.TYPES.uint32:case a.TYPES.fixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c<0?c>>>0:c;case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:if(a.Long)try{return d(c,!1)}catch(f){e(typeof c,f.message)}else e(typeof c,"requires Long.js");case a.TYPES.uint64:case a.TYPES.fixed64:if(a.Long)try{return d(c,!0)}catch(f){e(typeof c,f.message)}else e(typeof c,"requires Long.js");case a.TYPES.bool:return"boolean"!=typeof c&&e(typeof c,"not a boolean"),c;case a.TYPES["float"]:case a.TYPES["double"]:return"number"!=typeof c&&e(typeof c,"not a number"),c;case a.TYPES.string:return"string"==typeof c||c&&c instanceof String||e(typeof c,"not a string"),""+c;case a.TYPES.bytes:return b.isByteBuffer(c)?c:b.wrap(c,"base64");case a.TYPES["enum"]:var g=this.resolvedType.getChildren(a.Reflect.Enum.Value);for(i=0;i<g.length;i++){if(g[i].name==c)return g[i].id;if(g[i].id==c)return g[i].id}if("proto3"===this.syntax)return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),(c>4294967295||c<0)&&e(typeof c,"not in range for uint32"),c;e(c,"not a valid enum value");case a.TYPES.group:case a.TYPES.message:if(c&&"object"==typeof c||e(typeof c,"object expected"),c instanceof this.resolvedType.clazz)return c;if(c instanceof a.Builder.Message){var h={};for(var i in c)c.hasOwnProperty(i)&&(h[i]=c[i]);c=h}return new this.resolvedType.clazz(c)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+c+" (undefined type "+this.type+")")},l.calculateLength=function(c,d){if(null===d)return 0;var e;switch(this.type){case a.TYPES.int32:return d<0?b.calculateVarint64(d):b.calculateVarint32(d);case a.TYPES.uint32:return b.calculateVarint32(d);case a.TYPES.sint32:return b.calculateVarint32(b.zigZagEncode32(d));case a.TYPES.fixed32:case a.TYPES.sfixed32:case a.TYPES["float"]:return 4;case a.TYPES.int64:case a.TYPES.uint64:return b.calculateVarint64(d);case a.TYPES.sint64:return b.calculateVarint64(b.zigZagEncode64(d));case a.TYPES.fixed64:case a.TYPES.sfixed64:return 8;case a.TYPES.bool:return 1;case a.TYPES["enum"]:return b.calculateVarint32(d);case a.TYPES["double"]:return 8;case a.TYPES.string:return e=b.calculateUTF8Bytes(d),b.calculateVarint32(e)+e;case a.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");return b.calculateVarint32(d.remaining())+d.remaining();case a.TYPES.message:return e=this.resolvedType.calculate(d),b.calculateVarint32(e)+e;case a.TYPES.group:return e=this.resolvedType.calculate(d),e+b.calculateVarint32(c<<3|a.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")},l.encodeValue=function(c,d,e){if(null===d)return e;switch(this.type){case a.TYPES.int32:d<0?e.writeVarint64(d):e.writeVarint32(d);break;case a.TYPES.uint32:e.writeVarint32(d);break;case a.TYPES.sint32:e.writeVarint32ZigZag(d);break;case a.TYPES.fixed32:e.writeUint32(d);break;case a.TYPES.sfixed32:e.writeInt32(d);break;case a.TYPES.int64:case a.TYPES.uint64:e.writeVarint64(d);break;case a.TYPES.sint64:e.writeVarint64ZigZag(d);break;case a.TYPES.fixed64:e.writeUint64(d);break;case a.TYPES.sfixed64:e.writeInt64(d);break;case a.TYPES.bool:"string"==typeof d?e.writeVarint32("false"===d.toLowerCase()?0:!!d):e.writeVarint32(d?1:0);break;case a.TYPES["enum"]:e.writeVarint32(d);break;case a.TYPES["float"]:e.writeFloat32(d);break;case a.TYPES["double"]:e.writeFloat64(d);break;case a.TYPES.string:e.writeVString(d);break;case a.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");var f=d.offset;e.writeVarint32(d.remaining()),e.append(d),d.offset=f;break;case a.TYPES.message:var g=(new b).LE();this.resolvedType.encode(d,g),e.writeVarint32(g.offset),e.append(g.flip());break;case a.TYPES.group:this.resolvedType.encode(d,e),e.writeVarint32(c<<3|a.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")}return e},l.decode=function(b,c,d){if(c!=this.type.wireType)throw Error("Unexpected wire type for element");var e,f;switch(this.type){case a.TYPES.int32:return 0|b.readVarint32();case a.TYPES.uint32:return b.readVarint32()>>>0;case a.TYPES.sint32:return 0|b.readVarint32ZigZag();case a.TYPES.fixed32:return b.readUint32()>>>0;case a.TYPES.sfixed32:return 0|b.readInt32();case a.TYPES.int64:return b.readVarint64();case a.TYPES.uint64:return b.readVarint64().toUnsigned();case a.TYPES.sint64:return b.readVarint64ZigZag();case a.TYPES.fixed64:return b.readUint64();case a.TYPES.sfixed64:return b.readInt64();case a.TYPES.bool:return!!b.readVarint32();case a.TYPES["enum"]:return b.readVarint32();case a.TYPES["float"]:return b.readFloat();case a.TYPES["double"]:return b.readDouble();case a.TYPES.string:return b.readVString();case a.TYPES.bytes:if(f=b.readVarint32(),b.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+b.remaining());return e=b.clone(),e.limit=e.offset+f,b.offset+=f,e;case a.TYPES.message:return f=b.readVarint32(),this.resolvedType.decode(b,f);case a.TYPES.group:return this.resolvedType.decode(b,-1,d)}throw Error("[INTERNAL] Illegal decode type")},l.valueFromString=function(c){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:case a.TYPES.uint32:case a.TYPES.fixed32:return this.verifyValue(parseInt(c));case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:case a.TYPES.uint64:case a.TYPES.fixed64:return this.verifyValue(c);case a.TYPES.bool:return"true"===c;case a.TYPES.string:return this.verifyValue(c);case a.TYPES.bytes:return b.fromBinary(c)}},l.valueToString=function(b){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===a.TYPES.bytes?b.toString("binary"):b.toString()},f.Element=k;var m=function(b,c,d,e,f,g){i.call(this,b,c,d,e,g),this.className="Message",this.extensions=[a.ID_MIN,a.ID_MAX],this.clazz=null,this.isGroup=!!f,this._fields=null,this._fieldsById=null,this._fieldsByName=null},n=m.prototype=Object.create(i.prototype);n.build=function(c){if(this.clazz&&!c)return this.clazz;var d=function(a,c){function d(c,e,f,g){if(null===c||"object"!=typeof c){if(g&&g instanceof a.Reflect.Enum){var h=a.Reflect.Enum.getName(g.object,c);if(null!==h)return h}return c}if(b.isByteBuffer(c))return e?c.toBase64():c.toBuffer();if(a.Long.isLong(c))return f?c.toString():new a.Long(c);var i;if(Array.isArray(c))return i=[],c.forEach(function(a,b){i[b]=d(a,e,f,g)}),i;if(i={},c instanceof a.Map){for(var j=c.entries(),k=j.next();!k.done;k=j.next())i[c.keyElem.valueToString(k.value[0])]=d(k.value[1],e,f,c.valueElem.resolvedType);return i}var l=c.$type,m=void 0;for(var n in c)c.hasOwnProperty(n)&&(l&&(m=l.getChild(n))?i[n]=d(c[n],e,f,m.resolvedType):i[n]=d(c[n],e,f));return i}var e=c.getChildren(a.Reflect.Message.Field),f=c.getChildren(a.Reflect.Message.OneOf),g=function(d,h){a.Builder.Message.call(this);for(var i=0,j=f.length;i<j;++i)this[f[i].name]=null;for(i=0,j=e.length;i<j;++i){var k=e[i];this[k.name]=k.repeated?[]:k.map?new a.Map(k):null,!k.required&&"proto3"!==c.syntax||null===k.defaultValue||(this[k.name]=k.defaultValue)}if(arguments.length>0){var l;if(1!==arguments.length||null===d||"object"!=typeof d||!("function"!=typeof d.encode||d instanceof g)||Array.isArray(d)||d instanceof a.Map||b.isByteBuffer(d)||d instanceof ArrayBuffer||a.Long&&d instanceof a.Long)for(i=0,j=arguments.length;i<j;++i)"undefined"!=typeof(l=arguments[i])&&this.$set(e[i].name,l);else this.$set(d)}},h=g.prototype=Object.create(a.Builder.Message.prototype);h.add=function(b,d,e){var f=c._fieldsByName[b];if(!e){if(!f)throw Error(this+"#"+b+" is undefined");if(!(f instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: "+f.toString(!0));if(!f.repeated)throw Error(this+"#"+b+" is not a repeated field");d=f.verifyValue(d,!0)}return null===this[b]&&(this[b]=[]),this[b].push(d),this},h.$add=h.add,h.set=function(b,d,e){if(b&&"object"==typeof b){e=d;for(var f in b)b.hasOwnProperty(f)&&"undefined"!=typeof(d=b[f])&&this.$set(f,d,e);return this}var g=c._fieldsByName[b];if(e)this[b]=d;else{if(!g)throw Error(this+"#"+b+" is not a field: undefined");if(!(g instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: "+g.toString(!0));this[g.name]=d=g.verifyValue(d)}if(g&&g.oneof){var h=this[g.oneof.name];null!==d?(null!==h&&h!==g.name&&(this[h]=null),this[g.oneof.name]=g.name):h===b&&(this[g.oneof.name]=null)}return this},h.$set=h.set,h.get=function(b,d){if(d)return this[b];var e=c._fieldsByName[b];if(!(e&&e instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: undefined");if(!(e instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: "+e.toString(!0));return this[e.name]},h.$get=h.get;for(var i=0;i<e.length;i++){var j=e[i];j instanceof a.Reflect.Message.ExtensionField||c.builder.options.populateAccessors&&function(a){var b=a.originalName.replace(/(_[a-zA-Z])/g,function(a){return a.toUpperCase().replace("_","")});b=b.substring(0,1).toUpperCase()+b.substring(1);var d=a.originalName.replace(/([A-Z])/g,function(a){return"_"+a}),e=function(b,c){return this[a.name]=c?b:a.verifyValue(b),this},f=function(){return this[a.name]};null===c.getChild("set"+b)&&(h["set"+b]=e),null===c.getChild("set_"+d)&&(h["set_"+d]=e),null===c.getChild("get"+b)&&(h["get"+b]=f),null===c.getChild("get_"+d)&&(h["get_"+d]=f)}(j)}h.encode=function(a,d){"boolean"==typeof a&&(d=a,a=void 0);var e=!1;a||(a=new b,e=!0);var f=a.littleEndian;try{return c.encode(this,a.LE(),d),(e?a.flip():a).LE(f)}catch(g){throw a.LE(f),g}},g.encode=function(a,b,c){return new g(a).encode(b,c)},h.calculate=function(){return c.calculate(this)},h.encodeDelimited=function(a){var d=!1;a||(a=new b,d=!0);var e=(new b).LE();return c.encode(this,e).flip(),a.writeVarint32(e.remaining()),a.append(e),d?a.flip():a},h.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toArrayBuffer()),a}},h.toArrayBuffer=h.encodeAB,h.encodeNB=function(){try{return this.encode().toBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBuffer()),a}},h.toBuffer=h.encodeNB,h.encode64=function(){try{return this.encode().toBase64()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBase64()),a}},h.toBase64=h.encode64,h.encodeHex=function(){try{return this.encode().toHex()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toHex()),a}},h.toHex=h.encodeHex,h.toRaw=function(a,b){return d(this,!!a,!!b,this.$type)},h.encodeJSON=function(){return JSON.stringify(d(this,!0,!0,this.$type))},g.decode=function(a,d){"string"==typeof a&&(a=b.wrap(a,d?d:"base64")),a=b.isByteBuffer(a)?a:b.wrap(a);var e=a.littleEndian;try{var f=c.decode(a.LE());return a.LE(e),f}catch(g){throw a.LE(e),g}},g.decodeDelimited=function(a,d){if("string"==typeof a&&(a=b.wrap(a,d?d:"base64")),a=b.isByteBuffer(a)?a:b.wrap(a),a.remaining()<1)return null;var e=a.offset,f=a.readVarint32();if(a.remaining()<f)return a.offset=e,null;try{var g=c.decode(a.slice(a.offset,a.offset+f).LE());return a.offset+=f,g}catch(h){throw a.offset+=f,h}},g.decode64=function(a){return g.decode(a,"base64")},g.decodeHex=function(a){return g.decode(a,"hex")},g.decodeJSON=function(a){return new g(JSON.parse(a))},h.toString=function(){return c.toString()};return Object.defineProperty&&(Object.defineProperty(g,"$options",{value:c.buildOpt()}),Object.defineProperty(h,"$options",{value:g.$options}),Object.defineProperty(g,"$type",{value:c}),Object.defineProperty(h,"$type",{value:c})),g}(a,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var e,f=0,g=this.children.length;f<g;f++)if(e=this.children[f],e instanceof s||e instanceof m||e instanceof w){if(d.hasOwnProperty(e.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+e.toString(!0)+" cannot override static property '"+e.name+"'");d[e.name]=e.build()}else if(e instanceof m.Field)e.build(),this._fields.push(e),this._fieldsById[e.id]=e,this._fieldsByName[e.name]=e;else if(!(e instanceof m.OneOf||e instanceof v))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[f].toString(!0));return this.clazz=d},n.encode=function(a,b,c){for(var d,e,f=null,g=0,h=this._fields.length;g<h;++g)d=this._fields[g],e=a[d.name],d.required&&null===e?null===f&&(f=d):d.encode(c?e:d.verifyValue(e),b,a);if(null!==f){var i=Error("Missing at least one required field for "+this.toString(!0)+": "+f);
throw i.encoded=b,i}return b},n.calculate=function(a){for(var b,c,d=0,e=0,f=this._fields.length;e<f;++e){if(b=this._fields[e],c=a[b.name],b.required&&null===c)throw Error("Missing at least one required field for "+this.toString(!0)+": "+b);d+=b.calculate(c,a)}return d},n.decode=function(b,c,d){c="number"==typeof c?c:-1;for(var f,g,h,i,j=b.offset,k=new this.clazz;b.offset<j+c||c===-1&&b.remaining()>0;){if(f=b.readVarint32(),g=7&f,h=f>>>3,g===a.WIRE_TYPES.ENDGROUP){if(h!==d)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+h+" ("+(d?d+" expected":"not a group")+")");break}if(i=this._fieldsById[h]){if(i.repeated&&!i.options.packed)k[i.name].push(i.decode(g,b));else if(i.map){var l=i.decode(g,b);k[i.name].set(l[0],l[1])}else if(k[i.name]=i.decode(g,b),i.oneof){var m=k[i.oneof.name];null!==m&&m!==i.name&&(k[m]=null),k[i.oneof.name]=i.name}}else switch(g){case a.WIRE_TYPES.VARINT:b.readVarint32();break;case a.WIRE_TYPES.BITS32:b.offset+=4;break;case a.WIRE_TYPES.BITS64:b.offset+=8;break;case a.WIRE_TYPES.LDELIM:var n=b.readVarint32();b.offset+=n;break;case a.WIRE_TYPES.STARTGROUP:for(;e(h,b););break;default:throw Error("Illegal wire type for unknown field "+h+" in "+this.toString(!0)+"#decode: "+g)}}for(var o=0,p=this._fields.length;o<p;++o)if(i=this._fields[o],null===k[i.name])if("proto3"===this.syntax)k[i.name]=i.defaultValue;else{if(i.required){var q=Error("Missing at least one required field for "+this.toString(!0)+": "+i.name);throw q.decoded=k,q}a.populateDefaults&&null!==i.defaultValue&&(k[i.name]=i.defaultValue)}return k},f.Message=m;var o=function(b,c,d,e,f,h,i,j,k,l){g.call(this,b,c,h),this.className="Message.Field",this.required="required"===d,this.repeated="repeated"===d,this.map="map"===d,this.keyType=e||null,this.type=f,this.resolvedType=null,this.id=i,this.options=j||{},this.defaultValue=null,this.oneof=k||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof m.ExtensionField||(this.name=a.Util.toCamelCase(this.name))},p=o.prototype=Object.create(g.prototype);p.build=function(){this.element=new k(this.type,this.resolvedType,(!1),this.syntax),this.map&&(this.keyElement=new k(this.keyType,(void 0),(!0),this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?"undefined"!=typeof this.options["default"]&&(this.defaultValue=this.verifyValue(this.options["default"])):this.defaultValue=k.defaultFieldValue(this.type)},p.verifyValue=function(b,c){c=c||!1;var d=function(a,b){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+a+" ("+b+")")}.bind(this);if(null===b)return this.required&&d(typeof b,"required"),"proto3"===this.syntax&&this.type!==a.TYPES.message&&d(typeof b,"proto3 field without field presence cannot be null"),null;var e;if(this.repeated&&!c){Array.isArray(b)||(b=[b]);var f=[];for(e=0;e<b.length;e++)f.push(this.element.verifyValue(b[e]));return f}return this.map&&!c?b instanceof a.Map?b:(b instanceof Object||d(typeof b,"expected ProtoBuf.Map or raw object for map field"),new a.Map(this,b)):(!this.repeated&&Array.isArray(b)&&d(typeof b,"no array expected"),this.element.verifyValue(b))},p.hasWirePresence=function(b,c){if("proto3"!==this.syntax)return null!==b;if(this.oneof&&c[this.oneof.name]===this.name)return!0;switch(this.type){case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:case a.TYPES.uint32:case a.TYPES.fixed32:return 0!==b;case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:case a.TYPES.uint64:case a.TYPES.fixed64:return 0!==b.low||0!==b.high;case a.TYPES.bool:return b;case a.TYPES["float"]:case a.TYPES["double"]:return 0!==b;case a.TYPES.string:return b.length>0;case a.TYPES.bytes:return b.remaining()>0;case a.TYPES["enum"]:return 0!==b;case a.TYPES.message:return null!==b;default:return!0}},p.encode=function(c,d,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return d;try{if(this.repeated){var f;if(this.options.packed&&a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){d.writeVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),d.ensureCapacity(d.offset+=1);var g=d.offset;for(f=0;f<c.length;f++)this.element.encodeValue(this.id,c[f],d);var h=d.offset-g,i=b.calculateVarint32(h);if(i>1){var j=d.slice(g,d.offset);g+=i-1,d.offset=g,d.append(j)}d.writeVarint32(h,g-i)}else for(f=0;f<c.length;f++)d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c[f],d)}else this.map?c.forEach(function(c,e,f){var g=b.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,e)+b.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);d.writeVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),d.writeVarint32(g),d.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,e,d),d.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,c,d)},this):this.hasWirePresence(c,e)&&(d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c,d))}catch(k){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+k+")")}return d},p.calculate=function(c,d){if(c=this.verifyValue(c),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return 0;var e=0;try{if(this.repeated){var f,g;if(this.options.packed&&a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(e+=b.calculateVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),g=0,f=0;f<c.length;f++)g+=this.element.calculateLength(this.id,c[f]);e+=b.calculateVarint32(g),e+=g}else for(f=0;f<c.length;f++)e+=b.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c[f])}else this.map?c.forEach(function(c,d,f){var g=b.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,d)+b.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);e+=b.calculateVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),e+=b.calculateVarint32(g),e+=g},this):this.hasWirePresence(c,d)&&(e+=b.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c))}catch(h){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+h+")")}return e},p.decode=function(b,c,d){var e,f,g=!this.map&&b==this.type.wireType||!d&&this.repeated&&this.options.packed&&b==a.WIRE_TYPES.LDELIM||this.map&&b==a.WIRE_TYPES.LDELIM;if(!g)throw Error("Illegal wire type for field "+this.toString(!0)+": "+b+" ("+this.type.wireType+" expected)");if(b==a.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!d){f=c.readVarint32(),f=c.offset+f;for(var h=[];c.offset<f;)h.push(this.decode(this.type.wireType,c,!0));return h}if(this.map){var i=k.defaultFieldValue(this.keyType);if(e=k.defaultFieldValue(this.type),f=c.readVarint32(),c.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+c.remaining());var j=c.clone();for(j.limit=j.offset+f,c.offset+=f;j.remaining()>0;){var l=j.readVarint32();b=7&l;var m=l>>>3;if(1===m)i=this.keyElement.decode(j,b,m);else{if(2!==m)throw Error("Unexpected tag in map field key/value submessage");e=this.element.decode(j,b,m)}}return[i,e]}return this.element.decode(c,b,this.id)},f.Message.Field=o;var q=function(a,b,c,d,e,f,g){o.call(this,a,b,c,null,d,e,f,g),this.extension};q.prototype=Object.create(o.prototype),f.Message.ExtensionField=q;var r=function(a,b,c){g.call(this,a,b,c),this.fields=[]};f.Message.OneOf=r;var s=function(a,b,c,d,e){i.call(this,a,b,c,d,e),this.className="Enum",this.object=null};s.getName=function(a,b){for(var c,d=Object.keys(a),e=0;e<d.length;++e)if(a[c=d[e]]===b)return c;return null};var t=s.prototype=Object.create(i.prototype);t.build=function(b){if(this.object&&!b)return this.object;for(var c=new a.Builder.Enum,d=this.getChildren(s.Value),e=0,f=d.length;e<f;++e)c[d[e].name]=d[e].id;return Object.defineProperty&&Object.defineProperty(c,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=c},f.Enum=s;var u=function(a,b,c,d){g.call(this,a,b,c),this.className="Enum.Value",this.id=d};u.prototype=Object.create(g.prototype),f.Enum.Value=u;var v=function(a,b,c,d){g.call(this,a,b,c),this.field=d};v.prototype=Object.create(g.prototype),f.Extension=v;var w=function(a,b,c,d){i.call(this,a,b,c,d),this.className="Service",this.clazz=null},x=w.prototype=Object.create(i.prototype);x.build=function(c){return this.clazz&&!c?this.clazz:this.clazz=function(a,c){for(var d=function(b){a.Builder.Service.call(this),this.rpcImpl=b||function(a,b,c){setTimeout(c.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=d.prototype=Object.create(a.Builder.Service.prototype),f=c.getChildren(a.Reflect.Service.RPCMethod),g=0;g<f.length;g++)!function(a){e[a.name]=function(d,e){try{try{d=a.resolvedRequestType.clazz.decode(b.wrap(d))}catch(f){if(!(f instanceof TypeError))throw f}if(null===d||"object"!=typeof d)throw Error("Illegal arguments");d instanceof a.resolvedRequestType.clazz||(d=new a.resolvedRequestType.clazz(d)),this.rpcImpl(a.fqn(),d,function(b,d){if(b)return void e(b);try{d=a.resolvedResponseType.clazz.decode(d)}catch(f){}return d&&d instanceof a.resolvedResponseType.clazz?void e(null,d):void e(Error("Illegal response type received in service method "+c.name+"#"+a.name))})}catch(f){setTimeout(e.bind(this,f),0)}},d[a.name]=function(b,c,e){new d(b)[a.name](c,e)},Object.defineProperty&&(Object.defineProperty(d[a.name],"$options",{value:a.buildOpt()}),Object.defineProperty(e[a.name],"$options",{value:d[a.name].$options}))}(f[g]);return Object.defineProperty&&(Object.defineProperty(d,"$options",{value:c.buildOpt()}),Object.defineProperty(e,"$options",{value:d.$options}),Object.defineProperty(d,"$type",{value:c}),Object.defineProperty(e,"$type",{value:c})),d}(a,this)},f.Service=w;var y=function(a,b,c,d){g.call(this,a,b,c),this.className="Service.Method",this.options=d||{}},z=y.prototype=Object.create(g.prototype);z.buildOpt=j.buildOpt,f.Service.Method=y;var A=function(a,b,c,d,e,f,g,h){y.call(this,a,b,c,h),this.className="Service.RPCMethod",this.requestName=d,this.responseName=e,this.requestStream=f,this.responseStream=g,this.resolvedRequestType=null,this.resolvedResponseType=null};return A.prototype=Object.create(y.prototype),f.Service.RPCMethod=A,f}(e),e.Builder=function(a,b,d){function e(a){a.messages&&a.messages.forEach(function(b){b.syntax=a.syntax,e(b)}),a.enums&&a.enums.forEach(function(b){b.syntax=a.syntax})}var f=function(a){this.ns=new d.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=a||{}},g=f.prototype;return f.isMessage=function(a){return"string"==typeof a.name&&("undefined"==typeof a.values&&"undefined"==typeof a.rpc)},f.isMessageField=function(a){return"string"==typeof a.rule&&"string"==typeof a.name&&"string"==typeof a.type&&"undefined"!=typeof a.id},f.isEnum=function(a){return"string"==typeof a.name&&!("undefined"==typeof a.values||!Array.isArray(a.values)||0===a.values.length)},f.isService=function(a){return!("string"!=typeof a.name||"object"!=typeof a.rpc||!a.rpc)},f.isExtend=function(a){return"string"==typeof a.ref},g.reset=function(){return this.ptr=this.ns,this},g.define=function(a){if("string"!=typeof a||!b.TYPEREF.test(a))throw Error("illegal namespace: "+a);return a.split(".").forEach(function(a){var b=this.ptr.getChild(a);null===b&&this.ptr.addChild(b=new d.Namespace(this,this.ptr,a)),this.ptr=b},this),this},g.create=function(b){if(!b)return this;if(Array.isArray(b)){if(0===b.length)return this;b=b.slice()}else b=[b];for(var c=[b];c.length>0;){if(b=c.pop(),!Array.isArray(b))throw Error("not a valid namespace: "+JSON.stringify(b));for(;b.length>0;){var e=b.shift();if(f.isMessage(e)){var g=new d.Message(this,this.ptr,e.name,e.options,e.isGroup,e.syntax),h={};e.oneofs&&Object.keys(e.oneofs).forEach(function(a){g.addChild(h[a]=new d.Message.OneOf(this,g,a))},this),e.fields&&e.fields.forEach(function(a){if(null!==g.getChild(0|a.id))throw Error("duplicate or invalid field id in "+g.name+": "+a.id);if(a.options&&"object"!=typeof a.options)throw Error("illegal field options in "+g.name+"#"+a.name);var b=null;if("string"==typeof a.oneof&&!(b=h[a.oneof]))throw Error("illegal oneof in "+g.name+"#"+a.name+": "+a.oneof);a=new d.Message.Field(this,g,a.rule,a.keytype,a.type,a.name,a.id,a.options,b,e.syntax),b&&b.fields.push(a),g.addChild(a)},this);var i=[];if(e.enums&&e.enums.forEach(function(a){i.push(a)}),e.messages&&e.messages.forEach(function(a){i.push(a)}),e.services&&e.services.forEach(function(a){i.push(a)}),e.extensions&&(g.extensions=e.extensions,g.extensions[0]<a.ID_MIN&&(g.extensions[0]=a.ID_MIN),g.extensions[1]>a.ID_MAX&&(g.extensions[1]=a.ID_MAX)),this.ptr.addChild(g),i.length>0){c.push(b),b=i,i=null,this.ptr=g,g=null;continue}i=null}else if(f.isEnum(e))g=new d.Enum(this,this.ptr,e.name,e.options,e.syntax),e.values.forEach(function(a){g.addChild(new d.Enum.Value(this,g,a.name,a.id))},this),this.ptr.addChild(g);else if(f.isService(e))g=new d.Service(this,this.ptr,e.name,e.options),Object.keys(e.rpc).forEach(function(a){var b=e.rpc[a];g.addChild(new d.Service.RPCMethod(this,g,a,b.request,b.response,(!!b.request_stream),(!!b.response_stream),b.options))},this),this.ptr.addChild(g);else{if(!f.isExtend(e))throw Error("not a valid definition: "+JSON.stringify(e));if(g=this.ptr.resolve(e.ref,!0))e.fields.forEach(function(b){if(null!==g.getChild(0|b.id))throw Error("duplicate extended field id in "+g.name+": "+b.id);if(b.id<g.extensions[0]||b.id>g.extensions[1])throw Error("illegal extended field id in "+g.name+": "+b.id+" ("+g.extensions.join(" to ")+" expected)");var c=b.name;this.options.convertFieldsToCamelCase&&(c=a.Util.toCamelCase(c));var e=new d.Message.ExtensionField(this,g,b.rule,b.type,this.ptr.fqn()+"."+c,b.id,b.options),f=new d.Extension(this,this.ptr,b.name,e);e.extension=f,this.ptr.addChild(f),g.addChild(e)},this);else if(!/\.?google\.protobuf\./.test(e.ref))throw Error("extended message "+e.ref+" is not defined")}e=null,g=null}b=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},g["import"]=function(b,d){var f="/";if("string"==typeof d){if(a.Util.IS_NODE&&(d=c(13).resolve(d)),this.files[d]===!0)return this.reset();this.files[d]=!0}else if("object"==typeof d){var g=d.root;a.Util.IS_NODE&&(g=c(13).resolve(g)),(g.indexOf("\\")>=0||d.file.indexOf("\\")>=0)&&(f="\\");var h=g+f+d.file;if(this.files[h]===!0)return this.reset();this.files[h]=!0}if(b.imports&&b.imports.length>0){var i,j=!1;"object"==typeof d?(this.importRoot=d.root,j=!0,i=this.importRoot,d=d.file,(i.indexOf("\\")>=0||d.indexOf("\\")>=0)&&(f="\\")):"string"==typeof d?this.importRoot?i=this.importRoot:d.indexOf("/")>=0?(i=d.replace(/\/[^\/]*$/,""),""===i&&(i="/")):d.indexOf("\\")>=0?(i=d.replace(/\\[^\\]*$/,""),f="\\"):i=".":i=null;for(var k=0;k<b.imports.length;k++)if("string"==typeof b.imports[k]){if(!i)throw Error("cannot determine import root");var l=b.imports[k];if("google/protobuf/descriptor.proto"===l)continue;if(l=i+f+l,this.files[l]===!0)continue;/\.proto$/i.test(l)&&!a.DotProto&&(l=l.replace(/\.proto$/,".json"));var m=a.Util.fetch(l);if(null===m)throw Error("failed to import '"+l+"' in '"+d+"': file not found");/\.json$/i.test(l)?this["import"](JSON.parse(m+""),l):this["import"](a.DotProto.Parser.parse(m),l)}else d?/\.(\w+)$/.test(d)?this["import"](b.imports[k],d.replace(/^(.+)\.(\w+)$/,function(a,b,c){return b+"_import"+k+"."+c})):this["import"](b.imports[k],d+"_import"+k):this["import"](b.imports[k]);j&&(this.importRoot=null)}b["package"]&&this.define(b["package"]),b.syntax&&e(b);var n=this.ptr;return b.options&&Object.keys(b.options).forEach(function(a){n.options[a]=b.options[a]}),b.messages&&(this.create(b.messages),this.ptr=n),b.enums&&(this.create(b.enums),this.ptr=n),b.services&&(this.create(b.services),this.ptr=n),b["extends"]&&this.create(b["extends"]),this.reset()},g.resolveAll=function(){var c;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof d.Namespace)this.ptr.children.forEach(function(a){this.ptr=a,this.resolveAll()},this);else if(this.ptr instanceof d.Message.Field){if(b.TYPE.test(this.ptr.type))this.ptr.type=a.TYPES[this.ptr.type];else{if(!b.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(c=(this.ptr instanceof d.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0),!c)throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=c,c instanceof d.Enum){if(this.ptr.type=a.TYPES["enum"],"proto3"===this.ptr.syntax&&"proto3"!==c.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(c instanceof d.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=c.isGroup?a.TYPES.group:a.TYPES.message}}if(this.ptr.map){if(!b.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=a.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof a.Reflect.Service.Method){if(!(this.ptr instanceof a.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(c=this.ptr.parent.resolve(this.ptr.requestName,!0),!(c&&c instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=c,c=this.ptr.parent.resolve(this.ptr.responseName,!0),!(c&&c instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=c}else if(!(this.ptr instanceof a.Reflect.Message.OneOf||this.ptr instanceof a.Reflect.Extension||this.ptr instanceof a.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},g.build=function(a){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!a)return this.result;for(var b="string"==typeof a?a.split("."):a,c=this.result,d=0;d<b.length;d++){if(!c[b[d]]){c=null;break}c=c[b[d]]}return c},g.lookup=function(a,b){return a?this.ns.resolve(a,b):this.ns},g.toString=function(){return"Builder"},f.Message=function(){},f.Enum=function(){},f.Service=function(){},f}(e,e.Lang,e.Reflect),e.Map=function(a,b){function c(a){var b=0;return{next:function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}}var d=function(a,c){if(!a.map)throw Error("field is not a map");if(this.field=a,this.keyElem=new b.Element(a.keyType,null,(!0),a.syntax),this.valueElem=new b.Element(a.type,a.resolvedType,(!1),a.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),c)for(var d=Object.keys(c),e=0;e<d.length;e++){var f=this.keyElem.valueFromString(d[e]),g=this.valueElem.verifyValue(c[d[e]]);this.map[this.keyElem.valueToString(f)]={key:f,value:g}}},e=d.prototype;return e.clear=function(){this.map={}},e["delete"]=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a)),c=b in this.map;return delete this.map[b],c},e.entries=function(){for(var a,b=[],d=Object.keys(this.map),e=0;e<d.length;e++)b.push([(a=this.map[d[e]]).key,a.value]);return c(b)},e.keys=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].key);return c(a)},e.values=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].value);return c(a)},e.forEach=function(a,b){for(var c,d=Object.keys(this.map),e=0;e<d.length;e++)a.call(b,(c=this.map[d[e]]).value,c.key,this)},e.set=function(a,b){var c=this.keyElem.verifyValue(a),d=this.valueElem.verifyValue(b);return this.map[this.keyElem.valueToString(c)]={key:c,value:d},this},e.get=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));if(b in this.map)return this.map[b].value},e.has=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));return b in this.map},d}(e,e.Reflect),e.loadProto=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=void 0),e.loadJson(e.DotProto.Parser.parse(a),b,c)},e.protoFromString=e.loadProto,e.loadProtoFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadProto(d,c,a))}catch(f){b(f)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadProto(d,c,a)},e.protoFromFile=e.loadProtoFile,e.newBuilder=function(a){return a=a||{},"undefined"==typeof a.convertFieldsToCamelCase&&(a.convertFieldsToCamelCase=e.convertFieldsToCamelCase),"undefined"==typeof a.populateAccessors&&(a.populateAccessors=e.populateAccessors),new e.Builder(a)},e.loadJson=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=null),b&&"object"==typeof b||(b=e.newBuilder()),"string"==typeof a&&(a=JSON.parse(a)),b["import"](a,c),b.resolveAll(),b},e.loadJsonFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadJson(JSON.parse(d),c,a))}catch(f){b(f)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadJson(JSON.parse(d),c,a)},e})}).call(b,c(7),c(8)(a))},function(a,b){function c(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function e(a){if(k===setTimeout)return setTimeout(a,0);if((k===c||!k)&&setTimeout)return k=setTimeout,setTimeout(a,0);try{return k(a,0)}catch(b){try{return k.call(null,a,0)}catch(b){return k.call(this,a,0)}}}function f(a){if(l===clearTimeout)return clearTimeout(a);if((l===d||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(a);try{return l(a)}catch(b){try{return l.call(null,a)}catch(b){return l.call(this,a)}}}function g(){p&&n&&(p=!1,n.length?o=n.concat(o):q=-1,o.length&&h())}function h(){if(!p){var a=e(g);p=!0;for(var b=o.length;b;){for(n=o,o=[];++q<b;)n&&n[q].run();q=-1,b=o.length}n=null,p=!1,f(a)}}function i(a,b){this.fun=a,this.array=b}function j(){}var k,l,m=a.exports={};!function(){try{k="function"==typeof setTimeout?setTimeout:c}catch(a){k=c}try{l="function"==typeof clearTimeout?clearTimeout:d}catch(a){l=d}}();var n,o=[],p=!1,q=-1;m.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];o.push(new i(a,b)),1!==o.length||p||e(h)},i.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=j,m.addListener=j,m.once=j,m.off=j,m.removeListener=j,m.removeAllListeners=j,m.emit=j,m.binding=function(a){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(a){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},function(a,b){a.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children=[],a.webpackPolyfill=1),a}},function(a,b){a.exports=function(){throw new Error("define cannot be used indirect")}},function(a,b,c){var d,e;(function(a){!function(f){"use strict";function g(a){function b(a){var b=0;return function(){return b<a.length?a.charCodeAt(b++):null}}function c(){var a=[],b=[];return function(){return 0===arguments.length?b.join("")+g.apply(String,a):(a.length+arguments.length>1024&&(b.push(g.apply(String,a)),a.length=0),void Array.prototype.push.apply(a,arguments))}}var d=function(a,b,c){if("undefined"==typeof a&&(a=d.DEFAULT_CAPACITY),"undefined"==typeof b&&(b=d.DEFAULT_ENDIAN),"undefined"==typeof c&&(c=d.DEFAULT_NOASSERT),!c){if(a=0|a,a<0)throw RangeError("Illegal capacity");b=!!b,c=!!c}this.buffer=0===a?f:new ArrayBuffer(a),this.view=0===a?null:new DataView(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=a,this.littleEndian="undefined"!=typeof b&&!!b,this.noAssert=!!c};d.VERSION="3.5.5",d.LITTLE_ENDIAN=!0,d.BIG_ENDIAN=!1,d.DEFAULT_CAPACITY=16,d.DEFAULT_ENDIAN=d.BIG_ENDIAN,d.DEFAULT_NOASSERT=!1,d.Long=a||null;var e=d.prototype,f=new ArrayBuffer(0),g=String.fromCharCode;d.allocate=function(a,b,c){return new d(a,b,c)},d.concat=function(a,b,c,e){"boolean"!=typeof b&&"string"==typeof b||(e=c,c=b,b=void 0);for(var f,g=0,h=0,i=a.length;h<i;++h)d.isByteBuffer(a[h])||(a[h]=d.wrap(a[h],b)),f=a[h].limit-a[h].offset,f>0&&(g+=f);if(0===g)return new d(0,c,e);var j,k=new d(g,c,e),l=new Uint8Array(k.buffer);for(h=0;h<i;)j=a[h++],f=j.limit-j.offset,f<=0||(l.set(new Uint8Array(j.buffer).subarray(j.offset,j.limit),k.offset),k.offset+=f);return k.limit=k.offset,k.offset=0,k},d.isByteBuffer=function(a){return(a&&a instanceof d)===!0},d.type=function(){return ArrayBuffer},d.wrap=function(a,b,c,f){if("string"!=typeof b&&(f=c,c=b,b=void 0),"string"==typeof a)switch("undefined"==typeof b&&(b="utf8"),b){case"base64":return d.fromBase64(a,c);case"hex":return d.fromHex(a,c);case"binary":return d.fromBinary(a,c);case"utf8":return d.fromUTF8(a,c);case"debug":return d.fromDebug(a,c);default:throw Error("Unsupported encoding: "+b)}if(null===a||"object"!=typeof a)throw TypeError("Illegal buffer");var g;if(d.isByteBuffer(a))return g=e.clone.call(a),g.markedOffset=-1,g;if(a instanceof Uint8Array)g=new d(0,c,f),a.length>0&&(g.buffer=a.buffer,g.offset=a.byteOffset,g.limit=a.byteOffset+a.length,g.view=a.length>0?new DataView(a.buffer):null);else if(a instanceof ArrayBuffer)g=new d(0,c,f),a.byteLength>0&&(g.buffer=a,g.offset=0,g.limit=a.byteLength,g.view=a.byteLength>0?new DataView(a):null);else{if("[object Array]"!==Object.prototype.toString.call(a))throw TypeError("Illegal buffer");for(g=new d(a.length,c,f),g.limit=a.length,i=0;i<a.length;++i)g.view.setUint8(i,a[i])}return g},e.writeInt8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view.setInt8(b,a),c&&(this.offset+=1),this},e.writeByte=e.writeInt8,e.readInt8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view.getInt8(a);return b&&(this.offset+=1),c},e.readByte=e.readInt8,e.writeUint8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view.setUint8(b,a),c&&(this.offset+=1),this},e.readUint8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view.getUint8(a);return b&&(this.offset+=1),c},e.writeInt16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.view.setInt16(b,a,this.littleEndian),c&&(this.offset+=2),this},e.writeShort=e.writeInt16,e.readInt16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=this.view.getInt16(a,this.littleEndian);return b&&(this.offset+=2),c},e.readShort=e.readInt16,e.writeUint16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.view.setUint16(b,a,this.littleEndian),c&&(this.offset+=2),this},e.readUint16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=this.view.getUint16(a,this.littleEndian);return b&&(this.offset+=2),c},e.writeInt32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.view.setInt32(b,a,this.littleEndian),c&&(this.offset+=4),this},e.writeInt=e.writeInt32,e.readInt32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=this.view.getInt32(a,this.littleEndian);return b&&(this.offset+=4),c},e.readInt=e.readInt32,e.writeUint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.view.setUint32(b,a,this.littleEndian),c&&(this.offset+=4),this},e.readUint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=this.view.getUint32(a,this.littleEndian);return b&&(this.offset+=4),c},a&&(e.writeInt64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");
if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;return c>e&&this.resize((e*=2)>c?e:c),c-=8,this.littleEndian?(this.view.setInt32(c,b.low,!0),this.view.setInt32(c+4,b.high,!0)):(this.view.setInt32(c,b.high,!1),this.view.setInt32(c+4,b.low,!1)),d&&(this.offset+=8),this},e.writeLong=e.writeInt64,e.readInt64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=this.littleEndian?new a(this.view.getInt32(b,!0),this.view.getInt32(b+4,!0),(!1)):new a(this.view.getInt32(b+4,!1),this.view.getInt32(b,!1),(!1));return c&&(this.offset+=8),d},e.readLong=e.readInt64,e.writeUint64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;return c>e&&this.resize((e*=2)>c?e:c),c-=8,this.littleEndian?(this.view.setInt32(c,b.low,!0),this.view.setInt32(c+4,b.high,!0)):(this.view.setInt32(c,b.high,!1),this.view.setInt32(c+4,b.low,!1)),d&&(this.offset+=8),this},e.readUint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=this.littleEndian?new a(this.view.getInt32(b,!0),this.view.getInt32(b+4,!0),(!0)):new a(this.view.getInt32(b+4,!1),this.view.getInt32(b,!1),(!0));return c&&(this.offset+=8),d}),e.writeFloat32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.view.setFloat32(b,a,this.littleEndian),c&&(this.offset+=4),this},e.writeFloat=e.writeFloat32,e.readFloat32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=this.view.getFloat32(a,this.littleEndian);return b&&(this.offset+=4),c},e.readFloat=e.readFloat32,e.writeFloat64=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=8;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=8,this.view.setFloat64(b,a,this.littleEndian),c&&(this.offset+=8),this},e.writeDouble=e.writeFloat64,e.readFloat64=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength)}var c=this.view.getFloat64(a,this.littleEndian);return b&&(this.offset+=8),c},e.readDouble=e.readFloat64,d.MAX_VARINT32_BYTES=5,d.calculateVarint32=function(a){return a>>>=0,a<128?1:a<16384?2:a<1<<21?3:a<1<<28?4:5},d.zigZagEncode32=function(a){return((a|=0)<<1^a>>31)>>>0},d.zigZagDecode32=function(a){return a>>>1^-(1&a)|0},e.writeVarint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var e,f=d.calculateVarint32(a);b+=f;var g=this.buffer.byteLength;return b>g&&this.resize((g*=2)>b?g:b),b-=f,this.view.setUint8(b,e=128|a),a>>>=0,a>=128?(e=a>>7|128,this.view.setUint8(b+1,e),a>=16384?(e=a>>14|128,this.view.setUint8(b+2,e),a>=1<<21?(e=a>>21|128,this.view.setUint8(b+3,e),a>=1<<28?(this.view.setUint8(b+4,a>>28&15),f=5):(this.view.setUint8(b+3,127&e),f=4)):(this.view.setUint8(b+2,127&e),f=3)):(this.view.setUint8(b+1,127&e),f=2)):(this.view.setUint8(b,127&e),f=1),c?(this.offset+=f,this):f},e.writeVarint32ZigZag=function(a,b){return this.writeVarint32(d.zigZagEncode32(a),b)},e.readVarint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c,d,e=0,f=0;do{if(d=a+e,!this.noAssert&&d>this.limit){var g=Error("Truncated");throw g.truncated=!0,g}c=this.view.getUint8(d),e<5&&(f|=(127&c)<<7*e>>>0),++e}while(128===(128&c));return f=0|f,b?(this.offset+=e,f):{value:f,length:e}},e.readVarint32ZigZag=function(a){var b=this.readVarint32(a);return"object"==typeof b?b.value=d.zigZagDecode32(b.value):b=d.zigZagDecode32(b),b},a&&(d.MAX_VARINT64_BYTES=10,d.calculateVarint64=function(b){"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b));var c=b.toInt()>>>0,d=b.shiftRightUnsigned(28).toInt()>>>0,e=b.shiftRightUnsigned(56).toInt()>>>0;return 0==e?0==d?c<16384?c<128?1:2:c<1<<21?3:4:d<16384?d<128?5:6:d<1<<21?7:8:e<128?9:10},d.zigZagEncode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftLeft(1).xor(b.shiftRight(63)).toUnsigned()},d.zigZagDecode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftRightUnsigned(1).xor(b.and(a.ONE).toSigned().negate()).toSigned()},e.writeVarint64=function(b,c){var e="undefined"==typeof c;if(e&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned());var f=d.calculateVarint64(b),g=b.toInt()>>>0,h=b.shiftRightUnsigned(28).toInt()>>>0,i=b.shiftRightUnsigned(56).toInt()>>>0;c+=f;var j=this.buffer.byteLength;switch(c>j&&this.resize((j*=2)>c?j:c),c-=f,f){case 10:this.view.setUint8(c+9,i>>>7&1);case 9:this.view.setUint8(c+8,9!==f?128|i:127&i);case 8:this.view.setUint8(c+7,8!==f?h>>>21|128:h>>>21&127);case 7:this.view.setUint8(c+6,7!==f?h>>>14|128:h>>>14&127);case 6:this.view.setUint8(c+5,6!==f?h>>>7|128:h>>>7&127);case 5:this.view.setUint8(c+4,5!==f?128|h:127&h);case 4:this.view.setUint8(c+3,4!==f?g>>>21|128:g>>>21&127);case 3:this.view.setUint8(c+2,3!==f?g>>>14|128:g>>>14&127);case 2:this.view.setUint8(c+1,2!==f?g>>>7|128:g>>>7&127);case 1:this.view.setUint8(c,1!==f?128|g:127&g)}return e?(this.offset+=f,this):f},e.writeVarint64ZigZag=function(a,b){return this.writeVarint64(d.zigZagEncode64(a),b)},e.readVarint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+1) <= "+this.buffer.byteLength)}var d=b,e=0,f=0,g=0,h=0;if(h=this.view.getUint8(b++),e=127&h,128&h&&(h=this.view.getUint8(b++),e|=(127&h)<<7,128&h&&(h=this.view.getUint8(b++),e|=(127&h)<<14,128&h&&(h=this.view.getUint8(b++),e|=(127&h)<<21,128&h&&(h=this.view.getUint8(b++),f=127&h,128&h&&(h=this.view.getUint8(b++),f|=(127&h)<<7,128&h&&(h=this.view.getUint8(b++),f|=(127&h)<<14,128&h&&(h=this.view.getUint8(b++),f|=(127&h)<<21,128&h&&(h=this.view.getUint8(b++),g=127&h,128&h&&(h=this.view.getUint8(b++),g|=(127&h)<<7,128&h))))))))))throw Error("Buffer overrun");var i=a.fromBits(e|f<<28,f>>>4|g<<24,!1);return c?(this.offset=b,i):{value:i,length:b-d}},e.readVarint64ZigZag=function(b){var c=this.readVarint64(b);return c&&c.value instanceof a?c.value=d.zigZagDecode64(c.value):c=d.zigZagDecode64(c),c}),e.writeCString=function(a,c){var d="undefined"==typeof c;d&&(c=this.offset);var e,f=a.length;if(!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");for(e=0;e<f;++e)if(0===a.charCodeAt(e))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}f=j.calculateUTF16asUTF8(b(a))[1],c+=f+1;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=f+1,j.encodeUTF16toUTF8(b(a),function(a){this.view.setUint8(c++,a)}.bind(this)),this.view.setUint8(c++,0),d?(this.offset=c,this):f},e.readCString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var d,e=a,f=-1;return j.decodeUTF8toUTF16(function(){if(0===f)return null;if(a>=this.limit)throw RangeError("Illegal range: Truncated data, "+a+" < "+this.limit);return 0===(f=this.view.getUint8(a++))?null:f}.bind(this),d=c(),!0),b?(this.offset=a,d()):{string:d(),length:a-e}},e.writeIString=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=j.calculateUTF16asUTF8(b(a),this.noAssert)[1],c+=4+e;var g=this.buffer.byteLength;if(c>g&&this.resize((g*=2)>c?g:c),c-=4+e,this.view.setUint32(c,e,this.littleEndian),c+=4,j.encodeUTF16toUTF8(b(a),function(a){this.view.setUint8(c++,a)}.bind(this)),c!==f+4+e)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+4+e));return d?(this.offset=c,this):c-f},e.readIString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var d,e=0,f=a;e=this.view.getUint32(a,this.littleEndian),a+=4;var g,h=a+e;return j.decodeUTF8toUTF16(function(){return a<h?this.view.getUint8(a++):null}.bind(this),g=c(),this.noAssert),d=g(),b?(this.offset=a,d):{string:d,length:a-f}},d.METRICS_CHARS="c",d.METRICS_BYTES="b",e.writeUTF8String=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=j.calculateUTF16asUTF8(b(a))[1],c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,j.encodeUTF16toUTF8(b(a),function(a){this.view.setUint8(c++,a)}.bind(this)),d?(this.offset=c,this):c-f},e.writeString=e.writeUTF8String,d.calculateUTF8Chars=function(a){return j.calculateUTF16asUTF8(b(a))[0]},d.calculateUTF8Bytes=function(a){return j.calculateUTF16asUTF8(b(a))[1]},e.readUTF8String=function(a,b,e){"number"==typeof b&&(e=b,b=void 0);var f="undefined"==typeof e;if(f&&(e=this.offset),"undefined"==typeof b&&(b=d.METRICS_CHARS),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");if(a|=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,e<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var g,h=0,i=e;if(b===d.METRICS_CHARS){if(g=c(),j.decodeUTF8(function(){return h<a&&e<this.limit?this.view.getUint8(e++):null}.bind(this),function(a){++h,j.UTF8toUTF16(a,g)}.bind(this)),h!==a)throw RangeError("Illegal range: Truncated data, "+h+" == "+a);return f?(this.offset=e,g()):{string:g(),length:e-i}}if(b===d.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,e<0||e+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+"+a+") <= "+this.buffer.byteLength)}var k=e+a;if(j.decodeUTF8toUTF16(function(){return e<k?this.view.getUint8(e++):null}.bind(this),g=c(),this.noAssert),e!==k)throw RangeError("Illegal range: Truncated data, "+e+" == "+k);return f?(this.offset=e,g()):{string:g(),length:e-i}}throw TypeError("Unsupported metrics: "+b)},e.readString=e.readUTF8String,e.writeVString=function(a,c){var e="undefined"==typeof c;if(e&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var f,g,h=c;f=j.calculateUTF16asUTF8(b(a),this.noAssert)[1],g=d.calculateVarint32(f),c+=g+f;var i=this.buffer.byteLength;if(c>i&&this.resize((i*=2)>c?i:c),c-=g+f,c+=this.writeVarint32(f,c),j.encodeUTF16toUTF8(b(a),function(a){this.view.setUint8(c++,a)}.bind(this)),c!==h+f+g)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+f+g));return e?(this.offset=c,this):c-h},e.readVString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var d,e=this.readVarint32(a),f=a;a+=e.length,e=e.value;var g=a+e,h=c();return j.decodeUTF8toUTF16(function(){return a<g?this.view.getUint8(a++):null}.bind(this),h,this.noAssert),d=h(),b?(this.offset=a,d):{string:d,length:a-f}},e.append=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var e="undefined"==typeof c;if(e&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof d||(a=d.wrap(a,b));var f=a.limit-a.offset;if(f<=0)return this;c+=f;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=f,new Uint8Array(this.buffer,c).set(new Uint8Array(a.buffer).subarray(a.offset,a.limit)),a.offset+=f,e&&(this.offset+=f),this},e.appendTo=function(a,b){return a.append(this,b),this},e.assert=function(a){return this.noAssert=!a,this},e.capacity=function(){return this.buffer.byteLength},e.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},e.clone=function(a){var b=new d(0,this.littleEndian,this.noAssert);if(a){var c=new ArrayBuffer(this.buffer.byteLength);new Uint8Array(c).set(this.buffer),b.buffer=c,b.view=new DataView(c)}else b.buffer=this.buffer,b.view=this.view;return b.offset=this.offset,b.markedOffset=this.markedOffset,b.limit=this.limit,b},e.compact=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(0===a&&b===this.buffer.byteLength)return this;var c=b-a;if(0===c)return this.buffer=f,this.view=null,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=0,this;var d=new ArrayBuffer(c);return new Uint8Array(d).set(new Uint8Array(this.buffer).subarray(a,b)),this.buffer=d,this.view=new DataView(d),this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=c,this},e.copy=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(a===b)return new d(0,this.littleEndian,this.noAssert);var c=b-a,e=new d(c,this.littleEndian,this.noAssert);return e.offset=0,e.limit=c,e.markedOffset>=0&&(e.markedOffset-=a),this.copyTo(e,0,a,b),e},e.copyTo=function(a,b,c,e){var f,g;if(!this.noAssert&&!d.isByteBuffer(a))throw TypeError("Illegal target: Not a ByteBuffer");if(b=(g="undefined"==typeof b)?a.offset:0|b,c=(f="undefined"==typeof c)?this.offset:0|c,e="undefined"==typeof e?this.limit:0|e,b<0||b>a.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+b+" <= "+a.buffer.byteLength);if(c<0||e>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+c+" <= "+this.buffer.byteLength);var h=e-c;return 0===h?a:(a.ensureCapacity(b+h),new Uint8Array(a.buffer).set(new Uint8Array(this.buffer).subarray(c,e),b),f&&(this.offset+=h),g&&(a.offset+=h),this)},e.ensureCapacity=function(a){var b=this.buffer.byteLength;return b<a?this.resize((b*=2)>a?b:a):this},e.fill=function(a,b,c){var d="undefined"==typeof b;if(d&&(b=this.offset),"string"==typeof a&&a.length>0&&(a=a.charCodeAt(0)),"undefined"==typeof b&&(b=this.offset),"undefined"==typeof c&&(c=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal begin: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal end: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(b>=c)return this;for(;b<c;)this.view.setUint8(b++,a);return d&&(this.offset=b),this},e.flip=function(){return this.limit=this.offset,this.offset=0,this},e.mark=function(a){if(a="undefined"==typeof a?this.offset:a,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=a,this},e.order=function(a){if(!this.noAssert&&"boolean"!=typeof a)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!a,this},e.LE=function(a){return this.littleEndian="undefined"==typeof a||!!a,this},e.BE=function(a){return this.littleEndian="undefined"!=typeof a&&!a,this},e.prepend=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var e="undefined"==typeof c;if(e&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof d||(a=d.wrap(a,b));var f=a.limit-a.offset;if(f<=0)return this;var g,h=f-c;if(h>0){var i=new ArrayBuffer(this.buffer.byteLength+h);g=new Uint8Array(i),g.set(new Uint8Array(this.buffer).subarray(c,this.buffer.byteLength),f),this.buffer=i,this.view=new DataView(i),this.offset+=h,this.markedOffset>=0&&(this.markedOffset+=h),this.limit+=h,c+=h}else g=new Uint8Array(this.buffer);return g.set(new Uint8Array(a.buffer).subarray(a.offset,a.limit),c-f),a.offset=a.limit,e&&(this.offset-=f),this},e.prependTo=function(a,b){return a.prepend(this,b),this},e.printDebug=function(a){"function"!=typeof a&&(a=console.log.bind(console)),a(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},e.remaining=function(){return this.limit-this.offset},e.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},e.resize=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal capacity: "+a+" (not an integer)");if(a|=0,a<0)throw RangeError("Illegal capacity: 0 <= "+a)}if(this.buffer.byteLength<a){var b=new ArrayBuffer(a);new Uint8Array(b).set(new Uint8Array(this.buffer)),this.buffer=b,this.view=new DataView(b)}return this},e.reverse=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}return a===b?this:(Array.prototype.reverse.call(new Uint8Array(this.buffer).subarray(a,b)),this.view=new DataView(this.buffer),this)},e.skip=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");a|=0}var b=this.offset+a;if(!this.noAssert&&(b<0||b>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+a+" <= "+this.buffer.byteLength);return this.offset=b,this},e.slice=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var c=this.clone();return c.offset=a,c.limit=b,c},e.toBuffer=function(a){var b=this.offset,c=this.limit;if(b>c){var d=b;b=c,c=d}if(!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal limit: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(!a&&0===b&&c===this.buffer.byteLength)return this.buffer;if(b===c)return f;var e=new ArrayBuffer(c-b);return new Uint8Array(e).set(new Uint8Array(this.buffer).subarray(b,c),0),e},e.toArrayBuffer=e.toBuffer,e.toString=function(a,b,c){if("undefined"==typeof a)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof a&&(a="utf8",b=a,c=b),a){case"utf8":return this.toUTF8(b,c);case"base64":return this.toBase64(b,c);case"hex":return this.toHex(b,c);case"binary":return this.toBinary(b,c);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+a)}};var h=function(){for(var a={},b=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],c=[],d=0,e=b.length;d<e;++d)c[b[d]]=d;return a.encode=function(a,c){for(var d,e;null!==(d=a());)c(b[d>>2&63]),e=(3&d)<<4,null!==(d=a())?(e|=d>>4&15,c(b[63&(e|d>>4&15)]),e=(15&d)<<2,null!==(d=a())?(c(b[63&(e|d>>6&3)]),c(b[63&d])):(c(b[63&e]),c(61))):(c(b[63&e]),c(61),c(61))},a.decode=function(a,b){function d(a){throw Error("Illegal character code: "+a)}for(var e,f,g;null!==(e=a());)if(f=c[e],"undefined"==typeof f&&d(e),null!==(e=a())&&(g=c[e],"undefined"==typeof g&&d(e),b(f<<2>>>0|(48&g)>>4),null!==(e=a()))){if(f=c[e],"undefined"==typeof f){if(61===e)break;d(e)}if(b((15&g)<<4>>>0|(60&f)>>2),null!==(e=a())){if(g=c[e],"undefined"==typeof g){if(61===e)break;d(e)}b((3&f)<<6>>>0|g)}}},a.test=function(a){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(a)},a}();e.toBase64=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var d;return h.encode(function(){return a<b?this.view.getUint8(a++):null}.bind(this),d=c()),d()},d.fromBase64=function(a,c,e){if(!e){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if(a.length%4!==0)throw TypeError("Illegal str: Length not a multiple of 4")}var f=new d(a.length/4*3,c,e),g=0;return h.decode(b(a),function(a){f.view.setUint8(g++,a)}),f.limit=g,f},d.btoa=function(a){return d.fromBinary(a).toBase64()},d.atob=function(a){return d.fromBase64(a).toBinary()},e.toBinary=function(a,b){if(a="undefined"==typeof a?this.offset:a,b="undefined"==typeof b?this.limit:b,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(a===b)return"";for(var c=[],d=[];a<b;)c.push(this.view.getUint8(a++)),c.length>=1024&&(d.push(String.fromCharCode.apply(String,c)),c=[]);return d.join("")+String.fromCharCode.apply(String,c)},d.fromBinary=function(a,b,c){if(!c&&"string"!=typeof a)throw TypeError("Illegal str: Not a string");for(var e,f=0,g=a.length,h=new d(g,b,c);f<g;){if(e=a.charCodeAt(f),!c&&e>255)throw RangeError("Illegal charCode at "+f+": 0 <= "+e+" <= 255");h.view.setUint8(f++,e)}return h.limit=g,h},e.toDebug=function(a){for(var b,c=-1,d=this.buffer.byteLength,e="",f="",g="";c<d;){if(c!==-1&&(b=this.view.getUint8(c),e+=b<16?"0"+b.toString(16).toUpperCase():b.toString(16).toUpperCase(),a&&(f+=b>32&&b<127?String.fromCharCode(b):".")),++c,a&&c>0&&c%16===0&&c!==d){for(;e.length<51;)e+=" ";g+=e+f+"\n",e=f=""}e+=c===this.offset&&c===this.limit?c===this.markedOffset?"!":"|":c===this.offset?c===this.markedOffset?"[":"<":c===this.limit?c===this.markedOffset?"]":">":c===this.markedOffset?"'":a||0!==c&&c!==d?" ":""}if(a&&" "!==e){for(;e.length<51;)e+=" ";g+=e+f+"\n"}return a?g:e},d.fromDebug=function(a,b,c){for(var e,f,g=a.length,h=new d((g+1)/3|0,b,c),i=0,j=0,k=!1,l=!1,m=!1,n=!1,o=!1;i<g;){switch(e=a.charAt(i++)){case"!":if(!c){if(l||m||n){o=!0;break}l=m=n=!0}h.offset=h.markedOffset=h.limit=j,k=!1;break;case"|":if(!c){if(l||n){o=!0;break}l=n=!0}h.offset=h.limit=j,k=!1;break;case"[":if(!c){if(l||m){o=!0;break}l=m=!0}h.offset=h.markedOffset=j,k=!1;break;case"<":if(!c){if(l){o=!0;break}l=!0}h.offset=j,k=!1;break;case"]":if(!c){if(n||m){o=!0;break}n=m=!0}h.limit=h.markedOffset=j,k=!1;break;case">":if(!c){if(n){o=!0;break}n=!0}h.limit=j,k=!1;break;case"'":if(!c){if(m){o=!0;break}m=!0}h.markedOffset=j,k=!1;break;case" ":k=!1;break;default:if(!c&&k){o=!0;break}if(f=parseInt(e+a.charAt(i++),16),!c&&(isNaN(f)||f<0||f>255))throw TypeError("Illegal str: Not a debug encoded string");h.view.setUint8(j++,f),k=!0}if(o)throw TypeError("Illegal str: Invalid symbol at "+i)}if(!c){if(!l||!n)throw TypeError("Illegal str: Missing offset or limit");if(j<h.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+j+" < "+g)}return h},e.toHex=function(a,b){if(a="undefined"==typeof a?this.offset:a,b="undefined"==typeof b?this.limit:b,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}for(var c,d=new Array(b-a);a<b;)c=this.view.getUint8(a++),c<16?d.push("0",c.toString(16)):d.push(c.toString(16));return d.join("")},d.fromHex=function(a,b,c){if(!c){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if(a.length%2!==0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var e,f=a.length,g=new d(f/2|0,b),h=0,i=0;h<f;h+=2){if(e=parseInt(a.substring(h,h+2),16),!c&&(!isFinite(e)||e<0||e>255))throw TypeError("Illegal str: Contains non-hex characters");g.view.setUint8(i++,e)}return g.limit=i,g};var j=function(){var a={};return a.MAX_CODEPOINT=1114111,a.encodeUTF8=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<128?b(127&c):c<2048?(b(c>>6&31|192),b(63&c|128)):c<65536?(b(c>>12&15|224),b(c>>6&63|128),b(63&c|128)):(b(c>>18&7|240),b(c>>12&63|128),b(c>>6&63|128),b(63&c|128)),c=null},a.decodeUTF8=function(a,b){for(var c,d,e,f,g=function(a){a=a.slice(0,a.indexOf(null));var b=Error(a.toString());throw b.name="TruncatedError",b.bytes=a,b};null!==(c=a());)if(0===(128&c))b(c);else if(192===(224&c))null===(d=a())&&g([c,d]),b((31&c)<<6|63&d);else if(224===(240&c))(null===(d=a())||null===(e=a()))&&g([c,d,e]),b((15&c)<<12|(63&d)<<6|63&e);else{if(240!==(248&c))throw RangeError("Illegal starting byte: "+c);(null===(d=a())||null===(e=a())||null===(f=a()))&&g([c,d,e,f]),b((7&c)<<18|(63&d)<<12|(63&e)<<6|63&f)}},a.UTF16toUTF8=function(a,b){for(var c,d=null;;){if(null===(c=null!==d?d:a()))break;c>=55296&&c<=57343&&null!==(d=a())&&d>=56320&&d<=57343?(b(1024*(c-55296)+d-56320+65536),d=null):b(c)}null!==d&&b(d)},a.UTF8toUTF16=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<=65535?b(c):(c-=65536,b((c>>10)+55296),b(c%1024+56320)),c=null},a.encodeUTF16toUTF8=function(b,c){a.UTF16toUTF8(b,function(b){a.encodeUTF8(b,c)})},a.decodeUTF8toUTF16=function(b,c){a.decodeUTF8(b,function(b){a.UTF8toUTF16(b,c)})},a.calculateCodePoint=function(a){return a<128?1:a<2048?2:a<65536?3:4},a.calculateUTF8=function(b){for(var c,d=0;null!==(c=b());)d+=a.calculateCodePoint(c);return d},a.calculateUTF16asUTF8=function(b){var c=0,d=0;return a.UTF16toUTF8(b,function(b){++c,d+=a.calculateCodePoint(b)}),[c,d]},a}();return e.toUTF8=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var d;try{j.decodeUTF8toUTF16(function(){return a<b?this.view.getUint8(a++):null}.bind(this),d=c())}catch(e){if(a!==b)throw RangeError("Illegal range: Truncated data, "+a+" != "+b);
}return d()},d.fromUTF8=function(a,c,e){if(!e&&"string"!=typeof a)throw TypeError("Illegal str: Not a string");var f=new d(j.calculateUTF16asUTF8(b(a),!0)[1],c,e),g=0;return j.encodeUTF16toUTF8(b(a),function(a){f.view.setUint8(g++,a)}),f.limit=g,f},d}"object"==typeof a&&a&&"object"==typeof b&&b?a.exports=function(){var a;try{a=c(11)}catch(b){}return g(a)}():c(9).amd?(d=[c(11)],e=function(a){return g(a)}.apply(b,d),!(void 0!==e&&(a.exports=e))):(f.dcodeIO=f.dcodeIO||{}).ByteBuffer=g(f.dcodeIO.Long)}(this)}).call(b,c(8)(a))},function(a,b,c){var d,e,f;(function(a){!function(g,h){c(9).amd?(e=[],d=h,f="function"==typeof d?d.apply(b,e):d,!(void 0!==f&&(a.exports=f))):"object"==typeof a&&a&&a.exports?a.exports=h():(g.dcodeIO=g.dcodeIO||{}).Long=h()}(this,function(){"use strict";function a(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function b(a){return(a&&a.__isLong__)===!0}function c(a,b){var c,d,f;return b?(a>>>=0,(f=0<=a&&a<256)&&(d=i[a])?d:(c=e(a,(0|a)<0?-1:0,!0),f&&(i[a]=c),c)):(a|=0,(f=-128<=a&&a<128)&&(d=h[a])?d:(c=e(a,a<0?-1:0,!1),f&&(h[a]=c),c))}function d(a,b){if(isNaN(a)||!isFinite(a))return b?q:p;if(b){if(a<0)return q;if(a>=m)return v}else{if(a<=-n)return w;if(a+1>=n)return u}return a<0?d(-a,b).neg():e(a%l|0,a/l|0,b)}function e(b,c,d){return new a(b,c,d)}function f(a,b,c){if(0===a.length)throw Error("empty string");if("NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return p;if("number"==typeof b?(c=b,b=!1):b=!!b,c=c||10,c<2||36<c)throw RangeError("radix");var e;if((e=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===e)return f(a.substring(1),b,c).neg();for(var g=d(j(c,8)),h=p,i=0;i<a.length;i+=8){var k=Math.min(8,a.length-i),l=parseInt(a.substring(i,i+k),c);if(k<8){var m=d(j(c,k));h=h.mul(m).add(d(l))}else h=h.mul(g),h=h.add(d(l))}return h.unsigned=b,h}function g(b){return b instanceof a?b:"number"==typeof b?d(b):"string"==typeof b?f(b):e(b.low,b.high,b.unsigned)}a.prototype.__isLong__,Object.defineProperty(a.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),a.isLong=b;var h={},i={};a.fromInt=c,a.fromNumber=d,a.fromBits=e;var j=Math.pow;a.fromString=f,a.fromValue=g;var k=1<<24,l=4294967296,m=0x10000000000000000,n=m/2,o=c(k),p=c(0);a.ZERO=p;var q=c(0,!0);a.UZERO=q;var r=c(1);a.ONE=r;var s=c(1,!0);a.UONE=s;var t=c(-1);a.NEG_ONE=t;var u=e(-1,2147483647,!1);a.MAX_VALUE=u;var v=e(-1,-1,!0);a.MAX_UNSIGNED_VALUE=v;var w=e(0,-2147483648,!1);a.MIN_VALUE=w;var x=a.prototype;return x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},x.toString=function(a){if(a=a||10,a<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(w)){var b=d(a),c=this.div(b),e=c.mul(b).sub(this);return c.toString(a)+e.toInt().toString(a)}return"-"+this.neg().toString(a)}for(var f=d(j(a,6),this.unsigned),g=this,h="";;){var i=g.div(f),k=g.sub(i.mul(f)).toInt()>>>0,l=k.toString(a);if(g=i,g.isZero())return l+h;for(;l.length<6;)l="0"+l;h=""+l+h}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high?b+33:b+1},x.isZero=function(){return 0===this.high&&0===this.low},x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1===(1&this.low)},x.isEven=function(){return 0===(1&this.low)},x.equals=function(a){return b(a)||(a=g(a)),(this.unsigned===a.unsigned||this.high>>>31!==1||a.high>>>31!==1)&&(this.high===a.high&&this.low===a.low)},x.eq=x.equals,x.notEquals=function(a){return!this.eq(a)},x.neq=x.notEquals,x.lessThan=function(a){return this.comp(a)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(a){return this.comp(a)<=0},x.lte=x.lessThanOrEqual,x.greaterThan=function(a){return this.comp(a)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(a){return this.comp(a)>=0},x.gte=x.greaterThanOrEqual,x.compare=function(a){if(b(a)||(a=g(a)),this.eq(a))return 0;var c=this.isNegative(),d=a.isNegative();return c&&!d?-1:!c&&d?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(r)},x.neg=x.negate,x.add=function(a){b(a)||(a=g(a));var c=this.high>>>16,d=65535&this.high,f=this.low>>>16,h=65535&this.low,i=a.high>>>16,j=65535&a.high,k=a.low>>>16,l=65535&a.low,m=0,n=0,o=0,p=0;return p+=h+l,o+=p>>>16,p&=65535,o+=f+k,n+=o>>>16,o&=65535,n+=d+j,m+=n>>>16,n&=65535,m+=c+i,m&=65535,e(o<<16|p,m<<16|n,this.unsigned)},x.subtract=function(a){return b(a)||(a=g(a)),this.add(a.neg())},x.sub=x.subtract,x.multiply=function(a){if(this.isZero())return p;if(b(a)||(a=g(a)),a.isZero())return p;if(this.eq(w))return a.isOdd()?w:p;if(a.eq(w))return this.isOdd()?w:p;if(this.isNegative())return a.isNegative()?this.neg().mul(a.neg()):this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(o)&&a.lt(o))return d(this.toNumber()*a.toNumber(),this.unsigned);var c=this.high>>>16,f=65535&this.high,h=this.low>>>16,i=65535&this.low,j=a.high>>>16,k=65535&a.high,l=a.low>>>16,m=65535&a.low,n=0,q=0,r=0,s=0;return s+=i*m,r+=s>>>16,s&=65535,r+=h*m,q+=r>>>16,r&=65535,r+=i*l,q+=r>>>16,r&=65535,q+=f*m,n+=q>>>16,q&=65535,q+=h*l,n+=q>>>16,q&=65535,q+=i*k,n+=q>>>16,q&=65535,n+=c*m+f*l+h*k+i*j,n&=65535,e(r<<16|s,n<<16|q,this.unsigned)},x.mul=x.multiply,x.divide=function(a){if(b(a)||(a=g(a)),a.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?q:p;var c,e,f;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return q;if(a.gt(this.shru(1)))return s;f=q}else{if(this.eq(w)){if(a.eq(r)||a.eq(t))return w;if(a.eq(w))return r;var h=this.shr(1);return c=h.div(a).shl(1),c.eq(p)?a.isNegative()?r:t:(e=this.sub(a.mul(c)),f=c.add(e.div(a)))}if(a.eq(w))return this.unsigned?q:p;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=p}for(e=this;e.gte(a);){c=Math.max(1,Math.floor(e.toNumber()/a.toNumber()));for(var i=Math.ceil(Math.log(c)/Math.LN2),k=i<=48?1:j(2,i-48),l=d(c),m=l.mul(a);m.isNegative()||m.gt(e);)c-=k,l=d(c,this.unsigned),m=l.mul(a);l.isZero()&&(l=r),f=f.add(l),e=e.sub(m)}return f},x.div=x.divide,x.modulo=function(a){return b(a)||(a=g(a)),this.sub(this.div(a).mul(a))},x.mod=x.modulo,x.not=function(){return e(~this.low,~this.high,this.unsigned)},x.and=function(a){return b(a)||(a=g(a)),e(this.low&a.low,this.high&a.high,this.unsigned)},x.or=function(a){return b(a)||(a=g(a)),e(this.low|a.low,this.high|a.high,this.unsigned)},x.xor=function(a){return b(a)||(a=g(a)),e(this.low^a.low,this.high^a.high,this.unsigned)},x.shiftLeft=function(a){return b(a)&&(a=a.toInt()),0===(a&=63)?this:a<32?e(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):e(0,this.low<<a-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(a){return b(a)&&(a=a.toInt()),0===(a&=63)?this:a<32?e(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):e(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(a){if(b(a)&&(a=a.toInt()),a&=63,0===a)return this;var c=this.high;if(a<32){var d=this.low;return e(d>>>a|c<<32-a,c>>>a,this.unsigned)}return 32===a?e(c,0,this.unsigned):e(c>>>a-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?e(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:e(this.low,this.high,!0)},x.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24&255,255&a,a>>>8&255,a>>>16&255,a>>>24&255]},x.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24&255,a>>>16&255,a>>>8&255,255&a,b>>>24&255,b>>>16&255,b>>>8&255,255&b]},a})}).call(b,c(8)(a))},function(a,b){},function(a,b){},function(a,b,c){var d,e;d=[c(15),c(16)],e=function(a,b){"use strict";function c(a,c,d){if("string"!=typeof a)throw new Error('Must pass a valid "version"');if("string"!=typeof c)throw new Error('Must pass a valid "baseUri"');if("object"!=typeof d)throw new Error('Must pass a valid "logger"');this._version=a,this._baseUri=c,this._logger=d,this._http=new b(a,c,d)}function d(b,c){if(0===b.lastIndexOf("wss:",0))c(void 0,b+"/ws");else if(0===b.lastIndexOf("https:",0)){var d=this;e.call(d,b,function(b,e){if(b)return c(b);var f=new a(c,d._version,d._baseUri,d._logger);f.resolveAll(e)})}else c(new Error("Uri not supported"))}function e(a,b){this._http.httpGetWithRetry(a+"/pcast/endPoints",function(a,c){if(a)return b(new Error("Failed to resolve an end point",a));var d=c.split(",");d.length<1&&b(new Error("Failed to discover end points")),b(void 0,d)},f)}var f=3;return c.DefaultPCastUri="https://pcast.phenixp2p.com",c.prototype.getBaseUri=function(){return this._baseUri},c.prototype.resolveUri=function(a){return d.call(this,this._baseUri,a)},c.prototype.toString=function(){return"PCastEndPoint["+this._baseUri+"]"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(16),c(17)],e=function(a,b){"use strict";function c(b,c,d,e){this._done=!1,this._minTime=Number.MAX_VALUE,this._minResponseText="",this._onClosestEndpointFound=b,this._logger=e,this._version=c,this._http=new a(c,d,e)}var d=4;return c.prototype.isResolved=function(){return this._done},c.prototype.measurementCallback=function(a,b,c){return b<this._minTime&&(this._logger.info("Current closest end point is [%s] with latency of [%s] ms",c,b),this._minTime=b,this._minResponseText=c),this.isResolved()},c.prototype.completeCallback=function(a){if(this._minResponseText&&this._minTime<Number.MAX_VALUE&&!this.isResolved())return this._done=!0,this._onClosestEndpointFound(void 0,this._minResponseText)},c.prototype.resolveAll=function(a){for(var b=0;b<a.length;b++)this.resolve(a[b],d)},c.prototype.resolve=function(a,c){var d=this,e=1,f=function g(a){var f=1,h=b.now();d._logger.info("[%s] Checking end point [%s]",e,a),d._http.httpGetWithRetry.call(d,a,function(f,i){var j=b.now(),k=j-h;if(d._logger.info("[%s] End point [%s] latency is [%s] ms",e,a,k),e++,f||!d.measurementCallback(a,k,i))return e<=c&&!d.isResolved()?(f&&d._logger.info("Retrying after failure to resolve end point [%s]",a,f),g(a)):d.completeCallback(a)},f)};f(a)},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(17)],e=function(a){"use strict";function b(a,b,c){if("string"!=typeof a)throw new Error('Must pass a valid "version"');if("string"!=typeof b)throw new Error('Must pass a valid "baseUri"');if("object"!=typeof c)throw new Error('Must pass a valid "logger"');this._version=a,this._baseUri=b,this._logger=c}return b.prototype.httpGetWithRetry=function c(b,d,e,f){void 0===f&&(f=1);var g=this,h=new XMLHttpRequest,i="GET",j=b+"?version="+encodeURIComponent(g._version)+"&_="+a.now();if("withCredentials"in h)h.open(i,j,!0);else if("undefined"!=typeof XDomainRequest)h=new XDomainRequest,h.open(i,j);else{var k=new Error("unsupported");k.code="unsupported",d(k)}h.addEventListener("readystatechange",function(){if(4===h.readyState)if(200===h.status)d(void 0,h.responseText);else if(h.status>=500&&h.status<600&&f<=e)c.call(g,b,d,e,f+1);else{g._logger.info("HTTP GET [%s] failed with [%s] [%s]",b,h.status,h.statusText);var a=new Error(0===h.status?"timeout":h.statusText);a.code=h.status,d(a)}}),h.timeout=15e3,h.send()},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(){this._version=version,this._baseUri=baseUri}return a.now=function(){return Date.now?function(){return Date.now()}:function(){return(new Date).getTime()}}(),a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(17),c(1)],e=function(a,b){"use strict";function c(a,b,c){if("string"!=typeof a)throw new Error('Must pass a valid "name"');if("object"!=typeof b)throw new Error('Must pass a valid "peerConnection"');if("object"!=typeof c)throw new Error('Must pass a valid "logger"');this._name=a,this._peerConnection=b,this._logger=c}function d(c,d,e,o,p){function q(){var i=null;f(d,i,function(f){function i(d,f){switch(b.browser){case"Firefox":if(n=m|=d.selected&&"succeeded"===d.state,"outbound"===e.direction&&"outboundrtp"===d.type){var g={time:a.now(),value:d.bytesSent||0};switch(d.mediaType){case"video":r._logger.debug("[%s] Outbound [%s] [%s] with bitrate [%s], droppedFrames [%s] and frame rate [%s]",c,d.mediaType,d.ssrc,d.bitrateMean,d.droppedFrames,d.framerateMean),j=!0,t=d.framerateMean||0,k=!0,u=h(g,w),w=g;break;case"audio":r._logger.debug("[%s] Outbound [%s] [%s]",c,d.mediaType,d.ssrc),l=!0,v=h(g,x),x=g}}if("inbound"===e.direction&&"inboundrtp"===d.type){var g={time:a.now(),value:d.bytesReceived||0};switch(d.mediaType){case"video":r._logger.debug("[%s] Inbound [%s] [%s] with framerate [%s] and jitter [%s]",c,d.mediaType,d.ssrc,d.framerateMean,d.jitter),k=!0,u=h(g,w),w=g;break;case"audio":r._logger.debug("[%s] Inbound [%s] [%s] with jitter [%s]",c,d.mediaType,d.ssrc,d.jitter),l=!0,v=h(g,x),x=g}}break;default:if("true"===d.googWritable&&(n=!0),"true"===d.googReadable&&(m=!0),"ssrc"!==d.type)return;if("outbound"===e.direction){var g={time:a.now(),value:d.bytesSent||0};switch(d.mediaType){case"video":r._logger.debug("[%s] Outbound [%s] [%s] with average encoding time [%s] ms (CPU limited=[%s]) and RTT [%s]",c,d.mediaType,d.ssrc,d.googAvgEncodeMs,d.googCpuLimitedResolution,d.googRtt),j=!0,t=d.googFrameRateSent||0,k=!0,u=h(g,w),w=g;break;case"audio":r._logger.debug("[%s] Outbound [%s] [%s] with audio input level [%s] and RTT [%s] and jitter [%s]",c,d.mediaType,d.ssrc,d.audioInputLevel,d.googRtt,d.googJitterReceived),l=!0,v=h(g,x),x=g}}else if("inbound"===e.direction){var g={time:a.now(),value:d.bytesReceived||0};switch(d.mediaType){case"video":r._logger.debug("[%s] Inbound [%s] [%s] with current delay [%s] ms and target delay [%s] ms",c,d.mediaType,d.ssrc,d.googCurrentDelayMs,d.googTargetDelayMs),j=!0,t=d.googFrameRateReceived||0,k=!0,u=h(g,w),w=g;break;case"audio":r._logger.debug("[%s] Inbound [%s] [%s] with output level [%s] and jitter [%s] and jitter buffer [%s] ms",c,d.mediaType,d.ssrc,d.audioOutputLevel,d.googJitterReceived,d.googJitterBufferMs),l=!0,v=h(g,x),x=g}}}}var j=!1,k=!1,l=!1,m=!1,n=!1;if(f.forEach)f.forEach(i);else for(var H in f){var I=f[H];i(I,H)}if(k&&0===u||l&&0===v||j&&0===t){var J=g.call(r,d);k=k&&J.video&&J.video.enabled!==!1,l=l&&J.audio&&J.audio.enabled!==!1,j=j&&J.video&&J.video.enabled!==!1,m=m||!(J.video&&J.video.enabled!==!1||J.audio&&J.audio.enabled!==!1),n=n||!(J.video&&J.video.enabled!==!1||J.audio&&J.audio.enabled!==!1)}if((l||k||j)&&r._logger.debug("[%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",c,Math.ceil(v||0),Math.ceil(u||0),t||"?"),!o())return void r._logger.info("[%s] Finished monitoring of peer connection",c);if(!G||"closed"!==d.connectionState&&"failed"!==d.connectionState&&"failed"!==d.iceConnectionState)E&&j&&t<=y?s++:F&&l&&v<=A?s++:F&&k&&u<=z?s++:m&&n?s=0:s++;else{var J=g.call(r,d),K=0,L=0;for(var M in J){var N=J[M];N&&N.enabled!==!1?K++:L++}if(0===K&&L>0)return void r._logger.info("[%s] Finished monitoring of peer connection with [%s] inactive tracks",c,L);s++}s>=B?p("condition",t,u,v)?(s=Number.MIN_VALUE,setTimeout(q,C)):r._logger.error("[%s] Failure detected with frame rate [%s] FPS and bit rate [%s/%s] bps: [%s]",c,t,v,u,f):setTimeout(q,s>0?D:C)},function(a){p("error",a)})}if("string"!=typeof c)throw new Error('Must pass a valid "name"');if("object"!=typeof d)throw new Error('Must pass a valid "peerConnection"');if("object"!=typeof e)throw new Error('Must pass a valid "options"');if("function"!=typeof o)throw new Error('Must pass a valid "activeCallback"');if("function"!=typeof p)throw new Error('Must pass a valid "monitorCallback"');if("inbound"!==e.direction&&"outbound"!==e.direction)throw new Error("Invalid monitoring direction");var r=this,s=0,t=void 0,u=void 0,v=void 0,w={time:a.now(),value:0},x={time:a.now(),value:0},y=e.frameRateThreshold||k,z=e.videoBitRateThreshold||m,A=e.audioBitRateThreshold||l,B=e.conditionCountForNotificationThreshold||n,C=e.monitoringInterval||i,D=e.monitoringInterval||j,E=!e.hasOwnProperty("monitorFrameRate")||e.monitorFrameRate,F=!e.hasOwnProperty("monitorBitRate")||e.monitorBitRate,G=!e.hasOwnProperty("monitorState")||e.monitorState;setTimeout(q,C)}function e(a){if("Firefox"===b.browser)return a;var c={};return a.result().forEach(function(a){var b={id:a.id,type:a.type};a.names().forEach(function(c){b[c]=a.stat(c)}),c[b.id]=b}),c}function f(a,c,d,f){switch(b.browser){case"Firefox":return a.getStats(c).then(function(a){var b=e(a);d(b)})["catch"](function(a){f("error",a)});default:return a.getStats(function(a){var b=e(a);d(b)},c,function(a){f("error",a)})}}function g(a){var b={},c=a.localDescription.sdp.split("m="),d=a.remoteDescription.sdp.split("m=");if(c.length!==d.length)return{};for(var e=1;e<c.length;e++){var f=c[e];f.startsWith("audio")?b.audio={enabled:f.indexOf("a=inactive")===-1&&d[e].indexOf("a=inactive")===-1}:f.startsWith("video")&&(b.video={enabled:f.indexOf("a=inactive")===-1&&d[e].indexOf("a=inactive")===-1})}return b}function h(a,b){return 8*(a.value-b.value)/((a.time-b.time)/1e3)}var i=4e3,j=1500,k=2,l=5e3,m=6e3,n=3;return c.prototype.start=function(a,b,c){return d.call(this,this._name,this._peerConnection,a,b,c)},c.prototype.toString=function(){return"PeerConnectionMonitor[]"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(a){if(!a)throw new Error("'logger' must be specified.");this._logger=a,this._dimensionsChangedIntervalId=null,this._videoDisplayDimensionsChangedCallback=null,this._toBeStarted=!1,this._videoElement=null,this._dimensionsChangedData={pollFrequency:f,previousWidth:0,previousHeight:0},this._renderer=null}function b(a,b){b&&void 0!==b.videoWidth||this._logger.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this._renderer=a,this._videoElement=b,this._toBeStarted=!0,e.call(this)}function c(){this._toBeStarted=!1,this._dimensionsChangedIntervalId&&(clearInterval(this._dimensionsChangedIntervalId),this._dimensionsChangedIntervalId=null)}function d(a,b){if(null===a)return this._videoDisplayDimensionsChangedCallback=null,void c.call(this);if("function"!=typeof a)throw new Error('"callback" must be a function');this._videoDisplayDimensionsChangedCallback=a,b&&b.pollFrequency&&(this._dimensionsChangedData.pollFrequency=b.pollFrequency>=g?b.pollFrequency:g),e.call(this)}function e(){if(this._toBeStarted&&!this._dimensionsChangedIntervalId&&this._videoDisplayDimensionsChangedCallback){var a=this;this._dimensionsChangedData.previousWidth=this._videoElement.videoWidth,this._dimensionsChangedData.previousHeight=this._videoElement.videoHeight,this._dimensionsChangedIntervalId=setInterval(function(){a._videoElement.videoWidth===a._dimensionsChangedData.previousWidth&&a._videoElement.videoHeight===a._dimensionsChangedData.previousHeight||(a._dimensionsChangedData.previousWidth=a._videoElement.videoWidth,a._dimensionsChangedData.previousHeight=a._videoElement.videoHeight,a._videoDisplayDimensionsChangedCallback(a._renderer,{width:a._videoElement.videoWidth,height:a._videoElement.videoHeight}))},a._dimensionsChangedData.pollFrequency)}}var f=500,g=15;return a.prototype.start=function(a,c){b.call(this,a,c)},a.prototype.stop=function(){c.call(this)},a.prototype.setVideoDisplayDimensionsChangedCallback=function(a,b){d.call(this,a,b)},a.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this._dimensionsChangedData.pollFrequency+", previousHeight="+this._dimensionsChangedData.previousHeight+", previousWidth="+this._dimensionsChangedData.previousHeight+", state="+(this._dimensionsChangedIntervalId?"running":"stopped")+"]"},a}.apply(b,d),!(void 0!==e&&(a.exports=e))}])});